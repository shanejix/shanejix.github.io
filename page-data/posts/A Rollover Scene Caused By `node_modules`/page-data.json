{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/A Rollover Scene Caused By `node_modules`/","result":{"data":{"site":{"siteMetadata":{"title":"shanejix","description":"learner && coder"}},"allMarkdownRemark":{"edges":[{"node":{"id":"9dd4013c-c308-552c-bd2c-04f0cd996599","timeToRead":5}},{"node":{"id":"d29bf37d-75f0-501e-92b1-42c06cdbcd7b","timeToRead":3}},{"node":{"id":"89619e78-eeef-5342-b7fe-7626ee925f57","timeToRead":9}},{"node":{"id":"cb3a4052-202e-5a46-bf15-4e9b30e34ebf","timeToRead":3}},{"node":{"id":"45c6b07a-fc6a-5800-9907-86a94c1f4ace","timeToRead":2}},{"node":{"id":"db38bc53-9935-56f0-a9e2-0be373990d78","timeToRead":3}},{"node":{"id":"1dcfd849-d044-5c73-b31a-5fd30393f430","timeToRead":14}},{"node":{"id":"7b38ed3c-4032-581a-aab4-bda6dcb8fa78","timeToRead":15}},{"node":{"id":"d15e9143-f799-527d-b71d-2b8fc195817c","timeToRead":12}},{"node":{"id":"ba521381-a518-5686-a682-0ada55a7dd73","timeToRead":4}},{"node":{"id":"ba58ecad-907f-5ad2-bc26-9167d7607dcc","timeToRead":12}},{"node":{"id":"08b71346-abf3-5649-84f5-2f8ae4f48c6a","timeToRead":3}},{"node":{"id":"da55e002-3a8a-5af2-929e-4de7e3a8d314","timeToRead":4}},{"node":{"id":"4e56b6de-c0ca-572e-9f9d-e769592aa49b","timeToRead":2}},{"node":{"id":"af002700-632d-547f-82b9-f31919d4f03e","timeToRead":1}},{"node":{"id":"7b6d671f-8de2-5511-91e9-0797db813dc7","timeToRead":1}},{"node":{"id":"ad4fad45-b734-560c-8324-a9708e1e04c4","timeToRead":1}},{"node":{"id":"ef84ef13-dac8-5cfa-ac69-d0ea44f677f1","timeToRead":2}},{"node":{"id":"69026b7f-ca1c-5eea-8f61-76972396800c","timeToRead":2}},{"node":{"id":"52b13183-db66-5637-bc21-c828b8dabddd","timeToRead":8}},{"node":{"id":"14bde951-d8e7-5045-84f7-dd9479cfafc3","timeToRead":35}},{"node":{"id":"aa4d72c6-d675-52e4-a55b-b07237ed0e1a","timeToRead":2}},{"node":{"id":"eb631c0f-69a5-5ca8-b3c7-1baaed014eea","timeToRead":1}},{"node":{"id":"684d2035-e385-577d-bb53-f7bfca2caa0d","timeToRead":18}},{"node":{"id":"a40d34f8-b202-5f5b-8c33-19c7c163bbce","timeToRead":5}},{"node":{"id":"afc44728-7e4f-5ce3-bf62-373400a8a46a","timeToRead":12}},{"node":{"id":"ca3cc4cf-0ddf-5fb3-a58d-2354b2f0a10e","timeToRead":5}},{"node":{"id":"fe7fd5be-04af-5d1a-b969-f8f4de7db655","timeToRead":1}},{"node":{"id":"fb3bc99d-cf2f-5fbd-981d-1d701815f87b","timeToRead":66}},{"node":{"id":"4de1fb79-73c7-5593-adc3-427351c465e9","timeToRead":101}},{"node":{"id":"9a102758-e412-5f31-8753-54534e8fdb15","timeToRead":1}},{"node":{"id":"a07217e5-4cbe-54e4-9566-2a0df732a1a4","timeToRead":1}},{"node":{"id":"c8a73065-3214-5616-93f3-0df2a119e91d","timeToRead":1}}]},"markdownRemark":{"id":"9dd4013c-c308-552c-bd2c-04f0cd996599","excerpt":"同步链接: https://www.shanejix.com/posts/A Rollover Scene Caused By…","html":"<blockquote>\n<p>同步链接: <a href=\"https://www.shanejix.com/posts/A%20Rollover%20Scene%20Caused%20By%20%60node_modules%60/\">https://www.shanejix.com/posts/A Rollover Scene Caused By <code class=\"language-text\">node_modules</code>/</a></p>\n</blockquote>\n<p>使用微前端改造项目时，不知道作了什么骚操作导致项目在编译阶段失败，导致启动不了。相同系统，相同机器，相同环境下只有我的电脑跑不起来！重装项目，重装环境，重装系统，前后折腾了许久找到了问题所在，作于释怀！</p>\n<p>当然这必定不是什么偶然事件，一定是什么巧合所造成的必然结果！🤔</p>\n<hr>\n<h2>背景</h2>\n<p><code class=\"language-text\">yarn start</code> 报错信息如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">lerna notice cli v3<span class=\"token punctuation\">.</span><span class=\"token number\">22.1</span>\nlerna info Executing command <span class=\"token keyword\">in</span> <span class=\"token number\">4</span> packages<span class=\"token operator\">:</span> <span class=\"token string\">\"yarn run dev\"</span>\nlerna <span class=\"token constant\">ERR</span><span class=\"token operator\">!</span> yarn run dev exited <span class=\"token number\">1</span> <span class=\"token keyword\">in</span> <span class=\"token string\">'home-app'</span>\nlerna <span class=\"token constant\">ERR</span><span class=\"token operator\">!</span> yarn run dev stdout<span class=\"token operator\">:</span>\n$ react<span class=\"token operator\">-</span>app<span class=\"token operator\">-</span>rewired start\ninfo Visit https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>yarnpkg<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>en<span class=\"token operator\">/</span>docs<span class=\"token operator\">/</span>cli<span class=\"token operator\">/</span>run <span class=\"token keyword\">for</span> documentation about <span class=\"token keyword\">this</span> command<span class=\"token punctuation\">.</span>\n\nlerna <span class=\"token constant\">ERR</span><span class=\"token operator\">!</span> yarn run dev stderr<span class=\"token operator\">:</span>\n\nThere might be a problem <span class=\"token keyword\">with</span> the project dependency tree<span class=\"token punctuation\">.</span>\nIt is likely not a bug <span class=\"token keyword\">in</span> Create React App<span class=\"token punctuation\">,</span> but something you need to fix locally<span class=\"token punctuation\">.</span>\n\nThe react<span class=\"token operator\">-</span>scripts <span class=\"token keyword\">package</span> provided by Create React App requires a dependency<span class=\"token operator\">:</span>\n\n  <span class=\"token string\">\"babel-eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10.1.0\"</span>\n\nDon't <span class=\"token keyword\">try</span> to install it manually<span class=\"token operator\">:</span> your <span class=\"token keyword\">package</span> manager does it automatically<span class=\"token punctuation\">.</span>\nHowever<span class=\"token punctuation\">,</span> a different version <span class=\"token keyword\">of</span> babel<span class=\"token operator\">-</span>eslint was detected higher up <span class=\"token keyword\">in</span> the tree<span class=\"token operator\">:</span>\n\n  <span class=\"token constant\">E</span><span class=\"token operator\">:</span>\\node_modules\\babel<span class=\"token operator\">-</span><span class=\"token function\">eslint</span> <span class=\"token punctuation\">(</span>version<span class=\"token operator\">:</span> <span class=\"token number\">10.0</span><span class=\"token number\">.3</span><span class=\"token punctuation\">)</span>\n\nManually installing incompatible versions is known to cause hard<span class=\"token operator\">-</span>to<span class=\"token operator\">-</span>debug issues<span class=\"token punctuation\">.</span>\n\nIf you would prefer to ignore <span class=\"token keyword\">this</span> check<span class=\"token punctuation\">,</span> add <span class=\"token constant\">SKIP_PREFLIGHT_CHECK</span><span class=\"token operator\">=</span><span class=\"token boolean\">true</span> to an <span class=\"token punctuation\">.</span>env file <span class=\"token keyword\">in</span> your project<span class=\"token punctuation\">.</span>\nThat will permanently disable <span class=\"token keyword\">this</span> message but you might encounter other issues<span class=\"token punctuation\">.</span>\n\nTo fix the dependency tree<span class=\"token punctuation\">,</span> <span class=\"token keyword\">try</span> following the steps below <span class=\"token keyword\">in</span> the exact order<span class=\"token operator\">:</span>\n\n  <span class=\"token number\">1.</span> Delete <span class=\"token keyword\">package</span><span class=\"token operator\">-</span>lock<span class=\"token punctuation\">.</span><span class=\"token function\">json</span> <span class=\"token punctuation\">(</span>not <span class=\"token keyword\">package</span><span class=\"token punctuation\">.</span>json<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> and<span class=\"token operator\">/</span>or yarn<span class=\"token punctuation\">.</span>lock <span class=\"token keyword\">in</span> your project folder<span class=\"token punctuation\">.</span>\n  <span class=\"token number\">2.</span> Delete node_modules <span class=\"token keyword\">in</span> your project folder<span class=\"token punctuation\">.</span>\n  <span class=\"token number\">3.</span> Remove <span class=\"token string\">\"babel-eslint\"</span> from dependencies and<span class=\"token operator\">/</span>or devDependencies <span class=\"token keyword\">in</span> the <span class=\"token keyword\">package</span><span class=\"token punctuation\">.</span>json file <span class=\"token keyword\">in</span> your project folder<span class=\"token punctuation\">.</span>\n  <span class=\"token number\">4.</span> Run npm install or yarn<span class=\"token punctuation\">,</span> depending on the <span class=\"token keyword\">package</span> manager you use<span class=\"token punctuation\">.</span>\n\nIn most cases<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span> should be enough to fix the problem<span class=\"token punctuation\">.</span>\nIf <span class=\"token keyword\">this</span> has not helped<span class=\"token punctuation\">,</span> there are a few other things you can <span class=\"token keyword\">try</span><span class=\"token operator\">:</span>\n\n  <span class=\"token number\">5.</span> If you used npm<span class=\"token punctuation\">,</span> install <span class=\"token function\">yarn</span> <span class=\"token punctuation\">(</span>http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">yarnpkg.com</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span> and repeat the above steps <span class=\"token keyword\">with</span> it instead<span class=\"token punctuation\">.</span>\n     This may help because npm has known issues <span class=\"token keyword\">with</span> <span class=\"token keyword\">package</span> hoisting which may <span class=\"token keyword\">get</span> resolved <span class=\"token keyword\">in</span> future versions<span class=\"token punctuation\">.</span>\n\n  <span class=\"token number\">6.</span> Check <span class=\"token keyword\">if</span> <span class=\"token constant\">E</span><span class=\"token operator\">:</span>\\node_modules\\babel<span class=\"token operator\">-</span>eslint is outside your project directory<span class=\"token punctuation\">.</span>\n     For example<span class=\"token punctuation\">,</span> you might have accidentally installed something <span class=\"token keyword\">in</span> your home folder<span class=\"token punctuation\">.</span>\n\n  <span class=\"token number\">7.</span> Try running npm ls babel<span class=\"token operator\">-</span>eslint <span class=\"token keyword\">in</span> your project folder<span class=\"token punctuation\">.</span>\n     This will tell you which other <span class=\"token keyword\">package</span> <span class=\"token punctuation\">(</span>apart from the expected react<span class=\"token operator\">-</span>scripts<span class=\"token punctuation\">)</span> installed babel<span class=\"token operator\">-</span>eslint<span class=\"token punctuation\">.</span>\n\nIf nothing <span class=\"token keyword\">else</span> helps<span class=\"token punctuation\">,</span> add <span class=\"token constant\">SKIP_PREFLIGHT_CHECK</span><span class=\"token operator\">=</span><span class=\"token boolean\">true</span> to an <span class=\"token punctuation\">.</span>env file <span class=\"token keyword\">in</span> your project<span class=\"token punctuation\">.</span>\nThat would permanently disable <span class=\"token keyword\">this</span> preflight check <span class=\"token keyword\">in</span> <span class=\"token keyword\">case</span> you want to proceed anyway<span class=\"token punctuation\">.</span>\n\n<span class=\"token constant\">P</span><span class=\"token punctuation\">.</span><span class=\"token constant\">S</span><span class=\"token punctuation\">.</span> We know <span class=\"token keyword\">this</span> message is long but please read the steps above <span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token punctuation\">)</span> We hope you find them helpful<span class=\"token operator\">!</span>\n\nerror Command failed <span class=\"token keyword\">with</span> exit code <span class=\"token number\">1.</span>\n\nlerna <span class=\"token constant\">ERR</span><span class=\"token operator\">!</span> yarn run dev exited <span class=\"token number\">1</span> <span class=\"token keyword\">in</span> <span class=\"token string\">'home-app'</span>\nlerna <span class=\"token constant\">WARN</span> complete Waiting <span class=\"token keyword\">for</span> <span class=\"token number\">3</span> child processes to exit<span class=\"token punctuation\">.</span> <span class=\"token constant\">CTRL</span><span class=\"token operator\">-</span><span class=\"token constant\">C</span> to exit immediately<span class=\"token punctuation\">.</span>\nerror Command failed <span class=\"token keyword\">with</span> exit code <span class=\"token number\">1.</span>\ninfo Visit https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>yarnpkg<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>en<span class=\"token operator\">/</span>docs<span class=\"token operator\">/</span>cli<span class=\"token operator\">/</span>run <span class=\"token keyword\">for</span> documentation about <span class=\"token keyword\">this</span> command<span class=\"token punctuation\">.</span></code></pre></div>\n<hr>\n<p>我丢！初/粗看不明所以，一顿操作猛如虎，按着 1. 2. 3. 的步骤走，当然结局从一开始就已经注定了！别问！问就是你品！你细细品！[1]</p>\n<ol>\n<li><strong>Delete package-lock.json (not package.json!) and/or yarn.lock in your project folder.</strong></li>\n<li><strong>Delete node_modules in your project folder.</strong></li>\n<li><strong>Remove “babel-eslint” from dependencies and/or devDependencies in the package.json file in your project folder.</strong></li>\n<li><strong>Run npm install or yarn, depending on the package manager you use.</strong></li>\n<li><strong>If you used npm, install yarn (</strong><a href=\"http://yarnpkg.com/\"><strong>http://yarnpkg.com/</strong></a><strong>) and repeat the above steps with it instead.</strong></li>\n<li><strong>Check if E:\\node_modules\\babel-eslint is outside your project directory.</strong></li>\n<li><strong>Try running npm ls babel-eslint in your project folder.</strong></li>\n</ol>\n<h2>解决</h2>\n<p>也许你也年少轻狂的我一样，不服输！那就干吧！</p>\n<p>第一条，相信这个大家都不陌生，当项目的依赖下载不下来时，耳边总会有那么一个人会嚷嚷到“删除<code class=\"language-text\">yarn.lock</code>和<code class=\"language-text\">package-lock.json</code>试下”。当然这个万金油这次确实不好使了！</p>\n<p>恩，第二条和第一条雷同，<code class=\"language-text\">rm -rf node_modules</code>  and <code class=\"language-text\">yarn</code> 也许是敲打次数的最多的对象了。</p>\n<p>第三条，提到<code class=\"language-text\">babel-eslint</code>依赖冲突，从<code class=\"language-text\">dependencies</code>移入到<code class=\"language-text\">devDependencies</code>中也许能解决。</p>\n<p>第四条，<code class=\"language-text\">yarn add babel-eslint</code> or <code class=\"language-text\">npm install babel-eslint</code> 可能有效。</p>\n<p>第五条，<code class=\"language-text\">yarn</code>不行就试试<code class=\"language-text\">npm</code>，<code class=\"language-text\">npm</code>不行就试试<code class=\"language-text\">yarn</code>。</p>\n<p>第六条，👿（你抓住它了吗?)。</p>\n<p>第七条，<code class=\"language-text\">npm ls xxx</code> 然后呢!</p>\n<p>当然上述方法，当时都一一试过，均没成功！其实第六条已经明确了问题的所在！只是后来没有复现出一模一样的信息，但也能说明问题。</p>\n<p>之前换了系统后，注意到了文末:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">If nothing <span class=\"token keyword\">else</span> helps<span class=\"token punctuation\">,</span> add <span class=\"token constant\">SKIP_PREFLIGHT_CHECK</span><span class=\"token operator\">=</span><span class=\"token boolean\">true</span> to an <span class=\"token punctuation\">.</span>env file <span class=\"token keyword\">in</span> your project<span class=\"token punctuation\">.</span>\nThat would permanently disable <span class=\"token keyword\">this</span> preflight check <span class=\"token keyword\">in</span> <span class=\"token keyword\">case</span> you want to proceed anyway<span class=\"token punctuation\">.</span></code></pre></div>\n<p>添加<code class=\"language-text\">.env</code>,居然奏效了！🤔</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token constant\">SKIP_PREFLIGHT_CHECK</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>细心的你也许早就发现了端倪：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">lerna notice cli v3<span class=\"token punctuation\">.</span><span class=\"token number\">22.1</span>\nlerna info Executing command <span class=\"token keyword\">in</span> <span class=\"token number\">4</span> packages<span class=\"token operator\">:</span> <span class=\"token string\">\"yarn run dev\"</span>\nlerna <span class=\"token constant\">ERR</span><span class=\"token operator\">!</span> yarn run dev exited <span class=\"token number\">1</span> <span class=\"token keyword\">in</span> <span class=\"token string\">'home-app'</span>\nlerna <span class=\"token constant\">ERR</span><span class=\"token operator\">!</span> yarn run dev stdout<span class=\"token operator\">:</span>\n$ react<span class=\"token operator\">-</span>app<span class=\"token operator\">-</span>rewired start\ninfo Visit https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>yarnpkg<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>en<span class=\"token operator\">/</span>docs<span class=\"token operator\">/</span>cli<span class=\"token operator\">/</span>run <span class=\"token keyword\">for</span> documentation about <span class=\"token keyword\">this</span> command<span class=\"token punctuation\">.</span>\n\nlerna <span class=\"token constant\">ERR</span><span class=\"token operator\">!</span> yarn run dev stderr<span class=\"token operator\">:</span>\n\nThere might be a problem <span class=\"token keyword\">with</span> the project dependency tree<span class=\"token punctuation\">.</span></code></pre></div>\n<p>没错问题就出在<code class=\"language-text\">**dependency tree**</code>这里[1]:之前无意中拷贝了一份<code class=\"language-text\">node_modules</code>到项目的上一级文件夹,一段时间后某个包更新导致当前项目的依赖和上级文件中包的版本冲突。</p>\n<p>显然删除<code class=\"language-text\">yarn.lock</code>和<code class=\"language-text\">package-lock.json</code>;<code class=\"language-text\">rm -rf node_modules</code>  and <code class=\"language-text\">yarn</code>; <code class=\"language-text\">yarn add xxx</code>; 切换<code class=\"language-text\">yarn</code>和<code class=\"language-text\">npm</code>都不能解决包的版本冲突问题!</p>\n<hr>\n<p>那么</p>\n<ul>\n<li>🤔 <code class=\"language-text\">dependency tree</code> 和 <code class=\"language-text\">node_modules</code> 是什么关系？</li>\n<li>🤔 <code class=\"language-text\">dependency tree</code>的查找顺序是怎样的？</li>\n<li>🤔 <code class=\"language-text\">npm</code>包的管理机制，不同版本是否有区别？</li>\n<li>🤔 <code class=\"language-text\">yarn</code> 为什么出现和 <code class=\"language-text\">npm</code> 有何区别？</li>\n<li>🤔 以及 <code class=\"language-text\">deno</code> 中的包管理和 <code class=\"language-text\">node</code> 中的包管理有何不同？</li>\n</ul>\n<h2>扩展</h2>\n<blockquote>\n<p>作者：<a href=\"https://www.shanejix.com/\">shanejix</a>\n出处：<a href=\"https://www.shanejix.com/posts/A%20Rollover%20Scene%20Caused%20By%20%60node_modules%60/\">https://www.shanejix.com/posts/A Rollover Scene Caused By <code class=\"language-text\">node_modules</code>/</a>\n版权：本作品采用<a href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\">「署名-非商业性使用-相同方式共享 4.0 国际」</a>许可协议进行许可。\n声明：转载请注明出处！</p>\n</blockquote>","frontmatter":{"title":"A Rollover Scene Caused By `node_modules`","date":"August 28, 2020","update":"April 12, 2022","url":"https://github.com/shanejix/shanejix.github.io/issues/32"}}},"pageContext":{"slug":"/A Rollover Scene Caused By `node_modules`/","previous":{"fields":{"slug":"/Good Git Commit Message/"},"frontmatter":{"title":"Good Git Commit Message","tags":["Git"]}},"next":{"fields":{"slug":"/如何使用 JavaScript 实现二叉树，二叉平衡树和红黑树/"},"frontmatter":{"title":"如何使用 JavaScript 实现二叉树，二叉平衡树和红黑树","tags":["Datastructure"]}}}},"staticQueryHashes":["3159585216","63159454"]}