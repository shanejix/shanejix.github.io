{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/使用 Github Action 将 Gatsby 站点部署到 Github Pages/","result":{"data":{"site":{"siteMetadata":{"title":"shanejix","description":"learner && coder"}},"allMarkdownRemark":{"edges":[{"node":{"id":"9dd4013c-c308-552c-bd2c-04f0cd996599","timeToRead":5}},{"node":{"id":"d29bf37d-75f0-501e-92b1-42c06cdbcd7b","timeToRead":3}},{"node":{"id":"89619e78-eeef-5342-b7fe-7626ee925f57","timeToRead":9}},{"node":{"id":"cb3a4052-202e-5a46-bf15-4e9b30e34ebf","timeToRead":3}},{"node":{"id":"45c6b07a-fc6a-5800-9907-86a94c1f4ace","timeToRead":2}},{"node":{"id":"db38bc53-9935-56f0-a9e2-0be373990d78","timeToRead":3}},{"node":{"id":"1dcfd849-d044-5c73-b31a-5fd30393f430","timeToRead":14}},{"node":{"id":"7b38ed3c-4032-581a-aab4-bda6dcb8fa78","timeToRead":15}},{"node":{"id":"d15e9143-f799-527d-b71d-2b8fc195817c","timeToRead":12}},{"node":{"id":"ba521381-a518-5686-a682-0ada55a7dd73","timeToRead":4}},{"node":{"id":"ba58ecad-907f-5ad2-bc26-9167d7607dcc","timeToRead":12}},{"node":{"id":"08b71346-abf3-5649-84f5-2f8ae4f48c6a","timeToRead":3}},{"node":{"id":"da55e002-3a8a-5af2-929e-4de7e3a8d314","timeToRead":4}},{"node":{"id":"4e56b6de-c0ca-572e-9f9d-e769592aa49b","timeToRead":2}},{"node":{"id":"af002700-632d-547f-82b9-f31919d4f03e","timeToRead":1}},{"node":{"id":"7b6d671f-8de2-5511-91e9-0797db813dc7","timeToRead":1}},{"node":{"id":"ad4fad45-b734-560c-8324-a9708e1e04c4","timeToRead":1}},{"node":{"id":"ef84ef13-dac8-5cfa-ac69-d0ea44f677f1","timeToRead":2}},{"node":{"id":"69026b7f-ca1c-5eea-8f61-76972396800c","timeToRead":2}},{"node":{"id":"52b13183-db66-5637-bc21-c828b8dabddd","timeToRead":8}},{"node":{"id":"14bde951-d8e7-5045-84f7-dd9479cfafc3","timeToRead":35}},{"node":{"id":"aa4d72c6-d675-52e4-a55b-b07237ed0e1a","timeToRead":2}},{"node":{"id":"eb631c0f-69a5-5ca8-b3c7-1baaed014eea","timeToRead":1}},{"node":{"id":"684d2035-e385-577d-bb53-f7bfca2caa0d","timeToRead":18}},{"node":{"id":"a40d34f8-b202-5f5b-8c33-19c7c163bbce","timeToRead":5}},{"node":{"id":"afc44728-7e4f-5ce3-bf62-373400a8a46a","timeToRead":12}},{"node":{"id":"ca3cc4cf-0ddf-5fb3-a58d-2354b2f0a10e","timeToRead":5}},{"node":{"id":"fe7fd5be-04af-5d1a-b969-f8f4de7db655","timeToRead":1}},{"node":{"id":"fb3bc99d-cf2f-5fbd-981d-1d701815f87b","timeToRead":66}},{"node":{"id":"4de1fb79-73c7-5593-adc3-427351c465e9","timeToRead":101}},{"node":{"id":"9a102758-e412-5f31-8753-54534e8fdb15","timeToRead":1}},{"node":{"id":"a07217e5-4cbe-54e4-9566-2a0df732a1a4","timeToRead":1}},{"node":{"id":"c8a73065-3214-5616-93f3-0df2a119e91d","timeToRead":1}}]},"markdownRemark":{"id":"aa4d72c6-d675-52e4-a55b-b07237ed0e1a","excerpt":"同步链接: https://www.shanejix.com/posts/使用 Github Action 将 Gatsby 站点部署到 Github Pages/ 个人博客是基于 Gatsby 搭建的，之前已经利用 Github Action 部署在 Netlify 和 Vercel 上。本着不浪费 xxx…","html":"<blockquote>\n<p>同步链接: <a href=\"https://www.shanejix.com/posts/%E4%BD%BF%E7%94%A8%20Github%20Action%20%E5%B0%86%20Gatsby%20%E7%AB%99%E7%82%B9%E9%83%A8%E7%BD%B2%E5%88%B0%20Github%20Pages/\">https://www.shanejix.com/posts/使用 Github Action 将 Gatsby 站点部署到 Github Pages/</a></p>\n</blockquote>\n<p>个人博客是基于 Gatsby 搭建的，之前已经利用 Github Action 部署在 Netlify 和 Vercel 上。本着不浪费 xxx.github.io 这个域。这次把 build 好的构建产物直接推到 gh-pages 分支</p>\n<h2>背景</h2>\n<p>由于 blog 源码和 构建产物可能不在同一个仓库，因此可能出现两种情形。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1.源码和构建产物共用一个仓库，分别对应不同的分支（master和gh-pages）</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2.源码和构建产物分别在不同的仓库，分别对应不同仓库的不同分支的分支\n\n- person-blog 的 master 对应blog源码\n\n- xx.github.io 的 master 或者 gh-pages 对应源码的构建产物</code></pre></div>\n<p>情况一必须开源，情况二多了更多的可能，当然我是第二种情况</p>\n<h2>准备</h2>\n<ol>\n<li>生成 access tokens</li>\n</ol>\n<blockquote>\n<p>Tokens you have generated that can be used to access the <a href=\"https://docs.github.com/\">GitHub API</a>.</p>\n</blockquote>\n<p>生成个人账号分配的 github api 权限列表的 token 待用。这里只生成了对开源仓库的操作权限</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/shanejix/images/How-To-Use-Github-Action-Publish-A-Gatsby-Site-To-Github-Pages/image-20210906143550906.png#crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;id=h8Ch7&#x26;originHeight=873&#x26;originWidth=1281&#x26;originalType=binary&#x26;ratio=1&#x26;rotation=0&#x26;showTitle=false&#x26;status=done&#x26;style=none&#x26;title=\"></p>\n<ol start=\"2\">\n<li>在 xx.github.io 的 secret 中填入 acess token name 对应 secret name 待用，value 对应 access token</li>\n</ol>\n<p><img src=\"https://cdn.jsdelivr.net/gh/shanejix/images/How-To-Use-Github-Action-Publish-A-Gatsby-Site-To-Github-Pages/image-20210906144649976.png#crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;id=nw71n&#x26;originHeight=1117&#x26;originWidth=2429&#x26;originalType=binary&#x26;ratio=1&#x26;rotation=0&#x26;showTitle=false&#x26;status=done&#x26;style=none&#x26;title=\"></p>\n<ol start=\"3\">\n<li>在源码仓库新建 github action 的 workflow</li>\n</ol>\n<p><img src=\"https://cdn.jsdelivr.net/gh/shanejix/images/How-To-Use-Github-Action-Publish-A-Gatsby-Site-To-Github-Pages/image-20210906183635607.png#crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;id=JdY0e&#x26;originHeight=1192&#x26;originWidth=2144&#x26;originalType=binary&#x26;ratio=1&#x26;rotation=0&#x26;showTitle=false&#x26;status=done&#x26;style=none&#x26;title=\"></p>\n<h2>workflow</h2>\n<p>这里直接在<a href=\"https://github.com/marketplace?type=actions\">GitHub Action Marketplace</a> 市场中找到了 <a href=\"%5BGatsby%20Publish%20%C2%B7%20Actions%20%C2%B7%20GitHub%20Marketplace%5D(https://github.com/marketplace/actions/gatsby-publish)\">Gatsby Publish</a>，修改后的模板如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> enriikke/gatsby<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>action@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">access-token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ACCESS_GITHUB_API_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> // 自定义 scret name\n          <span class=\"token key atrule\">deploy-branch</span><span class=\"token punctuation\">:</span> master\n          <span class=\"token key atrule\">deploy-repo</span><span class=\"token punctuation\">:</span> shanejix.github.io // 注意这里直接是仓库名称</code></pre></div>\n<p>当然后续可以增加更多可定制的功能例如直接推到 gitee 或者 自己的服务器上</p>\n<blockquote>\n<p>作者：<a href=\"https://www.shanejix.com/\">shanejix</a>\n出处：<a href=\"https://www.shanejix.com/posts/%E4%BD%BF%E7%94%A8%20Github%20Action%20%E5%B0%86%20Gatsby%20%E7%AB%99%E7%82%B9%E9%83%A8%E7%BD%B2%E5%88%B0%20Github%20Pages/\">https://www.shanejix.com/posts/使用 Github Action 将 Gatsby 站点部署到 Github Pages/</a>\n版权：本作品采用<a href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\">「署名-非商业性使用-相同方式共享 4.0 国际」</a>许可协议进行许可。\n声明：转载请注明出处！</p>\n</blockquote>","frontmatter":{"title":"使用 Github Action 将 Gatsby 站点部署到 Github Pages","date":"September 06, 2021","update":"April 12, 2022","url":"https://github.com/shanejix/shanejix.github.io/issues/51"}}},"pageContext":{"slug":"/使用 Github Action 将 Gatsby 站点部署到 Github Pages/","previous":{"fields":{"slug":"/从 0 到 1 入门动态规划/"},"frontmatter":{"title":"从 0 到 1 入门动态规划","tags":["Algorithm","LeetCode"]}},"next":{"fields":{"slug":"/Web 站点动态主题切换实现/"},"frontmatter":{"title":"Web 站点动态主题切换实现","tags":["CSS"]}}}},"staticQueryHashes":["3159585216","63159454"]}