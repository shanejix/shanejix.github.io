{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/Promise å¿…çŸ¥å¿…ä¼š/","result":{"data":{"site":{"siteMetadata":{"title":"shanejix","description":"learner && coder"}},"allMarkdownRemark":{"edges":[{"node":{"id":"9dd4013c-c308-552c-bd2c-04f0cd996599","timeToRead":5}},{"node":{"id":"d29bf37d-75f0-501e-92b1-42c06cdbcd7b","timeToRead":3}},{"node":{"id":"89619e78-eeef-5342-b7fe-7626ee925f57","timeToRead":9}},{"node":{"id":"cb3a4052-202e-5a46-bf15-4e9b30e34ebf","timeToRead":3}},{"node":{"id":"45c6b07a-fc6a-5800-9907-86a94c1f4ace","timeToRead":2}},{"node":{"id":"db38bc53-9935-56f0-a9e2-0be373990d78","timeToRead":3}},{"node":{"id":"1dcfd849-d044-5c73-b31a-5fd30393f430","timeToRead":14}},{"node":{"id":"7b38ed3c-4032-581a-aab4-bda6dcb8fa78","timeToRead":15}},{"node":{"id":"d15e9143-f799-527d-b71d-2b8fc195817c","timeToRead":12}},{"node":{"id":"ba521381-a518-5686-a682-0ada55a7dd73","timeToRead":4}},{"node":{"id":"ba58ecad-907f-5ad2-bc26-9167d7607dcc","timeToRead":12}},{"node":{"id":"08b71346-abf3-5649-84f5-2f8ae4f48c6a","timeToRead":3}},{"node":{"id":"da55e002-3a8a-5af2-929e-4de7e3a8d314","timeToRead":4}},{"node":{"id":"4e56b6de-c0ca-572e-9f9d-e769592aa49b","timeToRead":2}},{"node":{"id":"af002700-632d-547f-82b9-f31919d4f03e","timeToRead":1}},{"node":{"id":"7b6d671f-8de2-5511-91e9-0797db813dc7","timeToRead":1}},{"node":{"id":"ad4fad45-b734-560c-8324-a9708e1e04c4","timeToRead":1}},{"node":{"id":"ef84ef13-dac8-5cfa-ac69-d0ea44f677f1","timeToRead":2}},{"node":{"id":"69026b7f-ca1c-5eea-8f61-76972396800c","timeToRead":2}},{"node":{"id":"52b13183-db66-5637-bc21-c828b8dabddd","timeToRead":8}},{"node":{"id":"14bde951-d8e7-5045-84f7-dd9479cfafc3","timeToRead":35}},{"node":{"id":"aa4d72c6-d675-52e4-a55b-b07237ed0e1a","timeToRead":2}},{"node":{"id":"eb631c0f-69a5-5ca8-b3c7-1baaed014eea","timeToRead":1}},{"node":{"id":"684d2035-e385-577d-bb53-f7bfca2caa0d","timeToRead":18}},{"node":{"id":"a40d34f8-b202-5f5b-8c33-19c7c163bbce","timeToRead":5}},{"node":{"id":"afc44728-7e4f-5ce3-bf62-373400a8a46a","timeToRead":12}},{"node":{"id":"ca3cc4cf-0ddf-5fb3-a58d-2354b2f0a10e","timeToRead":5}},{"node":{"id":"fe7fd5be-04af-5d1a-b969-f8f4de7db655","timeToRead":1}},{"node":{"id":"fb3bc99d-cf2f-5fbd-981d-1d701815f87b","timeToRead":66}},{"node":{"id":"4de1fb79-73c7-5593-adc3-427351c465e9","timeToRead":101}},{"node":{"id":"9a102758-e412-5f31-8753-54534e8fdb15","timeToRead":1}},{"node":{"id":"a07217e5-4cbe-54e4-9566-2a0df732a1a4","timeToRead":1}},{"node":{"id":"c8a73065-3214-5616-93f3-0df2a119e91d","timeToRead":1}}]},"markdownRemark":{"id":"1dcfd849-d044-5c73-b31a-5fd30393f430","excerpt":"åŒæ­¥é“¾æ¥: https://www.shanejix.com/posts/Promise å¿…çŸ¥å¿…ä¼š/ å›è°ƒ ğŸš© å¼‚æ­¥ è¡Œä¸ºï¼ˆactionï¼‰ï¼šç°åœ¨å¼€å§‹æ‰§è¡Œçš„è¡Œä¸ºï¼Œä½†å®ƒä»¬ä¼šåœ¨ç¨åå®Œæˆï¼ˆä¾‹å¦‚ï¼ŒsetTimeoutâ€¦","html":"<blockquote>\n<p>åŒæ­¥é“¾æ¥: <a href=\"https://www.shanejix.com/posts/Promise%20%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/\">https://www.shanejix.com/posts/Promise å¿…çŸ¥å¿…ä¼š/</a></p>\n</blockquote>\n<h2>å›è°ƒ</h2>\n<p>ğŸš© å¼‚æ­¥ è¡Œä¸ºï¼ˆactionï¼‰ï¼šç°åœ¨å¼€å§‹æ‰§è¡Œçš„è¡Œä¸ºï¼Œä½†å®ƒä»¬ä¼šåœ¨ç¨åå®Œæˆï¼ˆä¾‹å¦‚ï¼ŒsetTimeout å‡½æ•°å°±æ˜¯ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼›ä¾‹å¦‚åŠ è½½è„šæœ¬å’Œæ¨¡å—ï¼‰</p>\n<p>å®é™…ä¸­çš„å¼‚æ­¥è¡Œä¸ºçš„ç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * ä½¿ç”¨ç»™å®šçš„ src åŠ è½½è„šæœ¬\n * @param src\n **/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ª &lt;script> æ ‡ç­¾ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°é¡µé¢</span>\n  <span class=\"token comment\">// è¿™å°†ä½¿å¾—å…·æœ‰ç»™å®š src çš„è„šæœ¬å¼€å§‹åŠ è½½ï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåè¿è¡Œ</span>\n  <span class=\"token keyword\">let</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> src<span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å¯ä»¥åƒè¿™æ ·ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// åœ¨ç»™å®šè·¯å¾„ä¸‹åŠ è½½å¹¶æ‰§è¡Œè„šæœ¬</span>\n<span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/my/script.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// loadScript ä¸‹é¢çš„ä»£ç </span>\n<span class=\"token comment\">// ä¸ä¼šç­‰åˆ°è„šæœ¬åŠ è½½å®Œæˆæ‰æ‰§è¡Œ</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// ğŸ’¡è„šæœ¬æ˜¯â€œå¼‚æ­¥â€è°ƒç”¨çš„ï¼Œå› ä¸ºå®ƒä»ç°åœ¨å¼€å§‹åŠ è½½ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªåŠ è½½å‡½æ•°æ‰§è¡Œå®Œæˆåæ‰è¿è¡Œã€‚å¦‚æœåœ¨ loadScript(â€¦) ä¸‹é¢æœ‰ä»»ä½•å…¶ä»–ä»£ç ï¼Œå®ƒä»¬ä¸ä¼šç­‰åˆ°è„šæœ¬åŠ è½½å®Œæˆæ‰æ‰§è¡Œ</span></code></pre></div>\n<p>å‡è®¾éœ€è¦åœ¨æ–°è„šæœ¬åŠ è½½åç«‹å³ä½¿ç”¨å®ƒï¼Œè¿™å°†ä¸ä¼šæœ‰æ•ˆï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/my/script.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è¿™ä¸ªè„šæœ¬æœ‰ \"function newFunction() {â€¦}\"</span>\n\n<span class=\"token function\">newFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼</span></code></pre></div>\n<p>ğŸ˜­ åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒloadScript å‡½æ•°å¹¶æ²¡æœ‰æä¾›è·Ÿè¸ªåŠ è½½å®Œæˆçš„æ–¹æ³•ã€‚è„šæœ¬åŠ è½½å¹¶æœ€ç»ˆè¿è¡Œï¼Œä»…æ­¤è€Œå·²ã€‚ä½†æ˜¯å¸Œæœ›äº†è§£è„šæœ¬ä½•æ—¶åŠ è½½å®Œæˆï¼Œä»¥ä½¿ç”¨å…¶ä¸­çš„æ–°å‡½æ•°å’Œå˜é‡</p>\n<p>ğŸ’¡ æ·»åŠ ä¸€ä¸ª callback å‡½æ•°ä½œä¸º loadScript çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°åº”åœ¨è„šæœ¬åŠ è½½å®Œæˆæ—¶æ‰§è¡Œï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">src<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> src<span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// åœ¨è„šæœ¬åŠ è½½å®Œæˆåï¼Œå›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œ</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Cool, the script </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>script<span class=\"token punctuation\">.</span>src<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is loaded</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ‰€åŠ è½½çš„è„šæœ¬ä¸­å£°æ˜çš„å‡½æ•°</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>â€<code class=\"language-text\">''è¿™å°±æ˜¯è¢«ç§°ä¸ºâ€œåŸºäºå›è°ƒâ€çš„å¼‚æ­¥ç¼–ç¨‹é£æ ¼''</code>â€:å¼‚æ­¥æ‰§è¡ŒæŸé¡¹åŠŸèƒ½çš„å‡½æ•°åº”è¯¥æä¾›ä¸€ä¸ª callback å‚æ•°ç”¨äºåœ¨ç›¸åº”äº‹ä»¶å®Œæˆæ—¶è°ƒç”¨</p>\n<p>ğŸš© å›è°ƒåœ°ç‹±</p>\n<p>å¦‚ä½•ä¾æ¬¡åŠ è½½ä¸¤ä¸ªè„šæœ¬ï¼šç¬¬ä¸€ä¸ªï¼Œç„¶åæ˜¯ç¬¬äºŒä¸ªï¼Ÿç¬¬ä¸‰ä¸ªï¼Ÿ</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/my/script.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/my/script2.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/my/script3.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...åŠ è½½å®Œæ‰€æœ‰è„šæœ¬åç»§ç»­</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>åŠ å…¥å¤„ç† Errorï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"3.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ...åŠ è½½å®Œæ‰€æœ‰è„šæœ¬åç»§ç»­ (*)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>è¿™å°±æ˜¯è‘—åçš„â€œ<code class=\"language-text\">''å›è°ƒåœ°ç‹±''</code>â€æˆ–â€œå„è¿é‡‘å­—å¡”â€</p>\n<p>ğŸ’¡ å¯ä»¥é€šè¿‡ä½¿æ¯ä¸ªè¡Œä¸ºéƒ½æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°æ¥å°è¯•å‡è½»è¿™ç§é—®é¢˜</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.js\"</span><span class=\"token punctuation\">,</span> step1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">step1</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2.js\"</span><span class=\"token punctuation\">,</span> step2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">step2</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"3.js\"</span><span class=\"token punctuation\">,</span> step3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">step3</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...åŠ è½½å®Œæ‰€æœ‰è„šæœ¬åç»§ç»­ (*)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä¼˜ç¼ºç‚¹</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- æ²¡æœ‰æ·±å±‚çš„åµŒå¥—ï¼Œç‹¬ç«‹ä¸ºé¡¶å±‚å‡½æ•°\n\n- å¯è¯»æ€§å·®\n\n- æ²¡æœ‰é‡ç”¨</code></pre></div>\n<p>æœ€å¥½çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ â€œ<code class=\"language-text\">''promise''</code>â€</p>\n<h2>Promise</h2>\n<p>ğŸš© è¯­æ³•</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// executor</span>\n  <span class=\"token comment\">// å½“ promise è¢«æ„é€ å®Œæˆæ—¶ï¼Œexecutorè‡ªåŠ¨æ‰§è¡Œæ­¤å‡½æ•°</span>\n  <span class=\"token comment\">// executor é€šå¸¸æ˜¯å¼‚æ­¥ä»»åŠ¡</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// handler</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token number\">1.</span>å½“ <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span> è¢«åˆ›å»ºï¼Œexecutor è¢«è‡ªåŠ¨ä¸”ç«‹å³è°ƒç”¨\n\n<span class=\"token number\">2.</span>ç”± <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span> æ„é€ å™¨è¿”å›çš„ promise å¯¹è±¡å…·æœ‰ä»¥ä¸‹ã€å†…éƒ¨å±æ€§ã€‘\n\n    <span class=\"token operator\">-</span> state â€” æœ€åˆæ˜¯ <span class=\"token string\">\"pending\"</span>ï¼Œç„¶ååœ¨ resolve è¢«è°ƒç”¨æ—¶å˜ä¸º <span class=\"token string\">\"fulfilled\"</span>ï¼Œæˆ–è€…åœ¨ reject è¢«è°ƒç”¨æ—¶å˜ä¸º <span class=\"token string\">\"rejected\"</span>\n\n    <span class=\"token operator\">-</span> result â€” æœ€åˆæ˜¯ <span class=\"token keyword\">undefined</span>ï¼Œç„¶ååœ¨ <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> è¢«è°ƒç”¨æ—¶å˜ä¸º valueï¼Œæˆ–è€…åœ¨ <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> è¢«è°ƒç”¨æ—¶å˜ä¸º error\n\n<span class=\"token number\">3.</span>ä¸æœ€åˆçš„ â€œpendingâ€ promise ç›¸åï¼Œä¸€ä¸ª resolved æˆ– rejected çš„ promise éƒ½ä¼šè¢«ç§°ä¸º â€œsettledâ€\n\n<span class=\"token number\">4.</span>executor åªèƒ½è°ƒç”¨ä¸€ä¸ª resolve æˆ–ä¸€ä¸ª rejectï¼›ä»»ä½•çŠ¶æ€çš„æ›´æ”¹éƒ½æ˜¯æœ€ç»ˆçš„ï¼ˆä¸å¯é€†ï¼‰</code></pre></div>\n<p>ğŸš© ç«‹å³ resolve/reject çš„ Promise</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// executor é€šå¸¸æ˜¯å¼‚æ­¥æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´åè°ƒç”¨ resolve/rejectï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ï¼›è¿˜å¯ä»¥ç«‹å³è°ƒç”¨ resolve æˆ– reject</span>\n\n<span class=\"token comment\">// ğŸ’¡å½“å¼€å§‹åšä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œä½†éšåçœ‹åˆ°ä¸€åˆ‡éƒ½å·²ç»å®Œæˆå¹¶å·²è¢«ç¼“å­˜æ—¶ï¼Œå¯èƒ½å°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚è¿™æŒºå¥½ğŸ˜€</span>\n\n<span class=\"token keyword\">let</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ä¸èŠ±æ—¶é—´å»åšè¿™é¡¹å·¥ä½œ</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">123</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç«‹å³ç»™å‡ºç»“æœï¼š123</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ğŸš© ç¤ºä¾‹ï¼šåŠ è½½è„šæœ¬çš„ loadScript å‡½æ•°</p>\n<p>åŸºäºå›è°ƒå‡½æ•°çš„å˜ä½“ç‰ˆæœ¬ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">src<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> src<span class=\"token punctuation\">;</span>\n\n  script<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Script load error for </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>src<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ç”¨æ³•ï¼š</span>\n\n<span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">script</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// åœ¨è„šæœ¬åŠ è½½å®Œæˆåï¼Œå›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œ</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>script<span class=\"token punctuation\">.</span>src<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is loaded!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>ï¼›\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span> _ <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ‰€åŠ è½½çš„è„šæœ¬ä¸­å£°æ˜çš„å‡½æ•°</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>åŸºäº Promise é‡å†™çš„ç‰ˆæœ¬ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    script<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> src<span class=\"token punctuation\">;</span>\n\n    script<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    script<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Script load error for </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>src<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ç”¨æ³•ï¼š</span>\n\n<span class=\"token keyword\">let</span> promise <span class=\"token operator\">=</span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js\"</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>script<span class=\"token punctuation\">.</span>src<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is loaded!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Another handler...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Promise é“¾</h2>\n<p>ğŸš©Promise é“¾ï¼šå›å¿†å›è°ƒä¸­ï¼Œä½•ä¾æ¬¡åŠ è½½ä¸¤ä¸ªè„šæœ¬ï¼šç¬¬ä¸€ä¸ªï¼Œç„¶åæ˜¯ç¬¬äºŒä¸ªï¼Ÿç¬¬ä¸‰ä¸ªï¼Ÿ</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ğŸ’¡Promise æä¾›äº†ä¸€äº›æ–¹æ¡ˆæ¥åšåˆ°è¿™ä¸€ç‚¹ï¼šPromise é“¾</span>\n\n<span class=\"token comment\">// like this</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (*)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// (**)</span>\n\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\n    <span class=\"token keyword\">return</span> result <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// (***)</span>\n\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n    <span class=\"token keyword\">return</span> result <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4</span>\n    <span class=\"token keyword\">return</span> result <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ğŸ“Œä¸ºä»€ä¹ˆå¯ä»¥ï¼Ÿå› ä¸ºå¯¹ promise.then çš„è°ƒç”¨ä¼šè¿”å›äº†ä¸€ä¸ª promiseï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¹‹ä¸Šè°ƒç”¨ä¸‹ä¸€ä¸ª .then</span>\n\n<span class=\"token comment\">// å½“å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰è¿”å›ä¸€ä¸ªå€¼æ—¶ï¼Œå®ƒå°†æˆä¸ºè¯¥ promise çš„ resultï¼Œæ‰€ä»¥å°†ä½¿ç”¨å®ƒè°ƒç”¨ä¸‹ä¸€ä¸ª .then</span>\n\n<span class=\"token comment\">// ğŸ’£''æ–°æ‰‹å¸¸çŠ¯çš„ä¸€ä¸ªç»å…¸é”™è¯¯ï¼šä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å¤šä¸ª .then æ·»åŠ åˆ°ä¸€ä¸ª promise ä¸Šã€‚ä½†è¿™å¹¶ä¸æ˜¯ promise é“¾ï¼ˆchainingï¼‰''</span>\n\n<span class=\"token keyword\">let</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\n  <span class=\"token keyword\">return</span> result <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\n  <span class=\"token keyword\">return</span> result <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\n  <span class=\"token keyword\">return</span> result <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ğŸ’¡è¿™é‡Œæ‰€åšçš„åªæ˜¯ä¸€ä¸ª promise çš„å‡ ä¸ªå¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ã€‚å®ƒä»¬ä¸ä¼šç›¸äº’ä¼ é€’ resultï¼›ç›¸åï¼Œå®ƒä»¬ä¹‹é—´å½¼æ­¤ç‹¬ç«‹è¿è¡Œå¤„ç†ä»»åŠ¡</span></code></pre></div>\n<p>ğŸš© è¿”å› promise</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- .then(handler) ä¸­æ‰€ä½¿ç”¨çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰å¯ä»¥åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª promise\n\n- åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰å°†ã€ç­‰å¾…å®ƒ settled åå†è·å¾—å…¶ç»“æœï¼ˆresultï¼‰ã€‘</code></pre></div>\n<p>ç¤ºä¾‹ï¼špromise åŒ–çš„ loadScript</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/one.js\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/two.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/three.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">script</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// è„šæœ¬åŠ è½½å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™å„¿ä½¿ç”¨è„šæœ¬ä¸­å£°æ˜çš„å‡½æ•°</span>\n    <span class=\"token function\">one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">two</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">three</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ğŸ’¡æ³¨æ„ï¼šè¿™å„¿æ¯ä¸ª loadScript è°ƒç”¨éƒ½è¿”å›ä¸€ä¸ª promiseï¼Œå¹¶ä¸”åœ¨å®ƒ resolve æ—¶ä¸‹ä¸€ä¸ª .then å¼€å§‹è¿è¡Œã€‚ç„¶åï¼Œå®ƒå¯åŠ¨ä¸‹ä¸€ä¸ªè„šæœ¬çš„åŠ è½½ã€‚æ‰€ä»¥ï¼Œè„šæœ¬æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°åŠ è½½çš„</span>\n\n<span class=\"token comment\">// ğŸ’¡å¹¶ä¸”ä»£ç ä»ç„¶æ˜¯â€œæ‰å¹³â€çš„ â€” å®ƒå‘ä¸‹å¢é•¿ï¼Œè€Œä¸æ˜¯å‘å³</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// ä»æŠ€æœ¯ä¸Šè®²ï¼Œå¯ä»¥å‘æ¯ä¸ª loadScript ç›´æ¥æ·»åŠ  .thenï¼Œå°±åƒè¿™æ ·ï¼š</span>\n\n<span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/one.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">script1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/two.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">script2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/three.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">script3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// æ­¤å‡½æ•°å¯ä»¥è®¿é—®å˜é‡ script1ï¼Œscript2 å’Œ script3</span>\n      <span class=\"token function\">one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">two</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">three</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ğŸ’¡è¿™æ®µä»£ç åšäº†ç›¸åŒçš„äº‹å„¿ï¼šæŒ‰é¡ºåºåŠ è½½ 3 ä¸ªè„šæœ¬ã€‚ä½†å®ƒæ˜¯â€œå‘å³å¢é•¿â€çš„ã€‚æ‰€ä»¥ä¼šæœ‰å’Œä½¿ç”¨å›è°ƒå‡½æ•°ä¸€æ ·çš„é—®é¢˜</span>\n\n<span class=\"token comment\">// ğŸ‘åˆšå¼€å§‹ä½¿ç”¨ promise çš„äººå¯èƒ½ä¸çŸ¥é“ promise é“¾ï¼Œæ‰€ä»¥ä»–ä»¬å°±è¿™æ ·å†™äº†ã€‚é€šå¸¸ï¼Œé“¾å¼æ˜¯é¦–é€‰</span></code></pre></div>\n<h2>Thenables</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- ç¡®åˆ‡åœ°è¯´ï¼Œå¤„ç†ç¨‹åºï¼ˆhandlerï¼‰è¿”å›çš„ä¸å®Œå…¨æ˜¯ä¸€ä¸ª promiseï¼Œè€Œæ˜¯è¿”å›çš„è¢«ç§°ä¸º â€œthenableâ€ å¯¹è±¡ â€” ä¸€ä¸ªå…·æœ‰æ–¹æ³• .then çš„ä»»æ„å¯¹è±¡\n\n- thenableå¯¹è±¡ä¼šè¢«å½“åšä¸€ä¸ª promise æ¥å¯¹å¾…\n\n- è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œç¬¬ä¸‰æ–¹åº“å¯ä»¥å®ç°è‡ªå·±çš„â€œpromise å…¼å®¹ï¼ˆpromise-compatibleï¼‰â€å¯¹è±¡ï¼›å®ƒä»¬å¯ä»¥å…·æœ‰æ‰©å±•çš„æ–¹æ³•é›†ï¼Œä½†ä¹Ÿä¸åŸç”Ÿçš„ promise å…¼å®¹ï¼Œå› ä¸ºå®ƒä»¬å®ç°äº† .then æ–¹æ³•\n\n\n- è¿™ä¸ªç‰¹æ€§å…è®¸å°†è‡ªå®šä¹‰çš„å¯¹è±¡ä¸ promise é“¾é›†æˆåœ¨ä¸€èµ·ï¼Œè€Œä¸å¿…ç»§æ‰¿è‡ª Promise</code></pre></div>\n<p>ç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Thenable</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>num <span class=\"token operator\">=</span> num<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// function() { native code }</span>\n    <span class=\"token comment\">// 1 ç§’åä½¿ç”¨ this.num*2 è¿›è¡Œ resolve</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>num <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (**)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thenable</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (*)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1000ms åæ˜¾ç¤º 2</span></code></pre></div>\n<p>ğŸš© ä½œä¸ºä¸€ä¸ªå¥½çš„åšæ³•ï¼šå¼‚æ­¥è¡Œä¸ºåº”è¯¥å§‹ç»ˆè¿”å›ä¸€ä¸ª promise</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- è¿™æ ·å°±å¯ä»¥ä½¿å¾—ä¹‹åè®¡åˆ’åç»­çš„è¡Œä¸ºæˆä¸ºå¯èƒ½\n\n- å³ä½¿ç°åœ¨ä¸æ‰“ç®—å¯¹é“¾è¿›è¡Œæ‰©å±•ï¼Œä½†ä¹‹åå¯èƒ½ä¼šéœ€è¦</code></pre></div>\n<p>ç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">loadJson</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">loadGithubUser</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://api.github.com/users/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">showAvatar</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">githubUser</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> img <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    img<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> githubUser<span class=\"token punctuation\">.</span>avatar_url<span class=\"token punctuation\">;</span>\n    img<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"promise-avatar-example\"</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      img<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>githubUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ä½¿ç”¨å®ƒä»¬ï¼š</span>\n<span class=\"token function\">loadJson</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/user.json\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">loadGithubUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>showAvatar<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">githubUser</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Finished showing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>githubUser<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<h2>é”™è¯¯å¤„ç†</h2>\n<p>ğŸš©Promise é“¾åœ¨é”™è¯¯ï¼ˆerrorï¼‰å¤„ç†</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- å½“ä¸€ä¸ª promise è¢« reject æ—¶ï¼Œæ§åˆ¶æƒå°†ç§»äº¤è‡³æœ€è¿‘çš„ rejection å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰;è¿™åœ¨å®é™…å¼€å‘ä¸­éå¸¸æ–¹ä¾¿\n\n- .catch ä¸å¿…æ˜¯ç«‹å³çš„;å®ƒå¯èƒ½åœ¨ä¸€ä¸ªæˆ–å¤šä¸ª .then ä¹‹åå‡ºç°</code></pre></div>\n<p>ç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/article/promise-chaining/user.json\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://api.github.com/users/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">githubUser</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> img <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        img<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> githubUser<span class=\"token punctuation\">.</span>avatar_url<span class=\"token punctuation\">;</span>\n        img<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"promise-avatar-example\"</span><span class=\"token punctuation\">;</span>\n        document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          img<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>githubUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ğŸš© éšå¼ tryâ€¦catch</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- Promise çš„æ‰§è¡Œè€…ï¼ˆexecutorï¼‰å’Œ promise çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰å‘¨å›´æœ‰ä¸€ä¸ªâ€œéšå¼çš„ try..catchâ€\n\n- å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå®ƒï¼ˆè¯‘æ³¨ï¼šæŒ‡å¼‚å¸¸ï¼‰å°±ä¼šè¢«æ•è·ï¼Œå¹¶è¢«è§†ä¸º rejection è¿›è¡Œå¤„ç†</code></pre></div>\n<p>ç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// excutor ä¸­</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whoops!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error: Whoops!</span>\n\n<span class=\"token comment\">// ç­‰åŒäº</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whoops!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error: Whoops!</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// handler ä¸­</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ok\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whoops!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// reject è¿™ä¸ª promise</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error: Whoops!</span></code></pre></div>\n<p>ğŸš© å†æ¬¡æŠ›å‡ºï¼ˆRethrowingï¼‰</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- å¦‚æœåœ¨ .catch ä¸­ throwï¼Œé‚£ä¹ˆæ§åˆ¶æƒå°±ä¼šè¢«ç§»äº¤åˆ°ä¸‹ä¸€ä¸ªæœ€è¿‘çš„ error å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ã€‚å¦‚æœå¤„ç†è¯¥ error å¹¶æ­£å¸¸å®Œæˆï¼Œé‚£ä¹ˆå®ƒå°†ç»§ç»­åˆ°æœ€è¿‘çš„æˆåŠŸçš„ .then å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// æ‰§è¡Œæµï¼šcatch -> then</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whoops!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"The error is handled, continue normally\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Next successful handler runs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// æ‰§è¡Œæµï¼šcatch -> catch</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whoops!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// (*)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">URIError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// å¤„ç†å®ƒ</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Can't handle such error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">throw</span> error<span class=\"token punctuation\">;</span> <span class=\"token comment\">// å†æ¬¡æŠ›å‡ºæ­¤ error æˆ–å¦å¤–ä¸€ä¸ª errorï¼Œæ‰§è¡Œå°†è·³è½¬è‡³ä¸‹ä¸€ä¸ª catch</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ä¸åœ¨è¿™é‡Œè¿è¡Œ */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// (**)</span>\n\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">The unknown error has occurred: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ä¸ä¼šè¿”å›ä»»ä½•å†…å®¹ => æ‰§è¡Œæ­£å¸¸è¿›è¡Œ</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ğŸš© æœªå¤„ç†çš„ rejection</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">noSuchFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è¿™é‡Œå‡ºç° errorï¼ˆæ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼‰</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ä¸€ä¸ªæˆ–å¤šä¸ªæˆåŠŸçš„ promise å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å°¾ç«¯æ²¡æœ‰ .catchï¼</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// å½“ä¸€ä¸ª error æ²¡æœ‰è¢«å¤„ç†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span>\n\n<span class=\"token comment\">// ğŸ’¡å¦‚æœå‡ºç° errorï¼Œpromise çš„çŠ¶æ€å°†å˜ä¸º â€œrejectedâ€ï¼Œç„¶åæ‰§è¡Œåº”è¯¥è·³è½¬è‡³æœ€è¿‘çš„ rejection å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ã€‚ä½†æ˜¯ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­å¹¶æ²¡æœ‰è¿™æ ·çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ã€‚å› æ­¤ error ä¼šâ€œå¡ä½ï¼ˆstuckï¼‰â€ã€‚æ²¡æœ‰ä»£ç æ¥å¤„ç†å®ƒ</span>\n\n<span class=\"token comment\">// åœ¨å®é™…å¼€å‘ä¸­ï¼Œå°±åƒä»£ç ä¸­å¸¸è§„çš„æœªå¤„ç†çš„ error ä¸€æ ·ï¼Œè¿™æ„å‘³ç€æŸäº›ä¸œè¥¿å‡ºäº†é—®é¢˜</span>\n\n<span class=\"token comment\">// å½“å‘ç”Ÿä¸€ä¸ªå¸¸è§„çš„é”™è¯¯ï¼ˆerrorï¼‰å¹¶ä¸”æœªè¢« try..catch æ•è·æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè„šæœ¬æ­»äº†ï¼Œå¹¶åœ¨æ§åˆ¶å°ï¼ˆconsoleï¼‰ä¸­ç•™ä¸‹äº†ä¸€ä¸ªä¿¡æ¯ã€‚å¯¹äºåœ¨ promise ä¸­æœªè¢«å¤„ç†çš„ rejectionï¼Œä¹Ÿä¼šå‘ç”Ÿç±»ä¼¼çš„äº‹å„¿</span></code></pre></div>\n<p>JavaScript å¼•æ“ä¼šè·Ÿè¸ªæ­¤ç±» rejectionï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šç”Ÿæˆä¸€ä¸ªå…¨å±€çš„ error</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- åœ¨æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ unhandledrejection äº‹ä»¶æ¥æ•è·è¿™ç±» error</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unhandledrejection\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// è¿™ä¸ªäº‹ä»¶å¯¹è±¡æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>promise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [object Promise] - ç”Ÿæˆè¯¥å…¨å±€ error çš„ promise</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>reason<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error: Whoops! - æœªå¤„ç†çš„ error å¯¹è±¡</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whoops!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ²¡æœ‰ç”¨æ¥å¤„ç† error çš„ catch</span></code></pre></div>\n<h2>Promise API</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">åœ¨ Promise ç±»ä¸­ï¼Œæœ‰ 5 ç§é™æ€æ–¹æ³•\n\n- Promise.all([iterable])\n\n- Promise.allSettled([iterable])\n\n- Promise.race([iterable])\n\n- Promise.resolve()\n\n- Promise.reject()</code></pre></div>\n<p>ğŸš©Promise.all</p>\n<p>è¯­æ³•</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// æ¥å—ä¸€ä¸ª promise æ•°ç»„(å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£çš„)ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ promise</span>\n\n<span class=\"token keyword\">let</span> promise <span class=\"token operator\">=</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>iterable<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>æ³¨æ„</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- å¹¶è¡Œæ‰§è¡Œå¤šä¸ª promiseï¼Œå½“æ‰€æœ‰ç»™å®šçš„ promise éƒ½è¢« æˆåŠŸ æ—¶ï¼Œæ–°çš„ promise æ‰ä¼š resolveï¼Œå¹¶ä¸”å…¶ç»“æœæ•°ç»„å°†æˆä¸ºæ–°çš„ promise çš„ç»“æœ\n\n- ç»“æœæ•°ç»„ä¸­å…ƒç´ çš„é¡ºåºä¸å…¶åœ¨æº promise ä¸­çš„é¡ºåºç›¸åŒ(å³ä½¿ç¬¬ä¸€ä¸ª promise èŠ±è´¹äº†æœ€é•¿çš„æ—¶é—´)\n\n- å¦‚æœä»»æ„ä¸€ä¸ª promise è¢« rejectï¼Œç”± Promise.all è¿”å›çš„ promise å°±ä¼šç«‹å³ rejectï¼Œå¹¶ä¸”å¸¦æœ‰çš„å°±æ˜¯è¿™ä¸ª error</code></pre></div>\n<p>ğŸš© å¦‚æœå‡ºç° errorï¼Œå…¶ä»– promise å°†è¢«å¿½ç•¥</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- å¦‚æœå…¶ä¸­ä¸€ä¸ª promise è¢« rejectï¼ŒPromise.all å°±ä¼šç«‹å³è¢« rejectï¼Œå®Œå…¨å¿½ç•¥åˆ—è¡¨ä¸­å…¶ä»–çš„ promiseã€‚å®ƒä»¬çš„ç»“æœä¹Ÿè¢«å¿½ç•¥\n\n- ä¾‹å¦‚ï¼Œå¦‚æœæœ‰å¤šä¸ªåŒæ—¶è¿›è¡Œçš„ fetch è°ƒç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªå¤±è´¥ï¼Œå…¶ä»–çš„ fetch æ“ä½œä»ç„¶ä¼šç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯ Promise.all å°†ä¸ä¼šå†å…³å¿ƒï¼ˆwatchï¼‰å®ƒä»¬ã€‚å®ƒä»¬å¯èƒ½ä¼š settleï¼Œä½†æ˜¯å®ƒä»¬çš„ç»“æœå°†è¢«å¿½ç•¥\n\n- Promise.all æ²¡æœ‰é‡‡å–ä»»ä½•æªæ–½æ¥å–æ¶ˆå®ƒä»¬ï¼Œå› ä¸º promise ä¸­æ²¡æœ‰â€œå–æ¶ˆâ€çš„æ¦‚å¿µ</code></pre></div>\n<p>ğŸš©Promise.all(iterable) å…è®¸åœ¨ iterable ä¸­ä½¿ç”¨ non-promise çš„â€œå¸¸è§„â€å€¼</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// romise.all(...) æ¥å—å«æœ‰ promise é¡¹çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æ•°ç»„ï¼‰ä½œä¸ºå‚æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™äº›å¯¹è±¡ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸æ˜¯ promiseï¼Œé‚£ä¹ˆå®ƒå°†è¢«â€œæŒ‰åŸæ ·â€ä¼ é€’ç»™ç»“æœæ•°ç»„</span>\n\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1, 2, 3</span></code></pre></div>\n<p>ğŸš©Promise.allSettled</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Promise<span class=\"token punctuation\">.</span>allSettled ç­‰å¾…æ‰€æœ‰çš„ promise éƒ½è¢« settleï¼Œæ— è®ºç»“æœå¦‚ä½•ï¼Œç»“æœæ•°ç»„å…·æœ‰<span class=\"token operator\">:</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">{</span>status<span class=\"token operator\">:</span><span class=\"token string\">\"fulfilled\"</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span>result<span class=\"token punctuation\">}</span> å¯¹äºæˆåŠŸçš„å“åº”\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">{</span>status<span class=\"token operator\">:</span><span class=\"token string\">\"rejected\"</span><span class=\"token punctuation\">,</span> reason<span class=\"token operator\">:</span>error<span class=\"token punctuation\">}</span> å¯¹äº error</code></pre></div>\n<p>Polyfill</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Promise<span class=\"token punctuation\">.</span>allSettled<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">rejectHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">reason</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">\"rejected\"</span><span class=\"token punctuation\">,</span> reason <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">resolveHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">\"fulfilled\"</span><span class=\"token punctuation\">,</span> value <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">allSettled</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">promises</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> convertedPromises <span class=\"token operator\">=</span> promises<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>resolveHandler<span class=\"token punctuation\">,</span> rejectHandler<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>convertedPromises<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ğŸš©Promise.race</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- åªç­‰å¾…ç¬¬ä¸€ä¸ª settled çš„ promise å¹¶è·å–å…¶ç»“æœï¼ˆæˆ– errorï¼‰</code></pre></div>\n<p>ç¤ºä¾‹</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Promise<span class=\"token punctuation\">.</span><span class=\"token function\">race</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whoops!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span></code></pre></div>\n<p>ğŸš©Promise.resolve/reject</p>\n<p>è¯­æ³•</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ç»“æœ value åˆ›å»ºä¸€ä¸ª resolved çš„ promise</span>\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ç­‰åŒäº</span>\n\n<span class=\"token keyword\">let</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//...</span>\n\n<span class=\"token comment\">// Promise.reject() ç±»ä¼¼</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- å½“ä¸€ä¸ªå‡½æ•°è¢«æœŸæœ›è¿”å›ä¸€ä¸ª promise æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå…¼å®¹æ€§\n\n- ğŸ’¡è¿™é‡Œçš„å…¼å®¹æ€§æ˜¯æŒ‡ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†å½“å‰æ“ä½œçš„ç»“æœ valueï¼Œä½†æ˜¯æœŸæœ›è¿”å›çš„æ˜¯ä¸€ä¸ª promiseï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Promise.resolve(value) å°† value â€œå°è£…â€è¿› promiseï¼Œä»¥æ»¡è¶³æœŸæœ›è¿”å›ä¸€ä¸ª promise çš„è¿™ä¸ªéœ€æ±‚</code></pre></div>\n<p>ç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> cache <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">loadCached</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (*)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      cache<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> text<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ğŸ’¡å¯ä»¥ä½¿ç”¨ loadCached(url).then(â€¦)ï¼Œå› ä¸ºè¯¥å‡½æ•°ä¿è¯äº†ä¼šè¿”å›ä¸€ä¸ª promiseã€‚å¯ä»¥æ”¾å¿ƒåœ°åœ¨ loadCached åé¢ä½¿ç”¨ .thenã€‚è¿™å°±æ˜¯ (*) è¡Œä¸­ Promise.resolve çš„ç›®çš„</span></code></pre></div>\n<h2>Promisification</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- â€œPromisificationâ€ æŒ‡å°†ä¸€ä¸ªæ¥å—å›è°ƒçš„å‡½æ•°è½¬æ¢ä¸ºä¸€ä¸ªè¿”å› promise çš„å‡½æ•°\n\n- ç”±äºè®¸å¤šå‡½æ•°å’Œåº“éƒ½æ˜¯åŸºäºå›è°ƒçš„ï¼Œæ‰€ä»¥å°†åŸºäºå›è°ƒçš„å‡½æ•°å’Œåº“ promisify æ˜¯æœ‰æ„ä¹‰çš„</code></pre></div>\n<p>ç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">src<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> src<span class=\"token punctuation\">;</span>\n\n  script<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Script load error for </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>src<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ç”¨æ³•ï¼š</span>\n<span class=\"token comment\">// loadScript('path/script.js', (err, script) => {...})</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// promisify</span>\n\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">loadScriptPromise</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">loadScript</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> script</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ç”¨æ³•ï¼š</span>\n<span class=\"token comment\">// loadScriptPromise('path/script.js').then(...)</span></code></pre></div>\n<p>æ–°çš„å‡½æ•°æ˜¯å¯¹åŸå§‹çš„ loadScript å‡½æ•°çš„åŒ…è£…,åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½éœ€è¦ promisify å¾ˆå¤šå‡½æ•°</p>\n<p>ğŸš©promisify</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// è¿”å›ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼ˆwrapper-functionï¼‰ (*)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// å¯¹ f çš„è‡ªå®šä¹‰çš„å›è°ƒ (**)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      args<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å°†è‡ªå®šä¹‰çš„å›è°ƒé™„åŠ åˆ° f å‚æ•°ï¼ˆargumentsï¼‰çš„æœ«å°¾</span>\n\n      <span class=\"token function\">f</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è°ƒç”¨åŸå§‹çš„å‡½æ•°</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ç”¨æ³•ï¼š</span>\n<span class=\"token keyword\">let</span> loadScriptPromise <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>loadScript<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">loadScriptPromise</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ğŸš©promisification å‡½æ•°çš„æ¨¡å—ï¼ˆmoduleï¼‰</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- https://github.com/digitaldesignlabs/es6-promisify\n\n- åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…å»ºçš„ promisify å‡½æ•° util.promisify</code></pre></div>\n<p>ğŸš©Promisification åœºæ™¯</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- Promisification ä¸æ˜¯å›è°ƒçš„å®Œå…¨æ›¿ä»£\n\n- è¯·è®°ä½ï¼Œä¸€ä¸ª promise å¯èƒ½åªæœ‰ä¸€ä¸ªç»“æœï¼Œä½†ä»æŠ€æœ¯ä¸Šè®²ï¼Œä¸€ä¸ªå›è°ƒå¯èƒ½è¢«è°ƒç”¨å¾ˆå¤šæ¬¡\n\n- å› æ­¤ï¼Œpromisification ä»…é€‚ç”¨äºè°ƒç”¨ä¸€æ¬¡å›è°ƒçš„å‡½æ•°ã€‚è¿›ä¸€æ­¥çš„è°ƒç”¨å°†è¢«å¿½ç•¥</code></pre></div>\n<h2>references</h2>\n<ul>\n<li><a href=\"https://zh.javascript.info/async\">https://zh.javascript.info/async</a></li>\n</ul>\n<blockquote>\n<p>ä½œè€…ï¼š<a href=\"https://www.shanejix.com/\">shanejix</a>\nå‡ºå¤„ï¼š<a href=\"https://www.shanejix.com/posts/Promise%20%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/\">https://www.shanejix.com/posts/Promise å¿…çŸ¥å¿…ä¼š/</a>\nç‰ˆæƒï¼šæœ¬ä½œå“é‡‡ç”¨<a href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\">ã€Œç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…ã€</a>è®¸å¯åè®®è¿›è¡Œè®¸å¯ã€‚\nå£°æ˜ï¼šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>\n</blockquote>","frontmatter":{"title":"Promise å¿…çŸ¥å¿…ä¼š","date":"January 17, 2022","update":"April 12, 2022","url":"https://github.com/shanejix/shanejix.github.io/issues/91"}}},"pageContext":{"slug":"/Promise å¿…çŸ¥å¿…ä¼š/","previous":{"fields":{"slug":"/JavaScript Event Loop in Browser/"},"frontmatter":{"title":"JavaScript Event Loop in Browser","tags":["JavaScript","Node","Browser"]}},"next":{"fields":{"slug":"/[Snippet] - Authentication in React Router/"},"frontmatter":{"title":"[Snippet] - Authentication in React Router","tags":["React","Snippet","Router"]}}}},"staticQueryHashes":["3159585216","63159454"]}