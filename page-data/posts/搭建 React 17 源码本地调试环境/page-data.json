{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/搭建 React 17 源码本地调试环境/","result":{"data":{"site":{"siteMetadata":{"title":"shanejix","description":"learner && coder"}},"allMarkdownRemark":{"edges":[{"node":{"id":"9dd4013c-c308-552c-bd2c-04f0cd996599","timeToRead":5}},{"node":{"id":"d29bf37d-75f0-501e-92b1-42c06cdbcd7b","timeToRead":3}},{"node":{"id":"89619e78-eeef-5342-b7fe-7626ee925f57","timeToRead":9}},{"node":{"id":"cb3a4052-202e-5a46-bf15-4e9b30e34ebf","timeToRead":3}},{"node":{"id":"45c6b07a-fc6a-5800-9907-86a94c1f4ace","timeToRead":2}},{"node":{"id":"db38bc53-9935-56f0-a9e2-0be373990d78","timeToRead":3}},{"node":{"id":"1dcfd849-d044-5c73-b31a-5fd30393f430","timeToRead":14}},{"node":{"id":"7b38ed3c-4032-581a-aab4-bda6dcb8fa78","timeToRead":15}},{"node":{"id":"d15e9143-f799-527d-b71d-2b8fc195817c","timeToRead":12}},{"node":{"id":"ba521381-a518-5686-a682-0ada55a7dd73","timeToRead":4}},{"node":{"id":"ba58ecad-907f-5ad2-bc26-9167d7607dcc","timeToRead":12}},{"node":{"id":"08b71346-abf3-5649-84f5-2f8ae4f48c6a","timeToRead":3}},{"node":{"id":"da55e002-3a8a-5af2-929e-4de7e3a8d314","timeToRead":4}},{"node":{"id":"4e56b6de-c0ca-572e-9f9d-e769592aa49b","timeToRead":2}},{"node":{"id":"af002700-632d-547f-82b9-f31919d4f03e","timeToRead":1}},{"node":{"id":"7b6d671f-8de2-5511-91e9-0797db813dc7","timeToRead":1}},{"node":{"id":"ad4fad45-b734-560c-8324-a9708e1e04c4","timeToRead":1}},{"node":{"id":"ef84ef13-dac8-5cfa-ac69-d0ea44f677f1","timeToRead":2}},{"node":{"id":"69026b7f-ca1c-5eea-8f61-76972396800c","timeToRead":2}},{"node":{"id":"52b13183-db66-5637-bc21-c828b8dabddd","timeToRead":8}},{"node":{"id":"14bde951-d8e7-5045-84f7-dd9479cfafc3","timeToRead":35}},{"node":{"id":"aa4d72c6-d675-52e4-a55b-b07237ed0e1a","timeToRead":2}},{"node":{"id":"eb631c0f-69a5-5ca8-b3c7-1baaed014eea","timeToRead":1}},{"node":{"id":"684d2035-e385-577d-bb53-f7bfca2caa0d","timeToRead":18}},{"node":{"id":"a40d34f8-b202-5f5b-8c33-19c7c163bbce","timeToRead":5}},{"node":{"id":"afc44728-7e4f-5ce3-bf62-373400a8a46a","timeToRead":12}},{"node":{"id":"ca3cc4cf-0ddf-5fb3-a58d-2354b2f0a10e","timeToRead":5}},{"node":{"id":"fe7fd5be-04af-5d1a-b969-f8f4de7db655","timeToRead":1}},{"node":{"id":"fb3bc99d-cf2f-5fbd-981d-1d701815f87b","timeToRead":66}},{"node":{"id":"4de1fb79-73c7-5593-adc3-427351c465e9","timeToRead":101}},{"node":{"id":"9a102758-e412-5f31-8753-54534e8fdb15","timeToRead":1}},{"node":{"id":"a07217e5-4cbe-54e4-9566-2a0df732a1a4","timeToRead":1}},{"node":{"id":"c8a73065-3214-5616-93f3-0df2a119e91d","timeToRead":1}}]},"markdownRemark":{"id":"ca3cc4cf-0ddf-5fb3-a58d-2354b2f0a10e","excerpt":"同步链接: https://www.shanejix.com/posts/搭建 React 17 源码本地调试环境/ 通过这种方式只能调试编译之后的代码，不能实现原汁原味的源代码调试体验。查阅一些社区的实现，记录下步骤，方便后续查阅。 也可以直接 clone 配置好的仓库：https://github.com…","html":"<blockquote>\n<p>同步链接: <a href=\"https://www.shanejix.com/posts/%E6%90%AD%E5%BB%BA%20React%2017%20%E6%BA%90%E7%A0%81%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/\">https://www.shanejix.com/posts/搭建 React 17 源码本地调试环境/</a></p>\n</blockquote>\n<p>通过<a href=\"https://react.iamkasong.com/preparation/source.html#%E6%8B%89%E5%8F%96%E6%BA%90%E7%A0%81\">这种方式</a>只能调试编译之后的代码，不能实现原汁原味的源代码调试体验。查阅一些社区的实现，记录下步骤，方便后续查阅。</p>\n<p>也可以直接 clone 配置好的仓库：<a href=\"https://github.com/shanejix/react-source-code-debug\">https://github.com/shanejix/react-source-code-debug</a></p>\n<h2>步骤</h2>\n<ol>\n<li>使用 create-react-app 脚手架创建项目</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">npx create-react-app react-source-code-debug</code></pre></div>\n<ol start=\"2\">\n<li>弹射 create-react-app 脚手架内部配置</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">yarn</span> run <span class=\"token function\">eject</span></code></pre></div>\n<ol start=\"3\">\n<li>克隆 react 官方源码 (在项目的根目录下进行克隆)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone --branch v17.0.2 --depth<span class=\"token operator\">=</span><span class=\"token number\">1</span> https://github.com/facebook/react.git src/react</code></pre></div>\n<ol start=\"4\">\n<li>通过 alias ，链接本地源码</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置: react-source-code-debug/config/webpack.config.js</span>\n\nresolve<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  alias<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Support React Native Web</span>\n    <span class=\"token comment\">// https://www.smashingmagazine.com/2016/08/a-glimpse-into-the-future-with-react-native-for-web/</span>\n    <span class=\"token string\">'react-native'</span><span class=\"token operator\">:</span> <span class=\"token string\">'react-native-web'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Allows for better profiling with ReactDevTools</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">(</span>isEnvProductionProfile <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'react-dom$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'react-dom/profiling'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'scheduler/tracing'</span><span class=\"token operator\">:</span> <span class=\"token string\">'scheduler/tracing-profiling'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">(</span>modules<span class=\"token punctuation\">.</span>webpackAliases <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">+</span> <span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n    <span class=\"token operator\">+</span> <span class=\"token string\">'react'</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../src/react/packages/react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">+</span> <span class=\"token string\">'react-dom'</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../src/react/packages/react-dom'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">+</span> <span class=\"token string\">'shared'</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../src/react/packages/shared'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">+</span> <span class=\"token string\">'react-reconciler'</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../src/react/packages/react-reconciler'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">+</span> <span class=\"token comment\">// 'scheduler': path.resolve(__dirname, '../src/react/packages/scheduler'),</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"5\">\n<li>修改环境变量</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置: react-source-code-debug/config/env.js</span>\n\n<span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n<span class=\"token keyword\">const</span> stringified <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">+</span> __DEV__<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">+</span> __PROFILE__<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">+</span> __UMD__<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">+</span> __EXPERIMENTAL__<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'process.env'</span><span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>raw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">env<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    env<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>raw<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> env<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"6\">\n<li>在根目录创建 <code class=\"language-text\">eslintrc.json</code>文件，内容如下</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-app\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"__DEV__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"__PROFILE__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"__UMD__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"__EXPERIMENTAL__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"7\">\n<li>修改 ReactFiberHostConfig.js 文件</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置: /react/packages/react-reconciler/src/ReactFiberHostConfig.js</span>\n\n<span class=\"token operator\">-</span> <span class=\"token keyword\">import</span> invariant <span class=\"token keyword\">from</span> <span class=\"token string\">'shared/invariant'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token function\">invariant</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'This module must be shimmed by a specific renderer.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">+</span> <span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n<span class=\"token operator\">+</span> <span class=\"token keyword\">export</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./forks/ReactFiberHostConfig.dom'</span></code></pre></div>\n<ol start=\"8\">\n<li>修改 ReactSharedInternals.js 文件</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置: /react/packages/shared/ReactSharedInternals.js</span>\n\n<span class=\"token operator\">-</span> <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token keyword\">const</span> ReactSharedInternals <span class=\"token operator\">=</span>\n<span class=\"token operator\">-</span>   React<span class=\"token punctuation\">.</span>__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">+</span> <span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n<span class=\"token operator\">+</span> <span class=\"token keyword\">import</span> ReactSharedInternals <span class=\"token keyword\">from</span> <span class=\"token string\">'../react/src/ReactSharedInternals'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">+</span> <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ReactSharedInternals<span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"9\">\n<li>修改 invariant.js 文件</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置: /react/packages/shared/invariant.js</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">invariant</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">condition<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">,</span> f</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token operator\">+</span> <span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n  <span class=\"token operator\">+</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">+</span>   <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">+</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'Internal React error: invariant() is meant to be replaced at compile '</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">'time. There is no runtime version.'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"10\">\n<li>新增 <code class=\"language-text\">Scheduler</code>导出</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置：src/react/packages/scheduler/src/Scheduler.js</span>\n\n\n<span class=\"token operator\">+</span> <span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n<span class=\"token operator\">+</span> <span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">+</span>   unstable_flushAllWithoutAsserting<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   unstable_flushNumberOfYields<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   unstable_flushExpired<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   unstable_clearYields<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   unstable_flushUntilNextPaint<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   unstable_flushAll<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   unstable_yieldValue<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   unstable_advanceTime\n<span class=\"token operator\">+</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./forks/SchedulerHostConfig.mock.js'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span>\n<span class=\"token operator\">+</span> <span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">+</span>   requestHostCallback<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   requestHostTimeout<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   cancelHostTimeout<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   shouldYieldToHost<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   getCurrentTime<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   forceFrameRate<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>   requestPaint\n<span class=\"token operator\">+</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./forks/SchedulerHostConfig.default.js'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"11\">\n<li>关闭 eslint 扩展</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置: react/.eslingrc.js [module.exports]</span>\n\n<span class=\"token operator\">-</span> <span class=\"token keyword\">extends</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"token operator\">-</span>  <span class=\"token string\">'fbjs'</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">-</span>  <span class=\"token string\">'prettier'</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">]</span></code></pre></div>\n<ol start=\"12\">\n<li>解决 eslint 报错</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 将 webpack 中 eslint 插件给关掉,修改 src/config/webpack.config.js 文件</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n\n<span class=\"token comment\">// !disableESLintPlugin &amp;&amp;</span>\n<span class=\"token comment\">// new ESLintPlugin({</span>\n<span class=\"token comment\">//   // Plugin options</span>\n<span class=\"token comment\">//   extensions: ['js', 'mjs', 'jsx', 'ts', 'tsx'],</span>\n<span class=\"token comment\">//   formatter: require.resolve('react-dev-utils/eslintFormatter'),</span>\n<span class=\"token comment\">//   eslintPath: require.resolve('eslint'),</span>\n<span class=\"token comment\">//   failOnError: !(isEnvDevelopment &amp;&amp; emitErrorsAsWarnings),</span>\n<span class=\"token comment\">//   context: paths.appSrc,</span>\n<span class=\"token comment\">//   cache: true,</span>\n<span class=\"token comment\">//   cacheLocation: path.resolve(</span>\n<span class=\"token comment\">//     paths.appNodeModules,</span>\n<span class=\"token comment\">//     '.cache/.eslintcache'</span>\n<span class=\"token comment\">//   ),</span>\n<span class=\"token comment\">//   // ESLint class options</span>\n<span class=\"token comment\">//   cwd: paths.appPath,</span>\n<span class=\"token comment\">//   resolvePluginsRelativeTo: __dirname,</span>\n<span class=\"token comment\">//   baseConfig: {</span>\n<span class=\"token comment\">//     extends: [require.resolve('eslint-config-react-app/base')],</span>\n<span class=\"token comment\">//     rules: {</span>\n<span class=\"token comment\">//       ...(!hasJsxRuntime &amp;&amp; {</span>\n<span class=\"token comment\">//         'react/react-in-jsx-scope': 'error',</span>\n<span class=\"token comment\">//       }),</span>\n<span class=\"token comment\">//     },</span>\n<span class=\"token comment\">//   },</span>\n<span class=\"token comment\">// }),</span></code></pre></div>\n<ol start=\"13\">\n<li>告诉 babel 在转换代码时忽略类型检查</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @babel/plugin-transform-flow-strip-types -D</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 文件位置: react-source-code-debug/config/webpack.config.js [babel-loader]</span>\n\nplugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n  <span class=\"token punctuation\">[</span>require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@babel/plugin-transform-flow-strip-types\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"14\">\n<li>新增 eslint 配置</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// 在 react 源码文件夹中新建 .eslintrc.json 并添加如下配置</span>\n\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-app\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"__DEV__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"__PROFILE__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"__UMD__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"__EXPERIMENTAL__\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"15\">\n<li>修改 <code class=\"language-text\">react</code> <code class=\"language-text\">react-dom</code> 引入方式</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">-</span> <span class=\"token comment\">// import React from 'react';</span>\n<span class=\"token operator\">-</span> <span class=\"token comment\">// import ReactDOM from 'react-dom';</span>\n\n<span class=\"token operator\">+</span> <span class=\"token comment\">// FIXME: REACT SOURCE CODE DEBUG</span>\n\n<span class=\"token operator\">+</span> <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span> <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"16\">\n<li>解决 VSCode 中 flow 报错</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 新建 .vscode/setting.js</span>\n\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"typescript.validate.enable\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"javascript.validate.enable\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"17\">\n<li>解决 <strong>DEV</strong> 报错</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">// 删除 node_modules 文件夹，执行 <span class=\"token function\">npm</span> <span class=\"token function\">install</span> / <span class=\"token function\">yarn</span>\n\n// 根目录下\n\n<span class=\"token function\">rm</span> -fr node_modules <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">yarn</span></code></pre></div>\n<h2>references</h2>\n<ul>\n<li><a href=\"https://github.com/neroneroffy/react-source-code-debug/blob/master/docs/setUpDebugEnv.md\">https://github.com/neroneroffy/react-source-code-debug/blob/master/docs/setUpDebugEnv.md</a></li>\n<li><a href=\"https://juejin.cn/post/7014775797596553230\">https://juejin.cn/post/7014775797596553230</a></li>\n</ul>\n<blockquote>\n<p>作者：<a href=\"https://www.shanejix.com/\">shanejix</a>\n出处：<a href=\"https://www.shanejix.com/posts/%E6%90%AD%E5%BB%BA%20React%2017%20%E6%BA%90%E7%A0%81%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/\">https://www.shanejix.com/posts/搭建 React 17 源码本地调试环境/</a>\n版权：本作品采用<a href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\">「署名-非商业性使用-相同方式共享 4.0 国际」</a>许可协议进行许可。\n声明：转载请注明出处！</p>\n</blockquote>","frontmatter":{"title":"搭建 React 17 源码本地调试环境","date":"April 11, 2022","update":"April 12, 2022","url":"https://github.com/shanejix/shanejix.github.io/issues/96"}}},"pageContext":{"slug":"/搭建 React 17 源码本地调试环境/","previous":{"fields":{"slug":"/2022金三银四前端面试笔记/"},"frontmatter":{"title":"2022金三银四前端面试笔记","tags":["Interview"]}},"next":{"fields":{"slug":"/手撕 JavaScript 高频知识点，彻底征服面试官/"},"frontmatter":{"title":"手撕 JavaScript 高频知识点，彻底征服面试官","tags":["JavaScript","Interview"]}}}},"staticQueryHashes":["3159585216","63159454"]}