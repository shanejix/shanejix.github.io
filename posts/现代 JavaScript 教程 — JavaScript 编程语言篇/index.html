<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="referrer" content="no-referrer"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.45rem !important;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.45rem !important;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--pink);text-decoration:none;line-height:1.5;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}h1, h2, h3, h4, h5, h6{margin-top:0;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:0.85rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:0.85rem;}blockquote.translation{font-size:1em;}</style><style data-href="/styles.2c5e1fe12488927e3ca4.css" id="gatsby-global-css">html{background-color:transparent}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:url(/static/merriweather-400-l-8796b7875d52e9cb9b280211e8d3f82d.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:url(/static/montserrat-900-l-5751237264c0468be0d48ad1cea75b90.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}body{--pink:#d33a31;background-color:var(--bg)}body.light{--bg:#f0e7db;--bg-secondary:#f9fafb;--header:var(--pink);--textNormal:#222;--textTitle:#222;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a;--form-shadow:0 2px 15px 0 rgba(210,214,220,0.5)}body.dark,body.light{--textLink:var(--pink)}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--bg-secondary:#363c48;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:rgba(115,124,153,0.2);--inlineCode-text:#e6e6e6;--form-shadow:0 2px 15px 0 rgba(26,26,27,0.637)}body:lang(ar) article,body:lang(fa) article,body:lang(he) article{direction:rtl}body:lang(ar) .language-text,body:lang(ar) article .translations,body:lang(ar) article pre,body:lang(fa) .language-text,body:lang(fa) article .translations,body:lang(fa) article pre,body:lang(he) .language-text,body:lang(he) article .translations,body:lang(he) article pre{direction:ltr}body:lang(ar) .language-text,body:lang(fa) .language-text,body:lang(he) .language-text{display:inline-block}body:lang(ar) blockquote,body:lang(fa) blockquote,body:lang(he) blockquote{border-left:unset;border-right:.32813rem solid rgba(0,0,0,.9);padding-right:1.42188rem;padding-left:unset;margin-left:.75rem;margin-right:-1.75rem}body:lang(fa) article,body:lang(fa) header>h1{font-family:Vazir}body:lang(ar) article,body:lang(ar) header>h1{font-family:Cairo,sans-serif}body:lang(ko) article,body:lang(ko) header{word-break:keep-all}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.react-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;transform:translateX(0)}.react-toggle--checked .react-toggle-thumb{transform:translateX(26px);border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}.box{padding:.5rem 1rem;border:1px solid var(--textNormal);border-radius:.25rem}.box,.boxes{margin-bottom:1rem}.boxes{border:2px solid var(--textNormal);border-radius:6px}.boxes>.box{border-width:0;border-radius:0;margin-bottom:0}.boxes>.box:first-child{border-top-left-radius:4px!important;border-top-right-radius:4px!important}.boxes>.box:last-child{border-bottom-left-radius:4px!important;border-bottom-right-radius:4px!important}.boxes>.box.box-header{background-color:rgba(100,100,150,.04)}.boxes>.box.box-body{padding-top:1rem;padding-bottom:1rem}.boxes>.box.box-footer{background-color:rgba(100,100,150,.04)}.boxes .box+.box{border-top-width:1px}.boxes .boxes{margin-bottom:0}.boxes.transparent,.boxes.transparent .box{background-color:transparent}.boxes.inverted{color:#fff}.boxes.inverted,.boxes.inverted .box{background-color:#2d353c;border-color:var(--textNormal)}.boxes.secondary{border-width:0}.boxes.secondary>.box{border-width:1px;border-radius:.25rem}.boxes.secondary>.box.box-header{background-color:transparent;margin-bottom:0;border-width:0;border-radius:0!important}.boxes.secondary>.box.box-body{padding-top:1rem;padding-bottom:1rem;margin-bottom:0}.boxes.secondary>.box.box-footer{background-color:transparent;border-width:0;border-radius:0!important}.p-y-0{padding-top:0!important;padding-bottom:0!important}.p-y-8{padding-top:.5rem!important;padding-bottom:.5rem!important}.col,.col-1,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-10,.col-11,.col-12{position:relative;width:100%;padding-left:.75rem;padding-right:.75rem}.col-4{flex:0 0 33.33333%;max-width:33.33333%}.cols-10>.col-4{flex:0 0 40%;max-width:40%}.b-r-1{border-right:1px solid var(--textNormal)!important}.row{display:flex;flex-wrap:wrap;margin-left:-.75rem;margin-right:-.75rem}.row.g-32{margin-left:-16px!important;margin-right:-16px!important}.row.g-32>[class*=col]{padding-left:16px!important;padding-right:16px!important}.boxes>.box>.m-t-0+p p{margin-bottom:1rem}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="icon" href="/favicon-32x32.png?v=0d7082db0bcaf1381f0ae2cbdc939311" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#6b37bf"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=0d7082db0bcaf1381f0ae2cbdc939311"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">shanejix | shanejix</title><meta data-react-helmet="true" property="og:title" content="现代 JavaScript 教程 — JavaScript 编程语言篇"/><meta data-react-helmet="true" property="og:description" content="同步链接: https://www.shanejix.com/posts/现代 JavaScript 教程 — JavaScript 编程语言篇/ 摘自 现代 JavaScript 教程;总结自己觉得重要/疏忽/未知的部分，闲来无事时看看，抓耳挠腮时看看。长篇预警！ ECMA-26…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="shanejix"/><meta data-react-helmet="true" name="twitter:title" content="现代 JavaScript 教程 — JavaScript 编程语言篇"/><meta data-react-helmet="true" name="twitter:description" content="同步链接: https://www.shanejix.com/posts/现代 JavaScript 教程 — JavaScript 编程语言篇/ 摘自 现代 JavaScript 教程;总结自己觉得重要/疏忽/未知的部分，闲来无事时看看，抓耳挠腮时看看。长篇预警！ ECMA-26…"/><meta data-react-helmet="true" name="description" content="learner &amp;&amp; coder"/><script async="" type="text/javascript" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-7633830809578886",
            enable_page_level_ads: true
        });
        </script><link as="script" rel="preload" href="/webpack-runtime-e0256f23ab3c5c1ffc4c.js"/><link as="script" rel="preload" href="/framework-b17a64ad725e0b3c1338.js"/><link as="script" rel="preload" href="/app-5c7248fcb69374f91873.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cac18b802c8b308508681dc900d8d8f756c7bdb5-c7c9c4e9ce9bf74cce02.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-06eb50339f2f3ac086e8.js"/><link as="fetch" rel="preload" href="/page-data/posts/现代 JavaScript 教程 — JavaScript 编程语言篇/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3159585216.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="14j5ye3">.css-14j5ye3{margin-left:auto;margin-right:auto;padding:0 1.3125rem;max-width:42rem;}</style><div style="color:var(--textNormal);transition:color 0.2s ease-out, background 0.2s ease-out" class="css-14j5ye3"><style data-emotion-css="zhpt6k">.css-zhpt6k{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;min-height:15vh;}</style><header class="css-zhpt6k"><div style="margin-right:auto"><style data-emotion-css="w4vfos">.css-w4vfos{height:15vh;line-height:15vh;text-shadow:none;background-image:none;}</style><a class="css-w4vfos" href="/"><style data-emotion-css="4nx8jl">.css-4nx8jl{display:inline-block;font-style:normal;}</style><h3 class="css-4nx8jl">Shane Jix</h3></a></div><div><div style="height:24px"></div></div></header><main style="min-height:calc(100vh - 25vh)"><article style="border-radius:3px;margin-bottom:0.5rem;font-size:1rem"><section><h1 style="margin-top:1.75rem;margin-bottom:0;margin-left:-0.5rem;margin-right:-0.5rem">现代 JavaScript 教程 — JavaScript 编程语言篇</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:0.875rem"><span>create:<!-- -->June 08, 2021</span>  <span>update:<!-- -->April 12, 2022</span>  <span> • <!-- -->🥘🥘🥘🥘 101 min read</span></p></section><section><blockquote>
<p>同步链接: <a href="https://www.shanejix.com/posts/%E7%8E%B0%E4%BB%A3%20JavaScript%20%E6%95%99%E7%A8%8B%20%E2%80%94%20JavaScript%20%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/">https://www.shanejix.com/posts/现代 JavaScript 教程 — JavaScript 编程语言篇/</a></p>
</blockquote>
<p>摘自 <a href="https://zh.javascript.info/">现代 JavaScript 教程</a>;总结自己觉得重要/疏忽/未知的部分，闲来无事时看看，抓耳挠腮时看看。长篇预警！</p>
<hr>
<h2>ECMA-262 规范</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">最权威的信息来源(语言细节)，每年都会发布一个新版本的规范</code></pre></div>
<p>🚩 最新的规范草案请见 <a href="https://tc39.es/ecma262/">https://tc39.es/ecma262/</a></p>
<p>🚩 最新最前沿的功能，包括“即将纳入规范的”（所谓的 “stage 3”），请看这里的提案 <a href="https://github.com/tc39/proposals">https://github.com/tc39/proposals</a></p>
<h2>现代模式，“use strict”</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 新的特性被加入，旧的功能也没有改变 这么做有利于兼容旧代码，

- 但缺点是 JavaScript 创造者的任何错误或不完善的决定也将永远被保留在 JavaScript 语言中

- 这种情况一直持续到 2009 年 ECMAScript 5 (ES5) 的出现

- ES5 规范增加了新的语言特性并且修改了一些已经存在的特性

- 为了保证旧的功能能够使用，大部分的修改是默认不生效的

- 【需要一个特殊的指令 —— "use strict" 来明确地激活这些特性】</code></pre></div>
<p>🚩 位置和时机</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 脚本文件的顶部

- 函数体的开头

- “classes” 和 “modules”自动启用`'use strict'`

---

- 没有办法取消 `'use strict'`

- console控制台`'use strict'; &lt;Shift+Enter 换行>`</code></pre></div>
<h2>大写形式的常数</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一个普遍的做法是将常量用作别名，以便记住那些在执行之前就已知的难以记住的值</code></pre></div>
<p>🚩<strong>使用大写字母和下划线来命名这些常量</strong></p>
<p>例如，让我们以所谓的“web”（十六进制）格式为颜色声明常量：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">COLOR_RED</span> <span class="token operator">=</span> <span class="token string">"#F00"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">COLOR_GREEN</span> <span class="token operator">=</span> <span class="token string">"#0F0"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">COLOR_BLUE</span> <span class="token operator">=</span> <span class="token string">"#00F"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">COLOR_ORANGE</span> <span class="token operator">=</span> <span class="token string">"#FF7F00"</span><span class="token punctuation">;</span>

<span class="token comment">// ……当我们需要选择一个颜色</span>
<span class="token keyword">let</span> color <span class="token operator">=</span> <span class="token constant">COLOR_ORANGE</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// #FF7F00</span></code></pre></div>
<p>好处：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">-  `COLOR_ORANGE` 比 `"#FF7F00"` 更容易记忆

- 比起 `COLOR_ORANGE` 而言，`"#FF7F00"` 更容易输错

- 阅读代码时，`COLOR_ORANGE` 比 `#FF7F00` 更易懂</code></pre></div>
<p>🚩 什么时候该为常量使用大写命名，什么时候进行常规命名？让我们弄清楚一点</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 作为一个“常数”，意味着值永远不变

- **但是有些常量在执行之前就已知了（比如红色的十六进制值），还有些在执行期间被“计算”出来，但初始赋值之后就不会改变**</code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> pageLoadTime <span class="token operator">=</span> <span class="token comment">/* 网页加载所需的时间 */</span><span class="token punctuation">;</span>


<span class="token comment">// **`pageLoadTime` 的值在页面加载之前是未知的，所以采用常规命名,但是它仍然是个常量，因为赋值之后不会改变**</span>

<span class="token comment">// 换句话说，**大写命名的常量仅用作“硬编码（hard-coded）”值的别名**。**当值在执行之前或在被写入代码的时候，就知道值是什么了**。</span></code></pre></div>
<h2>数据类型</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">在 JavaScript 中有 8 种基本的数据类型（译注：**7 种原始类型(基本数据类型)和 1 种引用类型(复杂数据类型)**）

- `number`

- `bigint`

- `string`

- `boolean`

- `null`

- `undefined`

- `symbol`

- `object`</code></pre></div>
<p>🚩 可以通过 <code class="language-text">typeof</code> 运算符查看存储在变量中的数据类型</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 两种形式：`typeof x` 或者 `typeof(x)`

- 以字符串的形式返回类型名称，例如 `"string"`

- `typeof null` 会返回 `"object"` —— 这是 JavaScript 编程语言的一个错误，实际上它并不是一个 object

- `typeof alert` 的结果是 `"function"`。在 JavaScript 语言中没有一个特别的 `“function”` 类型。函数隶属于 object 类型。但是 `typeof` 会对函数区分对待，并返回 `"function"`。这也是来自于 JavaScript 语言早期的问题。*从技术上讲，这种行为是不正确的，但在实际编程中却非常方便。*</code></pre></div>
<h2>Number 类型</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">number 类型代表整数和浮点数;除了常规的数字，还包括所谓的“特殊数值（“special numeric values”）”也属于这种类型：Infinity、-Infinity 和 NaN。

- `alert( 1 / 0 ); // Infinity`

- `alert( "not a number" / 2 + 5 ); // NaN` **NaN 是粘性的。任何对 NaN 的进一步操作都会返回 NaN**</code></pre></div>
<h2>常用的类型转换:转换为 string 类型、转换为 number 类型和转换为 boolean 类型</h2>
<p>🚩 字符串转换</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 转换发生在输出内容的时候

- 或通过 String(value) 进行显式转换</code></pre></div>
<p>🚩 数字型转换</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 转换发生在进行算术操作时

- 或通过 Number(value) 进行显式转换

- 规则：

 - Number(undefined);// NaN

 - Number(null);// 0

 - Number(true);// 1

 - Number(false);// 0

 - Number(str);// 原样读取str字符串，忽略两端空白，空字符串转换为0，出错则为NaN</code></pre></div>
<p>🚩 布尔型转换</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 转换发生在进行逻辑操作时

- 可以通过 Boolean(value) 进行显式转换

    - Boolean(0);//false

    - Boolean(null);//false

    - Boolean(undefined);//false

    - Boolean(NaN);//false

    - Boolean("");//false

    - Boolean(" ");//true

    - Boolean("0");//true</code></pre></div>
<h2>自增/自减</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">**所有的运算符都有返回值**，自增/自减也不例外


- 前置形式返回一个新的值

- 后置返回原来的值（做加法/减法之前的值）</code></pre></div>
<h2>赋值 <code class="language-text">=</code> 返回一个值</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">在 JavaScript 中，大多数运算符都会返回一个值

- 这对于 + 和 - 来说是显而易见的

- 但对于 = 来说也是如此</code></pre></div>
<p>🚩<strong>语句 x = value 将值 value 写入 x 然后返回 x。</strong></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">-</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token function">alert</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>

<span class="token comment">// 上面这个例子，(a = b + 1) 的结果是赋给 a 的值（也就是 3）。然后该值被用于进一步的运算。</span>

<span class="token comment">// 有时会在 JavaScript 库中看到它。不过，请不要写这样的代码。这样的技巧绝对不会使代码变得更清晰或可读。</span></code></pre></div>
<h2>在比较字符串的大小时，JavaScript 会使用“字典（dictionary）”或“词典（lexicographical）”顺序进行判定</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">换言之，字符串是按字符（母）逐个进行比较的。</code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Z"</span> <span class="token operator">></span> <span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Glow"</span> <span class="token operator">></span> <span class="token string">"Glee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Bee"</span> <span class="token operator">></span> <span class="token string">"Be"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<p>🚩 字符串的比较算法非常简单</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 首先比较两个字符串的首位字符大小

- 如果一方字符较大（或较小），则该字符串大于（或小于）另一个字符串。算法结束。

- 否则，如果两个字符串的首位字符相等，则继续取出两个字符串各自的后一位字符进行比较

- 重复上述步骤进行比较，直到比较完成某字符串的所有字符为止

- 如果两个字符串的字符同时用完，那么则判定它们相等，否则未结束（还有未比较的字符）的字符串更大</code></pre></div>
<p>🚩<strong>非真正的字典顺序，而是 Unicode 编码顺序</strong></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">这是因为在 JavaScript 使用的内部编码表中（Unicode），小写字母的字符索引值更大</code></pre></div>
<h2>值的比较</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">避免问题：

- 除了严格相等 === 外，其他但凡是有 undefined/null 参与的比较，我们都需要格外小心

- 除非你非常清楚自己在做什么，否则永远不要使用 >= > &lt; &lt;= 去比较一个可能为 null/undefined 的变量

- 对于取值可能是 null/undefined 的变量，请按需要分别检查它的取值情况</code></pre></div>
<h2>逻辑 或 运算符</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''一个或运算 || 的链，将返回第一个真值，如果不存在真值，就返回该链的最后一个值''</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">返回的值是操作数的初始形式，不会做布尔转换</code></pre></div>
<p>🚩<code class="language-text">与“纯粹的、传统的、仅仅处理布尔值的或运算”相比，这个规则就引起了一些很有趣的用法</code></p>
<p>一，”获取变量列表或者表达式中的第一个真值”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 例如，有变量 firstName、lastName 和 nickName，都是可选的（即可以是 undefined，也可以是假值）。</span>

<span class="token comment">// 用或运算 || 来选择有数据的那一个，并显示出来（如果没有设置，则用 "Anonymous"）：</span>

<span class="token keyword">let</span> firstName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> lastName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nickName <span class="token operator">=</span> <span class="token string">"SuperCoder"</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>firstName <span class="token operator">||</span> lastName <span class="token operator">||</span> nickName <span class="token operator">||</span> <span class="token string">"Anonymous"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SuperCoder</span>

<span class="token comment">// 如果所有变量的值都为假，结果就是 "Anonymous"。</span></code></pre></div>
<p>二，”短路求值（Short-circuit evaluation）”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 或运算符 || 的另一个用途是所谓的“短路求值”。</span>

<span class="token comment">// 这指的是，|| 对其参数进行处理，直到达到第一个真值，然后立即返回该值，而无需处理其他参数。</span>

<span class="token comment">//如果操作数不仅仅是一个值，而是一个有副作用的表达式，例如变量赋值或函数调用，那么这一特性的重要性就变得显而易见了。</span>

<span class="token comment">//在下面这个例子中，只会打印第二条信息：</span>

<span class="token boolean">true</span> <span class="token operator">||</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"not printed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token boolean">false</span> <span class="token operator">||</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"printed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在第一行中，或运算符 || 在遇到 true 时立即停止运算，所以 alert 没有运行。</span>

<span class="token comment">// 有时，人们利用这个特性，只在左侧的条件为假时才执行命令。</span></code></pre></div>
<h2>逻辑 与 运算符</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">与运算返回第一个假值，如果没有假值就返回最后一个值</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">返回的值是操作数的初始形式，**不会做布尔转换**</code></pre></div>
<p>一，”获取变量列表或者表达式中的第一个假值”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null</span></code></pre></div>
<p>二，”短路求值（Short-circuit evaluation）:如果所有的值都是真值，最后一个值将会被返回”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3，最后一个值</span></code></pre></div>
<p>与运算 &#x26;&#x26; 的优先级比或运算 || 要高</p>
<h2>逻辑 非 运算符</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">逻辑非运算符接受一个参数，并按如下运作：

- 将操作数转化为布尔类型：true/false。

- **返回相反的值**</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">**两个非运算 !! 有时候用来将某个值转化为布尔类型**</code></pre></div>
<h2>空值合并运算符（nullish coalescing operator） ??</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 将值既不是 null 也不是 undefined 的表达式**定义为**“已定义的（defined）


a ?? b 的结果是：

- 如果 a 是已定义的，则结果为 a

- 如果 a 不是已定义的，则结果为 b


- 换句话说，如果第一个参数不是 null/undefined，则 ?? 返回第一个参数。否则，返回第二个参数</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">result <span class="token operator">=</span> a <span class="token operator">??</span> b<span class="token punctuation">;</span>

<span class="token comment">// 等价于</span>

result <span class="token operator">=</span> a <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">;</span></code></pre></div>
<p>🚩 场景：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 1. 为可能是未定义的变量提供一个默认值</span>

<span class="token keyword">let</span> user<span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>user <span class="token operator">??</span> <span class="token string">"Anonymous"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Anonymous</span>

<span class="token comment">// 2. 可以使用 ?? 序列从一系列的值中选择出第一个非 null/undefined 的值</span>

<span class="token keyword">let</span> firstName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> lastName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nickName <span class="token operator">=</span> <span class="token string">"Supercoder"</span><span class="token punctuation">;</span>

<span class="token comment">// 显示第一个已定义的值：</span>
<span class="token function">alert</span><span class="token punctuation">(</span>firstName <span class="token operator">??</span> lastName <span class="token operator">??</span> nickName <span class="token operator">??</span> <span class="token string">"Anonymous"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Supercoder</span></code></pre></div>
<p>🚩** || 和 ?? 之间重要的区别是**：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- || 返回第一个 真 值

- ?? 返回第一个 已定义的 值</code></pre></div>
<h2>switch 类型很关键</h2>
<p>🚩 严格相等</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 被比较的值必须是相同的类型才能进行匹配</span>

<span class="token keyword">let</span> arg <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Enter a value?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token string">"0"</span><span class="token operator">:</span>
  <span class="token keyword">case</span> <span class="token string">"1"</span><span class="token operator">:</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"One or zero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>

  <span class="token keyword">case</span> <span class="token string">"2"</span><span class="token operator">:</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>

  <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Never executes!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">default</span><span class="token operator">:</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"An unknown value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输入 3，因为 prompt 的结果是字符串类型的 "3"，不严格相等 === 于数字类型的 3，所以 case 3 不会执行！因此 case 3 部分是一段无效代码。所以会执行 default 分支。</span></code></pre></div>
<h2>函数 return 返回值</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">1.**空值的 return 或没有 return 的函数返回值为 undefined**</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">2.**不要在 return 与返回值之间添加新行**</code></pre></div>
<p>对于 return 的长表达式，可能你会很想将其放在单独一行</p>
<p>如下所示：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">return</span><span class="token punctuation">;</span>
some <span class="token operator">+</span> long <span class="token operator">+</span> expression <span class="token operator">+</span> or <span class="token operator">+</span> whatever <span class="token operator">*</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">f</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>但这不行，因为 JavaScript 默认会在 return 之后加上分号。上面这段代码和下面这段代码运行流程相同：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">return</span><span class="token punctuation">;</span>
some <span class="token operator">+</span> long <span class="token operator">+</span> expression <span class="token operator">+</span> or <span class="token operator">+</span> whatever <span class="token operator">*</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">f</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>因此，实际上它的返回值变成了空值</p>
<h2>函数表达式末尾会有个分号？</h2>
<p>🚩 为什么函数表达式结尾有一个分号 ; 而函数声明没有?</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>答案很简单</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 在代码块的结尾不需要加分号 ;

    - if { ... }

    - for { }

    - function f { }

    - 等语法结构后面都不用加


- 函数表达式是在语句内部的：

    - `let sayHi = ...;`

    - 作为一个值，它不是代码块而是一个赋值语句

    - 不管值是什么，都建议在语句末尾添加分号 ;

    - 所以这里的分号与函数表达式本身没有任何关系，它只是用于终止语句</code></pre></div>
<h2>Babel ：Transpiler And Polyfill</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 当使用语言的一些现代特性时，一些引擎可能无法支持这样的代码


- 正如上所述，并不是所有功能在任何地方都有实现


- 这就是 Babel 来拯救的东西</code></pre></div>
<p>🚩<a href="https://babeljs.io/">Babel</a> 是一个 <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler">transpiler</a>,它将现代的 JavaScript 代码转化为以前的标准形式。</p>
<p>实际上，Babel 包含了两部分</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">1.第一，用于重写代码的 transpiler 程序

- 开发者在自己的电脑上运行它,它以之前的语言标准对代码进行重写

- 然后将代码传到面向用户的网站

- 像 [webpack](http://webpack.github.io/) 这样的现代项目构建系统，提供了在每次代码改变时自动运行 transpiler 的方法，因此很容易集成在开发过程中</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">2.第二，polyfill

- 新的语言特性可能不仅包括语法结构，还包括新的内建函数

- Transpiler 会重写代码，将语法结构转换为旧的结构

- 但是对于新的内建函数，需要我们去实现

- JavaScript 是一个高度动态化的语言，脚本可以添加/修改任何函数，从而使它们的行为符合现代标准

- 更新/添加新函数的脚本称为 “polyfill”，它“填补”了缺口，并添加了缺少的实现</code></pre></div>
<p>🚩 两个有意思的 polyfills</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- [core js](https://github.com/zloirock/core-js) 支持很多，允许只包含需要的功能

- [polyfill.io](http://polyfill.io/) 根据功能和用户的浏览器，为脚本提供 polyfill 的服务</code></pre></div>
<p>🚩transpiler 和 polyfill 是必要的</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">如果要使用现代语言功能，transpiler 和 polyfill 是必要的</code></pre></div>
<h2>尾随（trailing）或悬挂（hanging）逗号</h2>
<p>列表中的最后一个属性应以逗号结尾：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 列表中的最后一个属性应以逗号结尾,叫做尾随（trailing）或悬挂（hanging）逗号

- 这样便于添加、删除和移动属性，因为所有的行都是相似的</code></pre></div>
<h2>方括号访问属性的灵活性</h2>
<p>🚩 对于多词属性，点操作就不能用了：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 这将提示有语法错误</span>
user<span class="token punctuation">.</span>likes birds <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token comment">// JavaScript 理解不了。它认为我们在处理 user.likes，然后在遇到意外的 birds 时给出了语法错误。</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 点符号要求 key 是''有效的变量标识符''。这意味着：''不包含空格，不以数字开头，也不包含特殊字符（允许使用 $ 和 _）''。


- 另一种方法，就是使用方括号，可用于任何字符串</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 设置</span>
user<span class="token punctuation">[</span><span class="token string">"likes birds"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// 读取</span>
<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">"likes birds"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 删除</span>
<span class="token keyword">delete</span> user<span class="token punctuation">[</span><span class="token string">"likes birds"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 请注意方括号中的字符串要放在引号中，单引号或双引号都可以</span></code></pre></div>
<p>🚩 方括号同样”提供了一种可以通过任意表达式来获取属性名的方法” —— 跟语义上的字符串不同 —— 比如像类似于下面的变量：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token string">"likes birds"</span><span class="token punctuation">;</span>

<span class="token comment">// 跟 user["likes birds"] = true; 一样</span>
user<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩”变量 key 可以是程序运行时计算得到的，也可以是根据用户的输入得到的。然后可以用它来访问属性。这给了我们很大的<code class="language-text">灵活性</code>。”</p>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"What do you want to know about the user?"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 访问变量</span>
<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John（如果输入 "name"）</span></code></pre></div>
<p>点符号不能以类似的方式使用：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span></code></pre></div>
<h2>计算属性 &#x26;&#x26; 方括号访问属性</h2>
<p>🚩 在对象字面量中，使用方括号</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> fruit <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Which fruit to buy?"</span><span class="token punctuation">,</span> <span class="token string">"apple"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> bag <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>fruit<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 属性名是从 fruit 变量中得到的</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>bag<span class="token punctuation">.</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5 如果 fruit="apple"</span></code></pre></div>
<p>🚩 本质上，这跟下面的语法效果相同：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> fruit <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Which fruit to buy?"</span><span class="token punctuation">,</span> <span class="token string">"apple"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bag <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 从 fruit 变量中获取值</span>
bag<span class="token punctuation">[</span>fruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></code></pre></div>
<h2>属性命名没有限制</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">变量名不能是编程语言的某个保留字，如 “for”、“let”、“return” 等……</code></pre></div>
<p>🚩 但”对象的属性名并不受此限制”：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 这些属性都没问题</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token keyword">let</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token keyword">return</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>for <span class="token operator">+</span> obj<span class="token punctuation">.</span>let <span class="token operator">+</span> obj<span class="token punctuation">.</span>return<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span></code></pre></div>
<p>🚩 简而言之，属性命名没有限制。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- ''属性名可以是任何字符串或者 symbol（一种特殊的标志符类型，将在后面介绍）''


- ''其他类型会被自动地转换为字符串''</code></pre></div>
<p>🚩 陷阱：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">名为 `__proto__ `的属性。不能将它设置为一个''非对象''的值</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 分配一个数字</span>
<span class="token function">alert</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Object] — 值为对象，与预期结果不同</span></code></pre></div>
<h2>对象有顺序吗?</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">对象有顺序吗？换句话说，如果我们遍历一个对象，我们获取属性的顺序是和属性添加时的顺序相同吗？这靠谱吗？

- 简短的回答是：“有特别的顺序”：''整数属性会被进行排序，其他属性则按照创建的顺序显示''

> 这里的“整数属性”指的是一个可以在不做任何更改的情况下与一个整数进行相互转换的字符串</code></pre></div>
<p>🚩 整数属性：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> codes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">49</span><span class="token operator">:</span> <span class="token string">"Germany"</span><span class="token punctuation">,</span>
  <span class="token number">41</span><span class="token operator">:</span> <span class="token string">"Switzerland"</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token operator">:</span> <span class="token string">"Great Britain"</span><span class="token punctuation">,</span>
  <span class="token comment">// ..,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">"USA"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> code <span class="token keyword">in</span> codes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 41, 44, 49</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩 非整数属性，按照创建时的顺序来排序：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  surname<span class="token operator">:</span> <span class="token string">"Smith"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span> <span class="token comment">// 增加一个</span>

<span class="token comment">// 非整数属性是按照创建的顺序来排列的</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> prop <span class="token keyword">in</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name, surname, age</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩 利用非整数属性名来欺骗程序：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> codes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">"+49"</span><span class="token operator">:</span> <span class="token string">"Germany"</span><span class="token punctuation">,</span>
  <span class="token string">"+41"</span><span class="token operator">:</span> <span class="token string">"Switzerland"</span><span class="token punctuation">,</span>
  <span class="token string">"+44"</span><span class="token operator">:</span> <span class="token string">"Great Britain"</span><span class="token punctuation">,</span>
  <span class="token comment">// ..,</span>
  <span class="token string">"+1"</span><span class="token operator">:</span> <span class="token string">"USA"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> code <span class="token keyword">in</span> codes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">+</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 49, 41, 44, 1</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>垃圾回收</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">JavaScript内存管理得重要概念-可达性（Reachability）

- ''可达值：以某种方式可访问或可用的值''

- ''根（roots）''：固有的可达值的基本集合（这些值明显不能被释放）：

    * 当前函数的局部变量和参数

    * 嵌套调用时，当前调用链上所有函数的变量与参数

    * 全局变量

    * 还有一些内部的</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''被引用与可访问（从一个根）不同''：一组相互连接的对象可能整体都不可达</code></pre></div>
<p><a href="https://zh.javascript.info/garbage-collection#ke-da-xing-reachability">https://zh.javascript.info/garbage-collection#ke-da-xing-reachability</a></p>
<h2>this</h2>
<p>💡<code class="language-text">this</code> 的值是在代码运行时计算出来的，它取决于<code class="language-text">代码上下文</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 如果你经常使用其他的编程语言，那么你可能已经习惯了“绑定 this”的概念，即在对象中定义的方法总是有指向该对象的 this


* 在 JavaScript 中，this 是“自由”的，它的值是在调用时计算出来的，它的值并不取决于方法声明的位置，而是取决于在“点符号前”的是什么对象


* 在运行时对 this 求值的这个概念既有优点也有缺点

    - 一方面，函数可以被重用于不同的对象

    - 另一方面，更大的灵活性造成了更大的出错的可能</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">如果 `obj.f()` 被调用了，则 `this` 在 `f` 函数调用期间是 `obj`</code></pre></div>
<h2>new 操作符</h2>
<p>🚩<code class="language-text">new</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">当一个函数被使用 new 操作符执行时，它按照以下步骤：

- 一个新的空对象被创建并分配给 this

- 函数体执行.通常它会修改 this，为其添加新的属性

- 返回 this 的值</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// `new User(...)` 做的就是类似的事情</span>
<span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// this = {};（隐式创建）</span>

  <span class="token comment">// 添加属性到 this</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isAdmin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">// return this;（隐式返回）</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩 <code class="language-text">return</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 通常，构造器没有 return 语句,任务是将所有必要的东西写入 this，并自动转换为结果

- 但是，如果这有一个 return 语句，那么规则就简单了：

    * ''如果 return 返回的是一个对象，则返回这个对象，而不是 this''

    * ''如果 return 返回的是一个原始类型，则忽略''</code></pre></div>
<p>🚩 思考题：是否可以创建像 new A() == new B() 这样的函数 A 和 B？</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span> a <span class="token operator">==</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">这是构造器的主要目的 —— 实现''可重用的对象创建''代码</code></pre></div>
<h2>new.target</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">在一个函数内部，可以使用 new.target 属性来检查/判断该函数是被

- 通过 new 调用的“构造器模式”

- 还是没被通过 new 调用的“常规模式”</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 不带 "new"：</span>
<span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>

<span class="token comment">// 带 "new"：</span>
<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function User { ... }</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果你没有通过 new 运行我</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ……我会给你添加 new</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将调用重定向到新用户</span>
<span class="token function">alert</span><span class="token punctuation">(</span>john<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span></code></pre></div>
<h2>?.可选链</h2>
<p>🚩<code class="language-text">不存在的属性”的问题</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 获取 user.address.street，而该用户恰好没提供地址信息，会收到一个错误：</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 一个没有 "address" 属性的 user 对象</span>

<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">这是预期的结果

- JavaScript 的工作原理就是这样的,但是在很多实际场景中，我们''更希望得到的是 undefined 而不是一个错误''</code></pre></div>
<p>可能最先想到的方案是在访问该值的属性之前，使用 if 或条件运算符 ? 对该值进行检查，像这样:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>address <span class="token operator">?</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>……但是不够优雅，💡”对于嵌套层次更深的属性就会出现更多次这样的重复，这就是问题了”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 例如，让我们尝试获取 user.address.street.name。既需要检查 user.address，又需要检查 user.address.street：</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// user 没有 address 属性</span>

<span class="token function">alert</span><span class="token punctuation">(</span>
  user<span class="token punctuation">.</span>address <span class="token operator">?</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street <span class="token operator">?</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>这样就”太扯淡了”，并且这可能导致写出来的代码很难让别人理解</p>
<p>更好的实现方式，就是 💡 使用 &#x26;&#x26; 运算符：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// user 没有 address 属性</span>

<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>address <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined（不报错</span></code></pre></div>
<p>但仍然不够优雅</p>
<p>🚩<code class="language-text">可选链</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''如果可选链 ?. 前面的部分是 undefined 或者 null，它会停止运算并返回该部分''</code></pre></div>
<p>🚩<code class="language-text">不要过度使用可选链</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''应该只将 ?. 使用在一些东西`可以不存在(null/undefined)`的地方''</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 例如，如果根据的代码逻辑，user 对象必须存在，但 address 是可选的，那么我们应该这样写 user.address?.street，而不是这样 user?.address?.street

- 所以，如果 user 恰巧因为失误变为 undefined，我们会看到一个编程错误并修复它。否则，代码中的错误在不恰当的地方被消除了，这会导致调试更加困难</code></pre></div>
<p>🚩<code class="language-text">短路效应</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">如果 ?. 左边部分不存在，就会立即停止运算（“短路效应”）</code></pre></div>
<p>🚩 <code class="language-text">其它变体：?.()，?.[]</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 可选链 ?. 不是一个运算符，而是一个特殊的语法结构

- 它还可以与函数和方括号一起使用</code></pre></div>
<h2>Symbol</h2>
<p>🚩Symbol 值表示唯一的标识符</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// id1 id2 是 symbol 的一个实例化对象, 描述都为"id"</span>
<span class="token keyword">let</span> id1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> id2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 描述相同的 Symbol —— 它们不相等</span>
<span class="token function">alert</span><span class="token punctuation">(</span>id1 <span class="token operator">==</span> id2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token function">alert</span><span class="token punctuation">(</span>id1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类型错误：无法将 Symbol 值自动转换为字符串。</span>

<span class="token function">alert</span><span class="token punctuation">(</span>id1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 toString 显示转化，现在它有效了</span>

<span class="token function">alert</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 或者获取 symbol.description 属性，只显示描述（description）</span></code></pre></div>
<p>🚩<code class="language-text">“隐藏”属性</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- ''Symbol 允许创建对象的“隐藏”属性

- 代码的任何其他部分都不能意外访问或重写这些属性''</code></pre></div>
<p>例如，💡”如果使用的是属于第三方代码的 user 对象，我们想要给它们添加一些标识符”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 属于另一个代码</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 Symbol("id") 作为键</span>
<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 Symbol 作为键来访问数据</span>
<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>📌<code class="language-text">使用 Symbol("id") 作为键，比起用字符串 "id" 来有什么好处呢</code>？</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 因为 user 对象属于其他的代码，那些代码也会使用这个对象，所以不应该在它上面直接添加任何字段，这样很不安全

- 但是添加的 Symbol 属性不会被意外访问到，''第三方代码根本不会看到它''，所以使用 Symbol 基本上不会有问题

- 另外，假设另一个脚本希望在 user 中有自己的标识符，以实现自己的目的

- 这可能是另一个 JavaScript 库，因此脚本之间完全不了解彼此

- 然后该脚本可以创建自己的 Symbol("id")</code></pre></div>
<p>像这样：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ...</span>
<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Their id value"</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 我们的标识符和它们的标识符之间不会有冲突

- 因为 Symbol 总是不同的，即使它们有相同的名字

- ……但如果我们处于同样的目的，使用字符串 "id" 而不是用 symbol，那么 就会 ''出现冲突''</code></pre></div>
<p>例如</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 我们的脚本使用了 "id" 属性。</span>
user<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">"Our id value"</span><span class="token punctuation">;</span>

<span class="token comment">// ……另一个脚本也想将 "id" 用于它的目的……</span>
user<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">"Their id value"</span><span class="token punctuation">;</span>

<span class="token comment">// 砰！无意中被另一个脚本重写了 id！</span></code></pre></div>
<p>🚩 <code class="language-text">跳过</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''Symbol 属性不参与 for..in 循环''</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> user<span class="token punctuation">)</span> <span class="token function">alert</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name, age (no symbols)</span>

<span class="token comment">// 使用 Symbol 任务直接访问</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Direct: "</span> <span class="token operator">+</span> user<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- ''Object.keys(xxx)也会忽略'',“隐藏符号属性”原则的一部分

- 相反，''Object.assign 会同时复制字符串和 symbol 属性''，

这里并不矛盾，就是这样设计的

- 这里的想法是当克隆或者合并一个 object 时，通常希望'' 所有 ''属性被复制（包括像 id 这样的 Symbol）</code></pre></div>
<p>🚩<code class="language-text">全局 symbol</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">`有时想要名字相同的 Symbol 具有相同的实体`</code></pre></div>
<p>例如，应用程序的不同部分想要访问的 Symbol “id” 指的是完全相同的属性。为了实现这一点，可以创建一个 ”全局 Symbol 注册表”。</p>
<p>要从注册表中读取（不存在则创建）Symbol，请使用 Symbol.for(key):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 从全局注册表中读取</span>
<span class="token keyword">let</span> id <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果该 Symbol 不存在，则创建它</span>

<span class="token comment">// 再次读取（可能是在代码中的另一个位置）</span>
<span class="token keyword">let</span> idAgain <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 相同的 Symbol</span>
<span class="token function">alert</span><span class="token punctuation">(</span>id <span class="token operator">===</span> idAgain<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<hr>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Symbol 不是 100% 隐藏的

- 内置方法 Object.getOwnPropertySymbols(obj) 允许获取所有的 Symbol

- 还有一个名为 Reflect.ownKeys(obj) 的方法可以返回一个对象的 所有 键，包括 Symbol</code></pre></div>
<p>所以它们并不是真正的隐藏</p>
<h2>使用两个点来调用一个方法</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2n9c</span></code></pre></div>
<p>🚩 如果想直接在一个数字上调用一个方法，比如上面例子中的 toString，那么需要在它后面放置两个点 <code class="language-text">..</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">如果放置一个点：`123456.toString(36)`，那么就会出现一个 error，因为 JavaScript 语法隐含了第一个点之后的部分为小数部分

如果再放一个点，那么 JavaScript 就知道小数部分为空，现在使用该方法

也可以写成 `(123456).toString(36)`</code></pre></div>
<h2>为什么 0.1 + 0.2 不等于 0.3?</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">==</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.30000000000000004</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 在十进制数字系统中，可以保证以 10 的整数次幂作为除数能够正常工作，但是以 3 作为除数则不能(1/3 * 3 = 1 1/3 = 0.3333... 无限循环)

- 也是同样的原因，在二进制数字系统中，可以保证以 2 的整数次幂作为除数时能够正常工作，但 1/10 就变成了一个无限循环的二进制小数

- 使用二进制数字系统无法 精确 存储 0.1 或 0.2，就像没有办法将三分之一存储为十进制小数一样

- IEEE-754 数字格式通过将数字舍入到最接近的可能数字来解决此问题,这些舍入规则通常不允许看到的“极小的精度损失”，但是它确实存在。</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">-</span> 不仅仅是 JavaScript
许多其他编程语言也存在同样的问题

<span class="token operator">-</span> <span class="token constant">PHP</span>，Java，<span class="token constant">C</span>，Perl，Ruby 给出的也是完全相同的结果，因为它们基于的是相同的数字格式</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 有时候我们可以尝试完全避免小数

- 例如，正在创建一个电子购物网站，那么可以用角而不是元来存储价格。但是，如果要打 30% 的折扣呢？

- ''实际上，完全避免小数处理几乎是不可能的。只需要在必要时剪掉其“尾巴”来对其进行舍入即可''</code></pre></div>
<h2>两个零</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">数字内部表示的另一个有趣结果是存在两个零：

- 0

- -0

这是因为在存储时，使用一位来存储符号，因此对于包括零在内的任何数字，可以设置这一位或者不设置

在大多数情况下，这种区别并不明显，因为运算符将它们视为相同的值</code></pre></div>
<h2>isFinite 和 isNaN</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">两个特殊的数值

- Infinity（和 -Infinity）是一个特殊的数值，比任何数值都大（小）

- NaN 代表一个 error</code></pre></div>
<p>🚩 <code class="language-text">isNaN</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">isNaN(value) 将其参数转换为数字，然后测试它是否为 NaN</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">但是需要这个函数吗？不能只使用 `=== NaN` 比较吗？

- 不好意思，这不行

- `值 “NaN” 是独一无二的，它不等于任何东西，包括它自身`</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span></code></pre></div>
<p>🚩 <code class="language-text">isFinite</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">isFinite(value) 将其参数转换为数字，如果是常规数字，则返回 true，而不是 NaN/Infinity/-Infinity</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token string">"15"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，因为是一个特殊的值：NaN</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，因为是一个特殊的值：Infinity</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">有时 isFinite 被用于验证字符串值是否为常规数字</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token operator">+</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Enter a number"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 结果会是 true，除非你输入的是 Infinity、-Infinity 或不是数字</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">isFinite</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Object.is</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">有一个特殊的内建方法 Object.is，它类似于 === 一样对值进行比较，但它对于`两种边缘情况`更可靠：

* 它适用于 `NaN`：`Object.is（NaN，NaN）=== true`，这是件好事。

* 值 `0` 和 `-0` 是不同的：`Object.is（0，-0）=== false`，从技术上讲这是对的，因为在内部，数字的符号位可能会不同，即使其他所有位均为零。

- ''在所有其他情况下，Object.is(a，b) 与 a === b 相同。''</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 这种比较方式经常被用在 JavaScript 规范中

- 当内部算法需要比较两个值是否完全相同时，它使用 Object.is（内部称为 SameValue）

- https://tc39.es/ecma262/#sec-samevalue</code></pre></div>
<h2>在所有数字函数中，空字符串或仅有空格的字符串均被视为 0</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
<span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>

<span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
<span class="token operator">+</span><span class="token string">"    "</span><span class="token punctuation">;</span> <span class="token comment">//0</span></code></pre></div>
<h2>随机数</h2>
<p>🚩 从 min 到 max 的随机数</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 将区间 0…1 中的所有值“映射”为范围在 min 到 max 中的值</span>
<span class="token comment">// 1.将 0…1 的随机数乘以 max-min，则随机数的范围将从 0…1 增加到 0..max-min</span>
<span class="token comment">// 2.将随机数与 min 相加，则随机数的范围将为 min 到 max</span>

<span class="token keyword">function</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> min <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 从 min 到 max 的随机整数</p>
<p>👉”错误的方案”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">randomInteger</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> rand <span class="token operator">=</span> min <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">randomInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>获得边缘值 min 和 max 的概率比其他值”低两倍”;💡 因为 Math.round() 从范围 1..3 中获得随机数，并按如下所示进行四舍五入：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">values from <span class="token number">1</span>    <span class="token operator">...</span> to <span class="token number">1.4999999999</span>  become <span class="token number">1</span>
values from <span class="token number">1.5</span>  <span class="token operator">...</span> to <span class="token number">2.4999999999</span>  become <span class="token number">2</span>
values from <span class="token number">2.5</span>  <span class="token operator">...</span> to <span class="token number">2.9999999999</span>  become <span class="token number">3</span></code></pre></div>
<p>👉”正确的解决方案”</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">方法一：调整取值范围的边界</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">//为了确保相同的取值范围，我们可以生成从 0.5 到 3.5 的值，从而将所需的概率添加到取值范围的边界</span>

<span class="token keyword">function</span> <span class="token function">randomInteger</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 现在范围是从  (min-0.5) 到 (max+0.5)</span>
  <span class="token keyword">let</span> rand <span class="token operator">=</span> min <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">randomInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">方法二：使用 `Math.floor`</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">randomInteger</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// here rand is from min to (max+1)</span>
  <span class="token keyword">let</span> rand <span class="token operator">=</span> min <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">randomInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">间隔都以这种方式映射</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">values from <span class="token number">1</span>  <span class="token operator">...</span> to <span class="token number">1.9999999999</span>  become <span class="token number">1</span>
values from <span class="token number">2</span>  <span class="token operator">...</span> to <span class="token number">2.9999999999</span>  become <span class="token number">2</span>
values from <span class="token number">3</span>  <span class="token operator">...</span> to <span class="token number">3.9999999999</span>  become <span class="token number">3</span></code></pre></div>
<h2>Unicode 规范化形式</h2>
<p><a href="http://www.unicode.org/reports/tr15/">http://www.unicode.org/reports/tr15/</a></p>
<p><a href="http://www.unicode.org/">http://www.unicode.org/</a></p>
<h2>代理对</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">所有常用的字符都是一个 2 字节的代码

大多数欧洲语言，数字甚至大多数象形文字中的字母都有 2 字节的表示形式

但 2 字节只允许 65536 个组合，这对于表示每个可能的符号是不够的

所以稀有的符号被称为“''代理对''”的一对 2 字节的符号编码</code></pre></div>
<p>这些符号的”长度是 2”：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"𝒳"</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，大写数学符号 X</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"😂"</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，笑哭表情</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"𩷶"</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，罕见的中国象形文字</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">`String.fromCharCode` 和 `str.charCodeAt`

与

`String.fromCodePoint` 和 `str.codePointAt`，差不多


但是不适用于''代理对''</code></pre></div>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String</a></p>
<h2>JavaScript-Array</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''JavaScript 中的数组

- 既可以用作队列，

- 也可以用作栈''

''允许从首端/末端来添加/删除元素''

- 这在计算机科学中，允许这样的操作的数据结构被称为 双端队列（deque）

- https://en.wikipedia.org/wiki/Double-ended_queue</code></pre></div>
<h2>JavaScript-数组误用的几种方式</h2>
<p>🚩 数组误用的几种方式</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 1. 添加一个非数字的属性，比如 :</span>
arr<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token number">5</span>。


<span class="token comment">// 2. 制造空洞，比如：添加 arr[0]，然后添加 arr[1000] (它们中间什么都没有)。</span>

arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'first'</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'last'</span><span class="token punctuation">;</span>


<span class="token comment">// 3. 以倒序填充数组，比如 arr[1000]，arr[999] 等等。</span>

arr<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">JavaScript中数组是一种特殊的【对象】

- 请将数组视为作用于 ''有序数据'' 的特殊结构

- ''数组在 JavaScript 引擎内部是经过特殊调整的，使得更好地作用于连续的有序数据，所以请以正确的方式使用数组''

- 如果需要任意键值，那很有可能实际上需要的是常规对象 {}</code></pre></div>
<h2>JavaScript - 关于 Array 的 “length”</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一，当修改数组的时候，length 属性会自动更新</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
fruits<span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Apple"</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>fruits<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 124</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">二，数组的length 属性是可写的</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 如果手动增加它，则不会发生任何有趣的事儿。但是如果减少它，数组就会被截断。该过程是不可逆的，下面是例子：</span>

<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 截断到只剩 2 个元素</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2]</span>

arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 又把 length 加回来</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined：被截断的那些数值并没有回来</span></code></pre></div>
<p>📌 所以，”清空数组最简单的方法就是：<code class="language-text">arr.length = 0</code>”</p>
<h2>thisArg</h2>
<p>🚩<code class="language-text">users.filter(user => army.canJoin(user))</code> 替换为<code class="language-text">users.filter(army.canJoin, army)</code>
的区别？</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">用 users.filter(user => army.canJoin(user)) 替换对 users.filter(army.canJoin, army) 的调用

- 前者的使用频率更高

- 因为对于大多数人来说，它更容易理解</code></pre></div>
<h2>显式调用迭代器</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>

<span class="token comment">// 和 for..of 做相同的事</span>
<span class="token comment">// for (let char of str) alert(char);</span>

<span class="token keyword">let</span> iterator <span class="token operator">=</span> str<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个接一个地输出字符</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Symbol.iterator</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>希望 for..of 这样运行：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> num <span class="token keyword">of</span> range<span class="token punctuation">)</span> <span class="token operator">...</span> num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span></code></pre></div>
<p>注释的 range 的完整实现</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 1. for..of 调用首先会调用这个：</span>
range<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ……它返回迭代器对象（iterator object）：</span>
  <span class="token comment">// 2. 接下来，for..of 仅与此迭代器一起工作，要求它提供下一个值</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    current<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">,</span>
    last<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">,</span>

    <span class="token comment">// 3. next() 在 for..of 的每一轮循环迭代中被调用</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 4. 它将会返回 {done:.., value :...} 格式的对象</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 现在它可以运行了！</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> num <span class="token keyword">of</span> range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 然后是 2, 3, 4, 5</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩”注意可迭代对象的核心功能：<code class="language-text">关注点分离</code>”</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- range 自身没有 next() 方法

- 相反，是通过调用 range[Symbol.iterator]() 创建了另一个对象，即所谓的“迭代器”对象，并且它的 next 会为迭代生成值。</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''迭代器对象和与其进行迭代的对象是分开的''</code></pre></div>
<p>🚩 可迭代对象必须实现 <code class="language-text">Symbol.iterator</code> 方法</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* `obj[Symbol.iterator]()` 的结果被称为 `迭代器（iterator）`。由它处理进一步的迭代过程。

*一个迭代器必须有 `next()` 方法，它返回一个 `{done: Boolean, value: any}` 对象，这里 `done:true` 表明迭代结束，否则 value 就是下一个值</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">`Symbol.iterator `方法会被 `for..of `自动调用

内置的可迭代对象例如字符串和数组，都实现了 `Symbol.iterator`</code></pre></div>
<h2>可迭代（iterable）和类数组（array-like）</h2>
<p>🚩 可迭代（iterable）和类数组（array-like）</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Iterable 是实现了 Symbol.iterator 方法的对象</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Array-like 是有索引和 length 属性的对象（所以它们看起来很像数组）</code></pre></div>
<p><code class="language-text">一个可迭代对象也许不是类数组对象。反之亦然，类数组对象可能不可迭代</code></p>
<p>🚩 如果有一个这样的对象，并想像数组那样操作它?</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">有一个全局方法 `Array.from` 可以接受一个`可迭代或类数组的值`，并从中获取一个“真正的”数组

然后就可以对其调用数组方法了

`Array.from(obj[, mapFn, thisArg])` 将`可迭代对象`或`类数组对象` obj 转化为`真正的数组 Array`</code></pre></div>
<h2>Map 可以使用对象作为键</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 存储每个用户的来访次数</span>
<span class="token keyword">let</span> visitsCountMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// john 是 Map 中的键</span>
visitsCountMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>visitsCountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- ''使用对象作为键是 Map 最值得注意和重要的功能之一''

- 对于字符串键，Object（普通对象）也能正常使用，但对于对象键则不行</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> visitsCountObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 尝试使用对象</span>

visitsCountObj<span class="token punctuation">[</span>john<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// 尝试将 john 对象作为键</span>

<span class="token comment">// 是写成了这样!</span>
<span class="token function">alert</span><span class="token punctuation">(</span>visitsCountObj<span class="token punctuation">[</span><span class="token string">"[object Object]"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span>

<span class="token comment">// 因为 `visitsCountObj` 是一个对象，它会将所有的键如 john 转换为字符串，所以得到字符串键 `"[object Object]"`</span></code></pre></div>
<h2>Map 是怎么比较键的？</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* Map 使用 SameValueZero 算法来比较键是否相等

* 它和严格等于 === 差不多，但区别是

- NaN 被看成是等于 NaN所以 NaN 也可以被用作键

- 0 不等于 -0

这个算法不能被改变或者自定义</code></pre></div>
<p><a href="https://tc39.github.io/ecma262/#sec-samevaluezero">https://tc39.github.io/ecma262/#sec-samevaluezero</a></p>
<h2>Map 链式调用</h2>
<p>每一次 map.set 调用都会返回 map 本身，所以可以进行“链式”调用：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"str1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"num1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"bool1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Map 迭代</h2>
<p>可以使用以下三个方法:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一，遍历所有的键</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">map<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> —— 遍历并返回所有的键（returns an iterable <span class="token keyword">for</span> keys）</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">二，遍历所有的值</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">map.values() —— 遍历并返回所有的值（returns an iterable for values）</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">三，遍历所有的实体</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">map<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> —— 遍历并返回所有的实体（returns an iterable <span class="token keyword">for</span> entries）

<span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span>，<span class="token keyword">for</span><span class="token punctuation">.</span><span class="token punctuation">.</span>of 在默认情况下使用的就是这个</code></pre></div>
<h2>Map 使用插入顺序</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 迭代的顺序与插入值的顺序相同

* 与普通的 Object 不同，Map 保留了此顺序'</code></pre></div>
<h2>Map 有内置的 forEach 方法</h2>
<p>与 Array 类似</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> recipeMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">"cucumber"</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"tomatoes"</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"onion"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对每个键值对 (key, value) 运行 forEach 函数</span>
recipeMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> map</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cucumber: 500 etc</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Object.entries：从对象创建 Map</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">如果想从一个已有的普通对象（plain object）来创建一个 Map

那么可以使用内建方法 `Object.entries(obj)`

''该方法返回对象的键/值对数组，该数组格式完全按照 Map 所需的格式''</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* `Object.entries` 返回`键/值对数组：[ ["name","John"], ["age", 30] ]`

* 这就是 Map 所需要的格式</code></pre></div>
<h2>Object.fromEntries：从 Map 创建对象</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">`Object.fromEntries` 方法的作用和`Object.entries(obj)`的使用是相反的</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">给定一个具有 [key, value] 键值对的数组，它会根据给定数组创建一个对象</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> prices <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"meat"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 现在 prices = { banana: 1, orange: 2, meat: 4 }</span>

<span class="token function">alert</span><span class="token punctuation">(</span>prices<span class="token punctuation">.</span>orange<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span></code></pre></div>
<h2>Set 迭代（iteration）</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">可以使用

- `for..of`

- 或 `forEach`

来遍历 `Set`</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一，使用  `for..of`</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"oranges"</span><span class="token punctuation">,</span> <span class="token string">"apples"</span><span class="token punctuation">,</span> <span class="token string">"bananas"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> set<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">二，使用 `forEach` 来遍历</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"oranges"</span><span class="token punctuation">,</span> <span class="token string">"apples"</span><span class="token punctuation">,</span> <span class="token string">"bananas"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 于数组 forEach 类似 ，与  Map forEach 相同：</span>
set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> valueAgain<span class="token punctuation">,</span> <span class="token keyword">set</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">forEach 的回调函数有三个参数：

- 一个 value

- 然后是 同一个值 valueAgain

- 最后是目标对象

没错，同一个值在参数里出现了两次

* 👍forEach 的回调函数有三个参数，是为了与 Map 兼容 - 底层实现是一致的</code></pre></div>
<p>🚩Map 中用于迭代的方法在 Set 中也同样支持：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一，`set.keys()`</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">set.keys() —— 遍历并返回所有的值（returns an iterable object for values）</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">二，`set.values()`</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">set.values() —— 与 set.keys() 作用相同，这是为了兼容 Map</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">三，`set.entries()`</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">set.entries() —— 遍历并返回所有的实体（returns an iterable object for entries）[value, value]，它的存在也是为了兼容 Map</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">`''Set 和 Map 是兼容的''`</code></pre></div>
<h2>WeakMap 和 Map 的区别</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一，WeakMap 的键必须是对象，不能是原始值</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> weakMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正常工作（以对象作为键）</span>

<span class="token comment">// 不能使用字符串作为键</span>
weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"Whoops"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error，因为 "test" 不是一个对象</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">二，如果在 WeakMap 中使用一个对象作为键，并且没有其他对这个对象的引用 —— 该对象将会被从内存（和Map）中''自动清除''</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> weakMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 覆盖引用</span>

<span class="token comment">// john 被从内存中删除了！</span></code></pre></div>
<p>🚩JavaScript 引擎在值可访问（并可能被使用）时将其存储在内存中</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 该对象能被访问，john 是它的引用</span>

<span class="token comment">// 覆盖引用</span>
john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">// 该对象将会被从内存中清除</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">通常，当对象、数组这类数据结构在内存中时，它们的子元素，如对象的属性、数组的元素都是可以访问的</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">例如，如果把一个对象放入到数组中，那么只要这个数组存在，那么这个对象也就存在，即使没有其他对该对象的引用</code></pre></div>
<p>就像这样:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span>john<span class="token punctuation">]</span><span class="token punctuation">;</span>

john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 覆盖引用</span>

<span class="token comment">// 前面由 john 所引用的那个对象被存储在了 array 中</span>

<span class="token comment">// 所以它不会被垃圾回收机制回收</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">💡类似的，如果使用对象作为常规 Map 的键，那么当 Map 存在时，该对象也将存在；它会占用内存，并且应该不会被（垃圾回收机制）回收</code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 覆盖引用</span>

<span class="token comment">// john 被存储在了 map 中，</span>
<span class="token comment">// 我们可以使用 map.keys() 来获取它</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">👍WeakMap 在这方面有着根本上的不同；它不会阻止垃圾回收机制对作为键的对象（key object）的回收</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">三，WeakMap 不支持''迭代''以及 `keys()`，`values()` 和 `entries()` 方法;所以没有办法获取 WeakMap 的所有键或值</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">WeakMap 只有以下的方法：

<span class="token operator">-</span> weakMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token operator">-</span> weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

<span class="token operator">-</span> weakMap<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token operator">-</span> weakMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">从技术上讲，WeakMap 的当前元素的数量是[未知的]

- JavaScript 引擎可能清理了其中的垃圾

- 可能没清理

- 也可能清理了一部分

因此，暂不支持访问 WeakMap 的所有键/值的方法</code></pre></div>
<h2>WeakMap 使用场景：额外的数据</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">假如正在处理一个“属于”另一个代码的一个对象，也可能是第三方库，并想存储一些与之相关的数据，那么这些数据就应该与这个对象【共存亡】

—— 这时候 WeakMap 正是我们所需要的利器👍


- 将这些数据放到 WeakMap 中，并使用该对象作为这些数据的键，那么当该对象被垃圾回收机制回收后，这些数据也会被自动清除</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token string">"secret documents"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果 john 消失，secret documents 将会被自动清除</span></code></pre></div>
<p>🚩 例如，有用于处理用户访问计数的代码</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">收集到的信息被存储在 map 中：

- 一个用户对象作为键，其访问次数为值

- 当一个用户离开时（该用户对象将被垃圾回收机制回收），这时我们就不再需要他的访问次数了</code></pre></div>
<p>使用 Map 的计数函数的例子:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 📁 visitsCount.js</span>
<span class="token keyword">let</span> visitsCountMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// map: user => visits count</span>

<span class="token comment">// 递增用户来访次数</span>
<span class="token keyword">function</span> <span class="token function">countUser</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> visitsCountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  visitsCountMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/** 其他部分的代码，可能是使用它的其它代码 **/</span>

<span class="token comment">// 📁 main.js</span>
<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">countUser</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count his visits</span>

<span class="token comment">// 不久之后，john 离开了</span>
john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">/**

现在 john 这个对象应该被垃圾回收，但他仍在内存中，因为它是 visitsCountMap 中的一个键

当移除用户时，需要清理 visitsCountMap，否则它将在内存中无限增大。在复杂的架构中，这种清理会成为一项繁重的任务

**/</span></code></pre></div>
<p>📌<code class="language-text">可以通过使用 WeakMap 来避免这样的问题</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 📁 visitsCount.js</span>
<span class="token keyword">let</span> visitsCountMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// weakmap: user => visits count</span>

<span class="token comment">// 递增用户来访次数</span>
<span class="token keyword">function</span> <span class="token function">countUser</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> visitsCountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  visitsCountMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/** 
现在不需要去清理 visitsCountMap 了。当 john 对象变成不可访问时，即便它是 WeakMap 里的一个键，它也会连同它作为 WeakMap 里的键所对应的信息一同被从内存中删除
**/</span></code></pre></div>
<h2>WeakMap 使用场景：缓存</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">当一个函数的结果需要被记住（“缓存”）

这样在后续的对同一个对象的调用时，就可以重用这个被缓存的结果</code></pre></div>
<p>🚩 使用 Map 来存储结果</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">/</span> 📁 cache<span class="token punctuation">.</span>js
<span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 计算并记住结果</span>
<span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token comment">/* calculations of the result for */</span> obj<span class="token punctuation">;</span>

    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 现在我们在其它文件中使用 process()</span>

<span class="token comment">// 📁 main.js</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">/* 假设我们有个对象 */</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> result1 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算完成</span>

<span class="token comment">// ……稍后，来自代码的另外一个地方……</span>
<span class="token keyword">let</span> result2 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取自缓存的被记忆的结果</span>

<span class="token comment">// ……稍后，我们不再需要这个对象时：</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1（啊！该对象依然在 cache 中，并占据着内存！）</span>


<span class="token comment">/**
对于多次调用同一个对象，它只需在第一次调用时计算出结果，之后的调用可以直接从 cache 中获取。这样做的缺点是，当不再需要这个对象的时候需要清理 cache
**/</span></code></pre></div>
<p>📌<code class="language-text">用 WeakMap 替代 Map，这个问题便会消失：当对象被垃圾回收时，对应的缓存的结果也会被自动地从内存中清除</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 📁 cache.js</span>
<span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 计算并记结果</span>
<span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token comment">/* calculate the result for */</span> obj<span class="token punctuation">;</span>

    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 📁 main.js</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* some object */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> result1 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result2 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ……稍后，我们不再需要这个对象时：</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">// 无法获取 cache.size，因为它是一个 WeakMap，</span>
<span class="token comment">// 要么是 0，或即将变为 0</span>
<span class="token comment">// 当 obj 被垃圾回收，缓存的数据也会被清除</span></code></pre></div>
<h2>WeakSet 和 Set 的区别</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一，只能向 WeakSet 添加对象（而不能是原始值）</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">二，对象只有在其它某个（些）地方能被访问的时候，才能留在 set 中</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">三，跟WeakMap类似 支持 `add`，`has` 和 `delete` 方法，但不支持 `size` 和 `keys()`，并且不可`迭代`</code></pre></div>
<h2><em>.keys()，</em>.values()，*entries()</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> `*.keys()，*.values()，*entries()`  对于 `Array`  `Map` `Set`是通用的，对于普通对象有所不同</code></pre></div>
<p>| | <code class="language-text">Array</code>
<code class="language-text">Map</code>
<code class="language-text">Set</code> | <code class="language-text">Object</code> |
| --- | --- | --- |
| 调用语法 | <code class="language-text">arr.keys()</code>
<code class="language-text">map.keys()</code>
<code class="language-text">set.keys()</code> | <code class="language-text">Object.keys(obj)</code>
，而不是 <code class="language-text">obj.keys()</code> |
| 返回值 | 可迭代项 | ”“真正的”数组” |</p>
<p>🚩 两个重要的区别：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一，对于对象使用的调用语法是 `Object.keys(obj)`，而不是 `obj.keys()`</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">主要原因是<span class="token string">''</span>灵活性<span class="token string">''</span>

<span class="token operator">-</span> <span class="token string">''</span>在 JavaScript 中，对象是所有复杂结构的基础<span class="token string">''</span>

<span class="token operator">-</span> 因此，可能有一个自己创建的对象，比如 data，并实现了它自己的 data<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 方法

<span class="token operator">-</span> 同时，依然可以对它调用 Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> 方法</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">二，`Object.*` 方法返回的是''“真正的”数组''对象，而不只是一个可迭代项</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">这主要是历史原因<span class="token punctuation">;</span></code></pre></div>
<p>🚩 会忽略 <code class="language-text">symbol</code> 属性</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> `*.keys()，*.values()，*entries()`会忽略 `symbol` 属性</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">就像 `for..in` 循环一样，这些方法会忽略使用 `Symbol(...)` 作为键的属性</code></pre></div>
<p>🚩 但是，如果也想要 Symbol 类型的键，那么这儿有一个单独的方法</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Object.getOwnPropertySymbols

- https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols

- 它会返回一个只包含 Symbol 类型的键的数组

另外，还有一种方法 Reflect.ownKeys(obj)

- https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys

- 它会返回 所有 键</code></pre></div>
<h2>数组解构</h2>
<p>🚩 解构数组的完整语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>item1 <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">,</span> item2<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">]</span> <span class="token operator">=</span> array</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">数组是一个存储数据的''有序''集合，`因此解构特征和数据顺序相关`</code></pre></div>
<p>🚩 一，“解构”并不意味着“破坏”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> surname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Ilya Kantor"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这种语法叫做“解构赋值”，因为它通过将结构中的各元素复制到变量中来达到“解构”的目的。但数组本身是没有被修改的。</span>

<span class="token comment">// 这只是下面这些代码的更精简的写法而已：</span>

<span class="token comment">// let [firstName, surname] = arr;</span>
<span class="token keyword">let</span> firstName <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> surname <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 二，忽略使用逗号的元素</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 数组中不想要的元素也可以通过添加额外的逗号来把它丢弃</span>

<span class="token comment">// 不需要第二个元素</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> <span class="token punctuation">,</span> title<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">"Julius"</span><span class="token punctuation">,</span>
  <span class="token string">"Caesar"</span><span class="token punctuation">,</span>
  <span class="token string">"Consul"</span><span class="token punctuation">,</span>
  <span class="token string">"of the Roman Republic"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Consul</span></code></pre></div>
<p>🚩 三，等号右侧可以是任何可迭代对象</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span> <span class="token comment">// ["a", "b", "c"]</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 四，赋值给等号左侧的任何内容</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 可以在等号左侧使用任何“可以被赋值的”东西。</span>

<span class="token comment">// 例如，一个对象的属性：</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>surname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Ilya Kantor"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 五，与 .entries() 方法进行循环操作</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 循环遍历键—值对</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:John, then age:30</span>
<span class="token punctuation">}</span></code></pre></div>
<p>对于 map 对象也类似：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"John"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"30"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:John, then age:30</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩 六，交换变量的典型技巧</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> guest <span class="token operator">=</span> <span class="token string">"Jane"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> admin <span class="token operator">=</span> <span class="token string">"Pete"</span><span class="token punctuation">;</span>

<span class="token comment">// 交换值：让 guest=Pete, admin=Jane</span>
<span class="token punctuation">[</span>guest<span class="token punctuation">,</span> admin<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>admin<span class="token punctuation">,</span> guest<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>guest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>admin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Pete Jane（成功交换！）</span></code></pre></div>
<p>🚩 七，剩余的 <code class="language-text">…</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">"Julius"</span><span class="token punctuation">,</span>
  <span class="token string">"Caesar"</span><span class="token punctuation">,</span>
  <span class="token string">"Consul"</span><span class="token punctuation">,</span>
  <span class="token string">"of the Roman Republic"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>name1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Julius</span>
<span class="token function">alert</span><span class="token punctuation">(</span>name2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Caesar</span>

<span class="token comment">// 请注意，`rest` 的类型是数组</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Consul</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// of the Roman Republic</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span></code></pre></div>
<p>🚩 八，默认值</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> surname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token function">alert</span><span class="token punctuation">(</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 默认值</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>name <span class="token operator">=</span> <span class="token string">"Guest"</span><span class="token punctuation">,</span> surname <span class="token operator">=</span> <span class="token string">"Anonymous"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Julius"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Julius（来自数组的值）</span>
<span class="token function">alert</span><span class="token punctuation">(</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Anonymous（默认值被使用了）</span></code></pre></div>
<h2>对象解构</h2>
<p>🚩 解构对象的完整语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">{</span>prop <span class="token operator">:</span> varName <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">}</span> <span class="token operator">=</span> object</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">对象是''通过键来存储数据项的单个实体''，`因此结构特征和键相关`</code></pre></div>
<p>🚩 一，等号左侧包含被解构对象相应属性的一个“模式（pattern）”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 在简单的情况下，等号左侧的就是 被解构对象 中的变量名列表</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">"Menu"</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span></code></pre></div>
<p>🚩 二，剩余模式（pattern）<code class="language-text">…</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">"Menu"</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// title = 名为 title 的属性</span>
<span class="token comment">// rest = 存有剩余属性的对象</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>

<span class="token comment">// 现在 title="Menu", rest={height: 200, width: 100}</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span></code></pre></div>
<p>🚩 三，嵌套解构</p>
<p>可以在等号左侧使用更复杂的模式（pattern）来提取更深层的数据</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> <span class="token punctuation">{</span>
    width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    height<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Cake"</span><span class="token punctuation">,</span> <span class="token string">"Donut"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  extra<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 为了清晰起见，解构赋值语句被写成多行的形式</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把 size 赋值到这里</span>
    width<span class="token punctuation">,</span>
    height<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  items<span class="token operator">:</span> <span class="token punctuation">[</span>item1<span class="token punctuation">,</span> item2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 把 items 赋值到这里</span>
  title <span class="token operator">=</span> <span class="token string">"Menu"</span><span class="token punctuation">,</span> <span class="token comment">// 在对象中不存在（使用默认值）</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span>
<span class="token function">alert</span><span class="token punctuation">(</span>item1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cake</span>
<span class="token function">alert</span><span class="token punctuation">(</span>item2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Donut</span></code></pre></div>
<p>🚩”四，智能函数参数”</p>
<p>有时，一个函数可能有很多参数，其中大部分的参数都是可选的</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 实现这种函数的一个很不好的写法</span>

<span class="token keyword">function</span> <span class="token function">showMenu</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"Untitled"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 缺点一：参数的顺序</span>

<span class="token comment">// 缺点二：可读性会变得很差</span></code></pre></div>
<p>📌”可以把所有参数当作一个对象来传递，然后函数马上把这个对象解构成多个变量”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 传递一个对象给函数</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">"My menu"</span><span class="token punctuation">,</span>
  items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Item1"</span><span class="token punctuation">,</span> <span class="token string">"Item2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ……然后函数马上把对象展开成变量</span>
<span class="token keyword">function</span> <span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title <span class="token operator">=</span> <span class="token string">"Untitled"</span><span class="token punctuation">,</span>
  width <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
  height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
  items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// title, items – 提取于 options，</span>
  <span class="token comment">// width, height – 使用默认值</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// My Menu 200 100</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Item1, Item2</span>
<span class="token punctuation">}</span>

<span class="token function">showMenu</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>如果想让所有的参数都使用默认值，那应该传递一个空对象：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不错，所有值都取默认值</span>

<span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这样会导致错误</span></code></pre></div>
<p>📌<code class="language-text">可以通过指定空对象 {} 为整个参数对象的默认值来解决这个问题：</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title <span class="token operator">=</span> <span class="token string">"Menu"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">200</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Menu 100 200</span></code></pre></div>
<p>🚩”五，不使用 let 时的陷阱”</p>
<p>以下代码无法正常运行：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">;</span>

<span class="token comment">// 这一行发生了错误</span>
<span class="token punctuation">{</span>title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>title<span class="token operator">:</span> <span class="token string">"Menu"</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>”问题在于 JavaScript 把主代码流（即不在其他表达式中）的 <code class="language-text">{...}</code> 当做一个代码块。这样的代码块可以用于对语句分组，如下所示：”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token comment">// 一个代码块</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>”为了告诉 JavaScript 这不是一个代码块，可以把整个赋值表达式用括号 <code class="language-text">(...)</code> 包起来”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">;</span>

<span class="token comment">// 现在就可以了</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">"Menu"</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Menu</span></code></pre></div>
<h2>日期和时间</h2>
<p><a href="https://zh.javascript.info/date">https://zh.javascript.info/date</a></p>
<h2>JSON 方法，toJSON</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">JSON （JavaScript Object Notation） 是一种数据格式（表示值和对象的通用格式），具有自己的独立标准和大多数编程语言的库</code></pre></div>
<p>[[RFC 4627 标准中有对其的描述|http://tools.ietf.org/html/rfc4627]]</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">JSON 支持

    - Objects { ... }

    - Arrays [ ... ]

    - Primitives：

        - strings

        - numbers

        - boolean (true/false)

        - null</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* JSON 是语言无关的纯数据规范

* 因此一些特定于 JavaScript 的对象属性会被 JSON.stringify 跳过

    - 函数属性（方法）

    - Symbol 类型的属性

    - 存储 undefined 的属性</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''重要的限制：不得有循环引用''</code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 被忽略</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token comment">// 被忽略</span>
  something<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token comment">// 被忽略</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {}（空对象）</span></code></pre></div>
<p>🚩 如何解决？（自定义转换）</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">JavaScript 提供序列化（serialize）成 JSON 的方法 JSON.stringify 和解析 JSON 的方法 JSON.parse

这两种方法都支持用于智能读/写的转换函数</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">`JSON.stringify(student)` 得到的 json 字符串是一个被称为'' JSON 编码（JSON-encoded'' 或  或 ''字符串化（stringified）'' 或 ''编组化（marshalled）'' 的对象''序列化（serialized）''</code></pre></div>
<p>🚩<code class="language-text">JSON.stringify</code> 的完整语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span><span class="token punctuation">,</span> replacer<span class="token punctuation">,</span> space<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>🚩<code class="language-text">JSON.parse</code>的完整语法：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">let value = JSON.parse(str, [reviver]);</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">如果一个对象具有 toJSON，那么它会被 JSON.stringify 调用</code></pre></div>
<h2>Spread 语法</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">其实 `任何可迭代对象都可以`</code></pre></div>
<p>🚩Spread 语法内部使用了迭代器来收集元素，与 for..of 的方式相同</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>str<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// H,e,l,l,o</span>

<span class="token comment">// 对于一个字符串，for..of 会逐个返回该字符串中的字符，...str 也同理会得到 "H","e","l","l","o" 这样的结果。随后，字符列表被传递给数组初始化器 [...str]</span>

<span class="token comment">// 还可以使用 Array.from 来实现，运行结果与 [...str] 相同</span>

<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>

<span class="token comment">// Array.from 将可迭代对象转换为数组</span>
<span class="token function">alert</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// H,e,l,l,o</span></code></pre></div>
<p>🚩 不过 Array.from(obj) 和 […obj] 存在一个细微的差别</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- Array.from 适用于类数组对象也适用于可迭代对象


- Spread 语法只适用于可迭代对象</code></pre></div>
<h2>Spread 语法 Array.from(obj) 的差别</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">Array<span class="token punctuation">.</span>from 适用于类数组对象也适用于可迭代对象


Spread 语法只适用于可迭代对象</code></pre></div>
<h2>支持传入任意数量参数的内建函数</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- Math.max(arg1, arg2, ..., argN) —— 返回入参中的最大值


- Object.assign(dest, src1, ..., srcN) —— 依次将属性从 src1..N 复制到 dest</code></pre></div>
<h2>closure</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">闭包是指使用一个''特殊的属性'' ''[[Environment]]'' 来''记录函数自身的创建时的环境''的''函数''



- ''特殊的属性'' ''[[Environment]]''

- ''记录函数自身的创建时的环境''

- ''函数''</code></pre></div>
<p><a href="https://zh.javascript.info/closure">https://zh.javascript.info/closure</a></p>
<h2>IIFE(immediately-invoked function expressions，IIFE）</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 创建 IIFE 的方法</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Parentheses around the function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Parentheses around the whole thing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Bitwise NOT operator starts the expression"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Unary plus starts the expression"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Unary plus starts the expression"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>“new Function”</h2>
<p>🚩 语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> func <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span>argN<span class="token punctuation">]</span><span class="token punctuation">,</span> functionBody<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 场景：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">使用 new Function 创建函数的应用场景非常特殊


比如在复杂的 Web 应用程序中，需要从服务器获取代码或者动态地从模板编译函数时才会使用</code></pre></div>
<p>特殊：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">如果使用 `new Function` 创建一个函数，那么该函数的 [[Environment]] 并不指向当前的词法环境，而是指向全局环境</code></pre></div>
<p>这一点区别于[[closure]]
,因此，”此类函数无法访问外部（outer）变量，只能访问全局变量”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> func <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">"alert(value)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> func<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">getFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: value is not defined</span></code></pre></div>
<p>常规行为进行比较：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> func<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">getFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test"，从 getFunc 的词法环境中获取的</span></code></pre></div>
<p>📌”这一点实在实际中却非常实用”：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">在将 JavaScript 发布到生产环境之前，需要使用 压缩程序（minifier） 对其进行压缩(删除多余的注释和空格等压缩代码 —— 更重要的是，将局部变量命名为较短的变量)

如果使 new Function 可以访问自身函数以外的变量，它也很有可能无法找到重命名的 userName，这是因为新函数的创建发生在代码压缩以后，变量名已经被替换了</code></pre></div>
<h2>调度：setTimeout 和 setInterval</h2>
<p>🚩 语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> timerId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>func<span class="token operator">|</span>code<span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>arg1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>arg2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> timerId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>func<span class="token operator">|</span>code<span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>arg1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>arg2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></code></pre></div>
<p>🚩 垃圾回收和 setInterval/setTimeout 回调（callback）</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 当一个函数传入 setInterval/setTimeout 时，将为其创建一个内部引用，并保存在调度程序中。这样，即使这个函数没有其他引用，也能防止垃圾回收器（GC）将其回收</span>


<span class="token comment">// 在调度程序调用这个函数之前，这个函数将一直存在于内存中</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 一个副作用：</span>

<span class="token comment">// 如果函数引用了外部变量（译注：闭包），那么只要这个函数还存在，外部变量也会随之存在。它们可能比函数本身占用更多的内存</span>

<span class="token comment">// 💡因此，当不再需要调度函数时，最好通过''定时器标识符（timer identifier）'取消它，即使这是个（占用内存）很小的函数。</span></code></pre></div>
<p>🚩 嵌套的 setTimeout</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">嵌套的 setTimeout 能够精确地设置两次执行之间的延时，而 setInterval 却不能</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// setInterval</span>

<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用 setInterval 时，func 函数的实际调用间隔要比代码中设定的时间间隔要短！</span>
  <span class="token function">func</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这也是正常的，因为 func 的执行所花费的时间“消耗”了一部分间隔时间</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//setTimeout</span>

<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">func</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>run<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 零延时实际上不为零（在浏览器中）</p>
<p>特殊的用法：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">setTimeout(func)</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">setTimeout(func, 0)</code></pre></div>
<p>在浏览器环境下，嵌套定时器的运行频率是受限制的。根据 HTML5 标准 所讲：“”经过 5 重嵌套定时器之后，时间间隔被强制设定为至少 4 毫秒””</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> times <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  times<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存前一个调用的延时</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> <span class="token number">100</span> <span class="token operator">&lt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">alert</span><span class="token punctuation">(</span>times<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 100 毫秒之后，显示延时信息</span>
  <span class="token keyword">else</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 否则重新调度</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>历史遗留：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">这个限制来自“远古时代”，并且许多脚本都依赖于此，所以这个机制也就存在至今

对于服务端的 JavaScript，就没有这个限制，并且还有其他调度即时异步任务的方式。例如 Node.js 的 setImmediate。因此，这个提醒只是针对浏览器环境的</code></pre></div>
<h2>属性标志和属性描述符</h2>
<p>🚩<code class="language-text">属性标志</code> ：对象（存储属性（<code class="language-text">properties</code>）， 键值对）还有三个特殊的特性（<code class="language-text">attributes</code>）（除了<code class="language-text">value</code>）</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- writable — 如果为 true，则值可以被修改，否则它是只可读的

- enumerable — 如果为 true，则会被在循环中列出，否则不会被列出

- configurable — 如果为 true，则此特性可以被删除，这些属性也可以被修改，否则不可以</code></pre></div>
<p>🚩 查询<code class="language-text">属性描述符对象</code>（属性的完整信息），使用<code class="language-text">Object.getOwnPropertyDescriptor</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 属性描述符对象：它包含值和所有的属性标志</code></pre></div>
<p>语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> descriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> descriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 属性描述符：
{
  "value": "John",
  "writable": true,
  "enumerable": true,
  "configurable": true
}
*/</span></code></pre></div>
<p>🚩 修改<code class="language-text">属性标志</code>，使用 <code class="language-text">Object.defineProperty</code></p>
<p>语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> propertyName<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> descriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
{
  "value": "John",
  "writable": false,
  "enumerable": false,
  "configurable": false
}
 */</span></code></pre></div>
<p>不可配置性(<code class="language-text">configurable</code>)对 <code class="language-text">defineProperty</code> 施加了一些限制:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 不能修改 configurable 标志

- 不能修改 enumerable 标志

- 不能将 writable: false 修改为 true（反过来则可以）

- 不能修改访问者属性的 get/set（但是如果没有可以分配它们）</code></pre></div>
<p>”“configurable: false” 的用途是防止更改和删除属性标志，但是允许更改对象的值”</p>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  configurable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Pete"</span><span class="token punctuation">;</span> <span class="token comment">// 正常工作</span>
<span class="token keyword">delete</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// Error</span></code></pre></div>
<p>🚩 多个属性接口 <code class="language-text">Object.defineProperties</code>和<code class="language-text">Object.getOwnPropertyDescriptors</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 一起使用可以用作克隆对象的标志属性</span>

<span class="token keyword">let</span> clone <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>和<code class="language-text">for..in</code>的区别：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- for..in 会忽略 symbol 类型的属性

- Object.getOwnPropertyDescriptors 返回包含 symbol 类型的属性在内的 所有 属性描述符</code></pre></div>
<p>🚩 属性描述符在”单个属性”的级别上工作，还有一些限制访问 ”整个对象”的方法</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">-</span> Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token operator">-</span> Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token operator">-</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token operator">...</span></code></pre></div>
<h2>属性的 getter 和 setter</h2>
<p>🚩 两种种类型的对象属性:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 数据属性

- 访问器属性（accessor properties）: 本质上是用于获取和设置值的函数，但从外部代码来看就像常规属性</code></pre></div>
<p>🚩 访问器属性由 “getter” 和 “setter” 方法表示，在对象字面量中，它们用 get 和 set 表示</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 从外表看，访问器属性看起来就像一个普通属性

- 这就是访问器属性的设计思想：不以函数的方式调用，obj.xxx正常读取 （getter 在幕后运行）</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">propName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当读取 obj.propName 时，getter 起作用</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token keyword">set</span> <span class="token function">propName</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当执行 obj.propName = value 操作时，setter 起作用</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 访问器属性的描述符与数据属性的不同</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">对于访问器属性

<span class="token operator">-</span> 没有 value 和 writable

<span class="token operator">-</span> <span class="token keyword">get</span> 一个没有参数的函数，在读取属性时工作

<span class="token operator">-</span> <span class="token keyword">set</span> 带有一个参数的函数，在设置属性时工作

<span class="token operator">-</span> enumerable —— 与数据属性的相同

<span class="token operator">-</span> configurable —— 与数据属性的相同</code></pre></div>
<p>🚩 一个属性要么是访问器（具有 get/set 方法），要么是数据属性（具有 value），但不能两者都是</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 在同一个描述符中同时提供 get 和 value，则会出现错误</span>

<span class="token comment">// Error: Invalid property descriptor.</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"prop"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 访问器的一大用途</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">允许随时通过使用 getter 和 setter 『替换』“正常的”数据属性，来控制和调整这些属性的行为</code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 始使用数据属性 name 和 age 来实现 user 对象</span>

<span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>john<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 25</span>

<span class="token comment">// ...</span>

<span class="token comment">// ……但迟早，情况可能会发生变化,可能会决定存储 birthday，而不是 age，因为它更精确，更方便</span>

<span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> birthday</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">1992</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token comment">// 💡现在应该如何处理仍使用 age 属性的旧代码呢？</span>

<span class="token comment">// 可以尝试找到所有这些地方并修改它们，但这会花费很多时间</span>

<span class="token comment">// 而且如果其他很多人都在使用该代码，那么可能很难完成所有修改</span>

<span class="token comment">// ...</span>

<span class="token comment">// 为 age 添加一个 getter 来解决这个问题</span>

<span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> birthday</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>

  <span class="token comment">// 年龄是根据当前日期和生日计算得出的</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> todayYear <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> todayYear <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>birthday<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">1992</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>john<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// birthday 是可访问的</span>
<span class="token function">alert</span><span class="token punctuation">(</span>john<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ……age 也是可访问的</span></code></pre></div>
<h2>原型继承（Prototypal inheritance）</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">原型继承 是JavaScript语言特性之一  能 实现 【代码重用】</code></pre></div>
<p>🚩<code class="language-text">[[Prototype]]</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 在 JavaScript 中，【对象】有一个特殊的隐藏属性 [[Prototype]]（如规范中所命名的）

  -  [[Prototype]]要么为 null

  -  [[Prototype]]要么就是对【另一个对象的引用】（该对象被称为“原型”）</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 当从 object 中读取一个缺失的属性时，JavaScript 会自动从原型中获取该属性

- 在编程中，这种行为被称为“原型继承”</code></pre></div>
<p>🚩<code class="language-text">__proto__</code>   和  <code class="language-text">[[Prototype]]</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 属性 [[Prototype]] 是内部的而且是隐藏的，但是有很多设置它的方式（其中之一就是使用特殊的名字 __proto__）


- 引用不能形成闭环。如果试图在一个闭环中分配 __proto__，JavaScript 会抛出错误


- __proto__ 与内部的 [[Prototype]] 不一样：__proto__ 是 [[Prototype]] 的 getter/setter

- 现代编程语言建议使用函数 Object.getPrototypeOf/Object.setPrototypeOf 来取代 __proto__ 去 get/set 原型


- 根据规范，__proto__ 必须仅受浏览器环境的支持。但实际上，包括服务端在内的所有环境都支持它</code></pre></div>
<p>🚩<code class="language-text">for..in</code>循环</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* for..in 循环也会迭代继承的属性


* 几乎所有其他键/值获取方法都忽略继承的属性。例如 Object.keys 和 Object.values 等</code></pre></div>
<h2>F.prototype</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* JavaScript中可以使用诸如 new F() 这样的构造函数来创建一个新对象

- 如果 F.prototype 是一个对象，那么 new 操作符会使用它为新对象设置 [[Prototype]]</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">注意：这里的 F.prototype 指的是 F 的一个名为 "prototype" 的常规属性</code></pre></div>
<p>例如：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token punctuation">{</span>
  eats<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Rabbit</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 设置 Rabbit.prototype = animal 的字面意思是：“当创建了一个 new Rabbit 时，把它的 [[Prototype]] 赋值为 animal”</span>

<span class="token class-name">Rabbit</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> animal<span class="token punctuation">;</span>

<span class="token keyword">let</span> rabbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rabbit</span><span class="token punctuation">(</span><span class="token string">"White Rabbit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  rabbit.__proto__ == animal</span>

<span class="token function">alert</span><span class="token punctuation">(</span>rabbit<span class="token punctuation">.</span>eats<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<p>🚩F.prototype 仅用在 new F 时</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* F.prototype 属性仅在 new F 被调用时使用，它为新对象的 [[Prototype]] 赋值


- 如果在创建之后，F.prototype 属性有了变化（F.prototype = &lt;another object>），那么通过 new F 创建的新对象也将随之拥有新的对象作为 [[Prototype]]，但已经存在的对象将保持旧有的值</code></pre></div>
<p>🚩 每个【函数】都有 “prototype” 属性，即使没有提供它</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 默认的 "prototype" 是一个只有属性 constructor 的对象，属性 constructor 指向函数自身</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Rabbit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// by default:</span>
<span class="token comment">// Rabbit.prototype = { constructor: Rabbit }</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token class-name">Rabbit</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">==</span> Rabbit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 可以使用 constructor 属性来创建一个新对象，该对象使用与现有对象相同的构造器

- 当有一个对象，但不知道它使用了哪个构造器（例如它来自第三方库），并且需要创建另一个类似的对象时，用这种方法就很方便</code></pre></div>
<p>例如</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Rabbit</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> rabbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rabbit</span><span class="token punctuation">(</span><span class="token string">"White Rabbit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rabbit2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">rabbit<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span><span class="token string">"Black Rabbit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* F.prototype 的值要么是一个对象，要么就是 null：其他值都不起作用

- "prototype" 属性仅在设置了一个构造函数（constructor function），并通过 new 调用时，才具有这种特殊的影响</code></pre></div>
<p>例如</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 在常规对象上，prototype 没什么特别的</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  prototype<span class="token operator">:</span> <span class="token string">"Bla-bla"</span><span class="token punctuation">,</span> <span class="token comment">// 这里只是普通的属性</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 默认情况下，【所有函数】都有 F.prototype = {constructor：F}

- 所以可以通过访问它的 "constructor" 属性来获取一个对象的构造器</code></pre></div>
<h2>原生的原型</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 所有的内建对象都遵循相同的模式（pattern）

  - 方法都存储在 prototype 中（Array.prototype、Object.prototype、Date.prototype 等）

  - 对象本身只存储数据（数组元素、对象属性、日期）</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 原始数据类型也将方法存储在包装器对象的 prototype 中：Number.prototype、String.prototype 和 Boolean.prototype


* 只有 undefined 和 null 没有包装器对象</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 内建原型可以被修改或被用新的方法填充

  - 但是不建议更改它们

  - 唯一允许的情况可能是，当添加一个还没有被 JavaScript 引擎支持，但已经被加入 JavaScript 规范的新标准时，才可能允许这样做</code></pre></div>
<h2>原型简史</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 有多少种处理 [[Prototype]] 的方式，答案是有很多！

- 很多种方法做的都是同一件事儿！</code></pre></div>
<p>🚩 为什么会出现这种情况？这是历史原因！</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 构造函数的 "prototype" 属性自古以来就起作用


* 之后，在 2012 年，Object.create 出现在标准中

  - 它提供了使用给定原型创建对象的能力

  - 但没有提供 get/set 它的能力

  - 因此，许多浏览器厂商实现了非标准的 __proto__ 访问器，该访问器允许用户随时 get/set 原型


* 之后，在 2015 年，Object.setPrototypeOf 和 Object.getPrototypeOf 被加入到标准中

  - 执行与 __proto__ 相同的功能

  - 由于 __proto__ 实际上已经在所有地方都得到了实现，但它已过时，所以被加入到该标准的附件 B 中，即：在非浏览器环境下，它的支持是可选的</code></pre></div>
<p>🚩 为什么将 <strong>proto</strong> 替换成函数 getPrototypeOf/setPrototypeOf？</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">__proto__ 是 [[Prototype]] 的 getter/setter，就像其他方法一样，【它位于 Object.prototype】</code></pre></div>
<p>🚩 如果速度很重要，就请不要修改已存在的对象的 [[Prototype]]</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 从技术上来讲，可以在任何时候 get/set [[Prototype]]。但是通常只在创建对象的时候设置它一次，自那之后不再修改

- 并且，JavaScript 引擎对此进行了高度优化。用 Object.setPrototypeOf 或 obj.__proto__= “即时”更改原型是一个非常缓慢的操作，因为它破坏了对象属性访问操作的内部优化

- 因此，除非你知道自己在做什么，或者 JavaScript 的执行速度对你来说完全不重要，否则请避免使用它</code></pre></div>
<p>🚩Object.create(null)</p>
<p>语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>proto<span class="token punctuation">,</span> <span class="token punctuation">[</span>descriptors<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 利用给定的 proto 作为 [[Prototype]]（可以是 null）和可选的属性描述来创建一个空对象</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">通过 Object.create(null) 来创建没有原型的对象。这样的对象被用作 “pure dictionaries” / “very plain” 对象</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 如果要将一个用户生成的键放入一个对象，那么内建的 __proto__ getter/setter 是不安全的

  - 因为用户可能会输入 "__proto__" 作为键，这会导致一个 error，虽然希望这个问题不会造成什么大影响，但通常会造成不可预料的后果

  - 因此，可以使用 Object.create(null) 创建一个没有 __proto__ 的 “very plain” 对象

  - 或者对此类场景坚持使用 Map 对象</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 此外，Object.create 提供了一种简单的方式来浅拷贝一个对象的所有描述符</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> clone <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">,</span>
  Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Class 基本语法</h2>
<p>🚩 基本的类语法看起来像这样:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>

  prop <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token comment">// 属性； class 字段 prop 会在在每个独立对象中被设好，而不是设在 Myclass.prototype</span>

  <span class="token function-variable function">prop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// 属性； class 字段 prop 更优雅的绑定方法</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 构造器</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// method</span>

  <span class="token keyword">get</span> <span class="token function">something</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// getter 方法</span>
  <span class="token keyword">set</span> <span class="token function">something</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// setter 方法</span>

  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 有计算名称（computed name）的方法（此处为 symbol）</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- MyClass 是一个函数（提供作为 constructor 的那个）

- methods、getters 和 settors 都被写入了 MyClass.prototype

- prop  每个实例都有一份</code></pre></div>
<p>🚩 什么是 class？<code class="language-text">在 JavaScript 中，类是一种函数</code></p>
<p>很好的诠释：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// class 是一个函数</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> User<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function</span>

<span class="token comment">// ...或者，更确切地说，是 constructor 方法</span>
<span class="token function">alert</span><span class="token punctuation">(</span>User <span class="token operator">===</span> <span class="token class-name">User</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 方法在 User.prototype 中，例如：</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sayHi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// alert(this.name);</span>

<span class="token comment">// 在原型中实际上有两个方法</span>
<span class="token function">alert</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// constructor, sayHi</span></code></pre></div>
<p>🚩class 不仅仅是语法糖!</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">1. 通过 class 创建的函数具有特殊的内部属性标记 [[IsClassConstructor]]: true；编程语言会在许多地方检查该属性</code></pre></div>
<p>例如</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// class 必须使用 new 来调用</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> User<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function</span>

<span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Class constructor User cannot be invoked without 'new'</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">2.大多数 JavaScript 引擎中的类构造器的字符串表示形式都以 “class…” 开头</code></pre></div>
<p>js 中</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// class User { ... }</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">3.类方法不可枚举; 类定义将 "prototype" 中的所有方法的 enumerable 标志设置为 false</code></pre></div>
<p>如果对一个对象调用 for..in 方法，通常不希望 用 class 方法出现</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">4 类总是使用 use strict。 在类构造中的所有代码都将自动进入严格模式</code></pre></div>
<p>🚩 类表达式</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 像函数一样，类可以在另外一个表达式中被定义，被传递，被返回，被赋值等</code></pre></div>
<p>匿名类表达式(类似匿名函数）：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> User <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>“命名类表达式（Named Class Expression）”（类似于命名函数表达式（Named Function Expressions）：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// “命名类表达式（Named Class Expression）”</span>
<span class="token comment">// (规范中没有这样的术语，但是它和命名函数表达式类似)</span>
<span class="token keyword">let</span> User <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MyClass 这个名字仅在类内部可见</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正常运行，显示 MyClass 中定义的内容</span>

<span class="token function">alert</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error，MyClass 在外部不可见；名字仅在类内部可见</span></code></pre></div>
<h2>类继承</h2>
<p>🚩 扩展一个类：<code class="language-text">class Child extends Parent</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 在内部，关键字 extends 使用了很好的旧的原型机制进行工作

- 它将 Child.prototype.[[Prototype]] 设置为 Parent.prototype</code></pre></div>
<p>在 extends 后允许任意表达式:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">phrase</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
    <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>phrase<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">f</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello</span>

<span class="token comment">// 这对于高级编程模式，例如当根据许多条件使用函数生成类，并继承它们时来说可能很有用</span></code></pre></div>
<p>🚩 重写一个方法</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 默认情况下，所有未在 class child 中指定的方法均从 class Parent 中直接获取


- 有时不希望完全替换父类的方法，而是希望在父类方法的基础上进行调整或扩展其功能</code></pre></div>
<p>Class 为此提供了 “super” 关键字:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 执行 super.method(...) 来调用一个父类方法

- 执行 super(...) 来调用一个父类 constructor（只能在子类的 constructor 中）</code></pre></div>
<p>补充：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 箭头函数没有 super 和 this</code></pre></div>
<p>🚩 重写一个 constructor</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">根据 规范，如果一个类扩展了另一个类并且没有 constructor，那么将生成下面这样的 constructor：


<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
  <span class="token comment">// 为没有自己的 constructor 的扩展类生成的</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">''继承类的 constructor 必须调用 super(...)，并且 (!) 一定要在使用 this 之前调用''</code></pre></div>
<p>💡 为什么呢？</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* 在 JavaScript 中，继承类（所谓的“派生构造器”，英文为 “derived constructor”）的构造函数与其他函数之间是有区别的

- 派生构造器具有特殊的内部属性 [[ConstructorKind]]:"derived"；这是一个特殊的内部标签


该标签会影【响它的 new 行为】：

  - 当通过 new 执行一个常规函数时，它将创建一个空对象，并将这个空对象赋值给 this


  - 但是,当继承的 constructor 执行时，它不会执行此操作；它期望父类的 constructor 来完成这项工作


* 因此，派生的 constructor 必须调用 super 才能执行其父类（base）的 constructor，否则 this 指向的那个对象将不会被创建</code></pre></div>
<p>😨 重写类字段: 一个棘手的注意要点；可以重写方法，也可以重写字段：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">"animal"</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Rabbit</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">"rabbit"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// animal</span>
<span class="token keyword">new</span> <span class="token class-name">Rabbit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// animal</span>

<span class="token comment">// 两种情况下：new Animal() 和 new Rabbit()，在 (*) 行的 alert 都打印了 animal</span>

<span class="token comment">// 有点懵逼，用方法来进行比较：</span>

<span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 而不是 this.name = 'animal'</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"animal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 而不是 alert(this.name);</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Rabbit</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"rabbit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// animal</span>
<span class="token keyword">new</span> <span class="token class-name">Rabbit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rabbit</span>

<span class="token comment">// 请注意：这时的输出是不同的</span>

<span class="token comment">// 这才是本来所期待的结果。当父类构造器在派生的类中被调用时，它会使用被重写的方法；……但对于类字段并非如此。正如前文所述，父类构造器总是使用父类的字段</span></code></pre></div>
<p>为什么会有这样的区别呢？</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">原因在于类字段初始化的顺序:

- 对于基类（还未继承任何东西的那种），在构造函数调用前初始化

- 对于派生类，在 super() 后立刻初始化</code></pre></div>
<p>”这种字段与方法之间微妙的区别只特定于 JavaScript;这种行为仅在一个被重写的字段被父类构造器使用时才会显现出来;可以通过使用方法或者 getter/setter 替代类字段，来修复这个问题”</p>
<p>🚩 深入地研究 <code class="language-text">super</code> <code class="language-text">[[HomeObject]]</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 当一个对象方法执行时，它会将当前对象作为 this

- 随后如果调用 super.method()，那么引擎需要从当前对象的原型中获取 method</code></pre></div>
<p>😨super 怎么做到的？看似容易，其实并不简单！</p>
<p>使用普通对象演示一下：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"Animal"</span><span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> eats.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rabbit <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> animal<span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">"Rabbit"</span><span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这就是 super.eat() 可以大概工作的方式</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

rabbit<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Rabbit eats.</span></code></pre></div>
<p>”this.<strong>proto</strong>.eat() 将在原型的上下文中执行 eat，而非当前对象”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"Animal"</span><span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> eats.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rabbit <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> animal<span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...bounce around rabbit-style and call parent (animal) method</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> longEar <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> rabbit<span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...do something with long ears and call parent (rabbit) method</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (**)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

longEar<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Maximum call stack size exceeded</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 在 (*) 和 (**) 这两行中，this 的值都是当前对象（longEar）；这是至关重要的一点：所有的对象方法都将当前对象作为 this，而非原型或其他什么东西


- 因此，在 (*) 和 (**) 这两行中，this.__proto__ 的值是完全相同的：都是 rabbit。它们俩都调用的是 rabbit.eat，它们在不停地循环调用自己，而不是在原型链上向上寻找方法</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 1.在 longEar.eat() 中，(**) 这一行调用 rabbit.eat 并为其提供 this=longEar</span>

<span class="token comment">// 在 longEar.eat() 中我们有 this = longEar</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (**)</span>
<span class="token comment">// 变成了</span>
longEar<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 也就是</span>
rabbit<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.之后在 rabbit.eat 的 (*) 行中，希望将函数调用在原型链上向更高层传递，但是 this=longEar，所以 this.__proto__.eat 又是 rabbit.eat！</span>

<span class="token comment">// 在 rabbit.eat() 中我们依然有 this = longEar</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
<span class="token comment">// 变成了</span>
longEar<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或（再一次）</span>
rabbit<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3. ……所以 rabbit.eat 在不停地循环调用自己，因此它无法进一步地提升</span></code></pre></div>
<p>😭 这个问题没法仅仅通过使用 this 来解决!!!</p>
<p>🚩 为了提供解决方法，JavaScript 为函数添加了一个特殊的内部属性：<code class="language-text">[[HomeObject]]</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 当一个函数被定义为类或者对象方法时，它的 [[HomeObject]] 属性就成为了该对象

- 然后 super 使用它来解析（resolve）父原型及其方法</code></pre></div>
<p>看它是怎么工作的（对于普通对象）</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"Animal"</span><span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// animal.eat.[[HomeObject]] == animal</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> eats.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rabbit <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> animal<span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">"Rabbit"</span><span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// rabbit.eat.[[HomeObject]] == rabbit</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> longEar <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> rabbit<span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">"Long Ear"</span><span class="token punctuation">,</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// longEar.eat.[[HomeObject]] == longEar</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 正确执行</span>
longEar<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Long Ear eats.</span></code></pre></div>
<p>🚩 方法并不是“自由”的</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">*</span> 函数通常都是“自由”的，并没有绑定到 JavaScript 中的对象。正因如此，它们可以在对象之间复制，并用另外一个 <span class="token keyword">this</span> 调用它。

<span class="token operator">-</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HomeObject<span class="token punctuation">]</span><span class="token punctuation">]</span> 的存在违反了上述原则，因为方法记住了它们的对象

<span class="token operator">-</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HomeObject<span class="token punctuation">]</span><span class="token punctuation">]</span> 不能被更改，所以这个绑定是永久的

<span class="token operator">-</span> 在 JavaScript 语言中 <span class="token punctuation">[</span><span class="token punctuation">[</span>HomeObject<span class="token punctuation">]</span><span class="token punctuation">]</span> 仅被用于 <span class="token keyword">super</span>；所以，如果一个方法不使用 <span class="token keyword">super</span>，那么仍然可以视它为自由的并且可在对象之间复制；但是用了 <span class="token keyword">super</span> 再这样做可能就会出错</code></pre></div>
<p>错误示范</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I'm an animal</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// rabbit 继承自 animal</span>
<span class="token keyword">let</span> rabbit <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> animal<span class="token punctuation">,</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> plant <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"I'm a plant"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// tree 继承自 plant</span>
<span class="token keyword">let</span> tree <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> plant<span class="token punctuation">,</span>
  sayHi<span class="token operator">:</span> rabbit<span class="token punctuation">.</span>sayHi<span class="token punctuation">,</span> <span class="token comment">// (*)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

tree<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// I'm an animal (?!?)</span></code></pre></div>
<p>🚩 方法，不是函数属性</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- [[HomeObject]] 是为类和普通对象中的方法定义的。但是对于对象而言，方法必须确切指定为 method()，而不是 "method: function()"


- 这个差别对开发者来说可能不重要，但是对 JavaScript 来说却非常重要</code></pre></div>
<p>错误示范</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">eat</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里是故意这样写的，而不是 eat() {...</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rabbit <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token operator">:</span> animal<span class="token punctuation">,</span>
  <span class="token function-variable function">eat</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

rabbit<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误调用 super（因为这里没有 [[HomeObject]]）</span></code></pre></div>
<h2>静态属性和静态方法</h2>
<p>🚩 静态方法</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">把一个方法赋值给类的函数本身，而不是赋给它的 "prototype"


这样的方法被称为 静态的（static）</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">staticMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> User<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

User<span class="token punctuation">.</span><span class="token function">staticMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 和作为属性赋值的作用相同</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

User<span class="token punctuation">.</span><span class="token function-variable function">staticMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> User<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

User<span class="token punctuation">.</span><span class="token function">staticMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">静态方法被用于实现属于整个类的功能;它与具体的类实例无关</code></pre></div>
<p>🚩 静态属性</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">静态属性类似静态方法</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> publisher <span class="token operator">=</span> <span class="token string">"Levi Ding"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span>Article<span class="token punctuation">.</span>publisher<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Levi Ding</span>

<span class="token comment">// 等同于直接给 Article 赋值：</span>

Article<span class="token punctuation">.</span>publisher <span class="token operator">=</span> <span class="token string">"Levi Ding"</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">静态属性被用于想要存储类级别的数据时，而不是绑定到实例</code></pre></div>
<p>🚩 继承静态属性和方法</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 静态属性和方法是可被继承的

- 继承对常规方法和静态方法都有效</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> planet <span class="token operator">=</span> <span class="token string">"Earth"</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> speed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>speed <span class="token operator">=</span> speed<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">speed <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>speed <span class="token operator">+=</span> speed<span class="token punctuation">;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> runs with speed </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>speed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter">animalA<span class="token punctuation">,</span> animalB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> animalA<span class="token punctuation">.</span>speed <span class="token operator">-</span> animalB<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 继承于 Animal</span>
<span class="token keyword">class</span> <span class="token class-name">Rabbit</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> hides!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> rabbits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Rabbit</span><span class="token punctuation">(</span><span class="token string">"White Rabbit"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Rabbit</span><span class="token punctuation">(</span><span class="token string">"Black Rabbit"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

rabbits<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>Rabbit<span class="token punctuation">.</span>compare<span class="token punctuation">)</span><span class="token punctuation">;</span>

rabbits<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Black Rabbit runs with speed 5.</span>

<span class="token function">alert</span><span class="token punctuation">(</span>Rabbit<span class="token punctuation">.</span>planet<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Earth</span></code></pre></div>
<p>它是如何工作的？再次，使用原型 😱。extends 让 Rabbit 的 [[Prototype]] 指向了 Animal</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Rabbit extends Animal 创建了两个 [[Prototype]] 引用：

- 1. Rabbit 函数原型继承自 Animal 函数

- 2. Rabbit.prototype 原型继承自 Animal.prototype</code></pre></div>
<p>校验</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Rabbit</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 对于静态的</span>
<span class="token function">alert</span><span class="token punctuation">(</span>Rabbit<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Animal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 对于常规方法</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token class-name">Rabbit</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<h2>私有的和受保护的属性和方法</h2>
<p>🚩 就面向对象编程（OOP）而言，内部接口与外部接口的划分被称为 [[封装|https://en.wikipedia.org/wiki/Encapsulation<em>(computer</em>programming)]]</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">封装具有以下优点:

1. 保护用户，使他们不会误伤自己

如果一个 class 的使用者想要改变那些本不打算被从外部更改的东西 —— 后果是不可预测的


2. 可支持性

如果严格界定内部接口，那么这个 class 的开发人员可以自由地更改其内部属性和方法，甚至无需通知用户

对于用户来说，当新版本问世时，应用的内部可能被进行了全面检修，但如果外部接口相同，则仍然很容易升级


3. 隐藏复杂性

当实施细节被隐藏，并提供了简单且有据可查的外部接口时，总是很方便的</code></pre></div>
<p>🚩 为了隐藏内部接口，JavaScript 使用受保护的或私有的属性</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 受保护的字段以 _ 开头；这是一个众所周知的约定，不是在语言级别强制执行的；程序员应该只通过它的类和从它继承的类中访问以 _ 开头的字段


- 私有字段以 # 开头；JavaScript 确保我们只能从类的内部访问它们</code></pre></div>
<p>受保护</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CoffeeMachine</span> <span class="token punctuation">{</span>
  _waterAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">set</span> <span class="token function">waterAmount</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Negative water"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_waterAmount <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">waterAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_waterAmount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">power</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_power <span class="token operator">=</span> power<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建咖啡机</span>
<span class="token keyword">let</span> coffeeMachine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoffeeMachine</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加水</span>
coffeeMachine<span class="token punctuation">.</span>waterAmount <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// Error: Negative water</span>

<span class="token comment">// 受保护的属性通常以下划线 _ 作为前缀;一个众所周知的约定，即不应该从外部访问此类型的属性和方法</span>

<span class="token comment">// 也可使用 get.../set... 函数</span>

<span class="token keyword">class</span> <span class="token class-name">CoffeeMachine</span> <span class="token punctuation">{</span>
  _waterAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token function">setWaterAmount</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Negative water"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_waterAmount <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getWaterAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_waterAmount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">CoffeeMachine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setWaterAmount</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 函数更灵活（可以接受多个参数）； ，get/set 语法更短</span></code></pre></div>
<p>只读</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CoffeeMachine</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">power</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_power <span class="token operator">=</span> power<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">power</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_power<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建咖啡机</span>
<span class="token keyword">let</span> coffeeMachine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoffeeMachine</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Power is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coffeeMachine<span class="token punctuation">.</span>power<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">W</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 功率是：100W</span>

coffeeMachine<span class="token punctuation">.</span>power <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span> <span class="token comment">// Error（没有 setter）</span>

<span class="token comment">// 只能被在创建时进行设置，之后不再被修改;只需要设置 getter，而不设置 setter</span></code></pre></div>
<h2>扩展内建类</h2>
<p>🚩 内建的类，例如 Array，Map 等也都是可以扩展的（extendable）</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 给 PowerArray 新增了一个方法（可以增加更多）</span>
<span class="token keyword">class</span> <span class="token class-name">PowerArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span> <span class="token punctuation">{</span>
  <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PowerArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token keyword">let</span> filteredArr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>filteredArr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10, 50</span>
<span class="token function">alert</span><span class="token punctuation">(</span>filteredArr<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token comment">// 💡注意一个非常有趣的事儿！</span>

<span class="token comment">// 内建的方法例如 filter，map 等 — 返回的正是子类 PowerArray 的新对象；它们内部使用了对象的 constructor 属性来实现这一功能</span>

<span class="token comment">// arr.constructor === PowerArray</span></code></pre></div>
<p>🚩 如果希望像 map 或 filter 这样的内建方法返回常规数组，可以在 Symbol.species 中返回 Array</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">PowerArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span> <span class="token punctuation">{</span>
  <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 内建方法将使用这个作为 constructor</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>species<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Array<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PowerArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token comment">// filter 使用 arr.constructor[Symbol.species] 作为 constructor 创建新数组</span>
<span class="token keyword">let</span> filteredArr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// filteredArr 不是 PowerArray，而是 Array</span>
<span class="token function">alert</span><span class="token punctuation">(</span>filteredArr<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: filteredArr.isEmpty is not a function</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">其他集合的工作方式类似；例如 Map 和 Set 的工作方式类似。它们也使用 Symbol.species；</code></pre></div>
<p>🚩 内建类没有静态方法继承</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 内建对象有它们自己的静态方法，例如 Object.keys，Array.isArray 等

- 原生的类互相扩展,例如，Array 扩展自 Object

- 通常，当一个类扩展另一个类时，静态方法和非静态方法都会被继承

- 但内建类却是一个例外,它们相互间【不继承静态方法】</code></pre></div>
<h2>类型检查方法</h2>
<p>🚩 类型检查方法</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- typeof	原始数据类型；返回string


- {}.toString	原始数据类型，内建对象，包含 Symbol.toStringTag 属性的对象；返回string


- instanceof	对象；返回true/false</code></pre></div>
<p>🚩instanceof 操作符</p>
<p>语法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">obj <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 通常，instanceof 在检查中会将原型链考虑在内

- 此外，还可以在静态方法 Symbol.hasInstance 中设置自定义逻辑</code></pre></div>
<p>🚩obj instanceof Class 算法的执行过程大致如下</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 1.如果这儿有静态方法 Symbol.hasInstance，那就直接调用这个方法</span>

<span class="token comment">// 设置 instanceOf 检查</span>
<span class="token comment">// 并假设具有 canEat 属性的都是 animal</span>
<span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>canEat<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> canEat<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Animal</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true：Animal[Symbol.hasInstance](obj) 被调用</span>


<span class="token comment">// 2. 大多数 class 没有 Symbol.hasInstance。在这种情况下，标准的逻辑是：使用 obj instanceOf Class 检查 Class.prototype 是否等于 obj 的原型链中的原型之一</span>

obj<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Class</span><span class="token punctuation">.</span>prototype<span class="token operator">?</span>
obj<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Class</span><span class="token punctuation">.</span>prototype<span class="token operator">?</span>
obj<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Class</span><span class="token punctuation">.</span>prototype<span class="token operator">?</span>
<span class="token operator">...</span>
<span class="token comment">// 如果任意一个的答案为 true，则返回 true</span>
<span class="token comment">// 否则，如果我们已经检查到了原型链的尾端，则返回 false</span></code></pre></div>
<p>🚩 objA.isPrototypeOf(objB)</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 如果 objA 处在 objB 的原型链中，则返回 true


- 可以将 obj instanceof Class 检查改为 Class.prototype.isPrototypeOf(obj)</code></pre></div>
<p>🚩 福利：使用 Object.prototype.toString 方法来揭示类型</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">可以将Object.prototype.toString 方法作为 typeof 的增强版或者 instanceof 的替代方法来使用</code></pre></div>
<p>按照 [[规范 |https://tc39.github.io/ecma262/#sec-object.prototype.tostring]]所讲，内建的 toString 方法可以被从对象中提取出来，并在任何其他值的上下文中执行。其结果取决于该值</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 方便起见，将 toString 方法复制到一个变量中</span>
<span class="token keyword">let</span> objectToString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>

<span class="token comment">// 它是什么类型的？</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">objectToString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Array]</span>

<span class="token comment">// 💡其结果取决于该值</span>

<span class="token comment">// 对于 number 类型，结果是 [object Number]</span>
<span class="token comment">// 对于 boolean 类型，结果是 [object Boolean]</span>
<span class="token comment">// 对于 null：[object Null]</span>
<span class="token comment">// 对于 undefined：[object Undefined]</span>
<span class="token comment">// 对于数组：[object Array]</span>
<span class="token comment">// ……等（可自定义）</span>

<span class="token comment">// 💡Symbol.toStringTag</span>

<span class="token comment">// 可以使用特殊的对象属性 Symbol.toStringTag 自定义对象的 toString 方法的行为</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">"User"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object User]</span></code></pre></div>
<h2>Mixin 模式</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* Mixin — 是一个通用的面向对象编程术语：一个包含其他类的方法的类

* 一些其它编程语言允许多重继承。JavaScript 不支持多重继承，但是可以通过将方法拷贝到原型中来实现 mixin</code></pre></div>
<p>🚩EventMixin : 可以使用 mixin 作为一种通过添加多种行为来扩充类的方法 例如：事件处理</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> eventMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 订阅事件，用法：
   *  menu.on('select', function(item) { ... }
   */</span>
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 取消订阅，用法：
   *  menu.off('select', handler)
   */</span>
  <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> handlers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers<span class="token operator">?.</span><span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>handlers<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> handlers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>handlers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        handlers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 生成具有给定名称和数据的事件
   *  this.trigger('select', data1, data2);
   */</span>
  <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers<span class="token operator">?.</span><span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 该事件名称没有对应的事件处理程序（handler）</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 调用事件处理程序（handler）</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_eventHandlers<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>用法：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 创建一个 class</span>
<span class="token keyword">class</span> <span class="token class-name">Menu</span> <span class="token punctuation">{</span>
  <span class="token function">choose</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"select"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 添加带有事件相关方法的 mixin</span>
Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Menu</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> eventMixin<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> menu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加一个事件处理程序（handler），在被选择时被调用：</span>
menu<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"select"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Value selected: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 触发事件 => 运行上述的事件处理程序（handler）并显示：</span>
<span class="token comment">// 被选中的值：123</span>
menu<span class="token punctuation">.</span><span class="token function">choose</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>错误处理，“try..catch”</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 通常，如果发生错误，脚本就会“死亡”（立即停止），并在控制台将错误打印出来。

- 但是有一种语法结构 try..catch，它可以“捕获（catch）”错误，因此脚本可以执行更合理的操作，而不是死掉</code></pre></div>
<p>🚩 语法</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行此处代码</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果发生错误，跳转至此处</span>
  <span class="token comment">// err 是一个 error 对象</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  <span class="token comment">// 无论怎样都会在 try/catch 之后执行</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 可能会没有 catch 部分或者没有 finally，所以 try..catch 或 try..finally 都是可用的</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Error 对象包含下列属性：

- message — 人类可读的 error 信息

- name — 具有 error 名称的字符串（Error 构造器的名称）

- stack（没有标准，但得到了很好的支持）— Error 发生时的调用栈</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 如果不需要 error 对象，可以通过使用 catch { 而不是 catch(err) { 来省略它</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 可以使用 throw 操作符来生成自定义的 error。从技术上讲，throw 的参数可以是任何东西，但通常是继承自内建的 Error 类的 error 对象</code></pre></div>
<p>🚩try..catch 仅对运行时的 error 有效</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 在“计划的（scheduled）”代码中发生异常，则 try..catch 不会捕获到异常，例如在 setTimeout 中</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    noSuchVariable<span class="token punctuation">;</span> <span class="token comment">// 脚本将在这里停止运行，函数本身要稍后才执行，这时引擎已经离开了 try..catch 结构</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"won't work"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 为了捕获到计划的（scheduled）函数中的异常，那么 try..catch 必须在这个函数内</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    noSuchVariable<span class="token punctuation">;</span> <span class="token comment">// try..catch 处理 error 了！</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"error is caught here!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 变量和 try..catch..finally 中的局部变量</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 如果使用 let 在 try 块中声明变量，那么该变量将只在 try 块中可见</code></pre></div>
<p>🚩finally 和 return</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- finally 子句适用于 try..catch 的 任何 出口,包括显式的 return</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"finally"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// finally 会在控制转向外部代码前被执行</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先执行 finally 中的 alert，然后执行这个 alert</span></code></pre></div>
<p>🚩 再次抛出（rethrowing）是一种错误处理的重要模式：catch 块通常期望并知道如何处理特定的 error 类型，因此它应该再次抛出它不知道的 error</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// catch 应该只处理它知道的 error，并“抛出”所有其他 error</span>

<span class="token comment">// “再次抛出（rethrowing）”技术可以被更详细地解释为：</span>

<span class="token comment">// 1.Catch 捕获所有 error</span>

<span class="token comment">// 2.在 catch(err) {...} 块中，对 error 对象 err 进行分析</span>

<span class="token comment">// 3.如果不知道如何处理它，那就 throw err</span>

<span class="token comment">// ...</span>

<span class="token comment">// 在下面的代码中，使用“再次抛出”，以达到在 catch 中只处理 SyntaxError 的目的：</span>

<span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">'{ "age": 30 }'</span><span class="token punctuation">;</span> <span class="token comment">// 不完整的数据</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">"Incomplete data: no name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">blabla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 预料之外的 error</span>

  <span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可以使用 instanceof 操作符判断错误类型；还可以从 err.name 属性中获取错误的类名，所有原生的错误都有这个属性；另一种方式是读取 err.constructor.name</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"JSON Error: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> e<span class="token punctuation">;</span> <span class="token comment">// 再次抛出 (*)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩 全局 catch：即使我们没有 try..catch，大多数执行环境也允许我们设置“全局”错误处理程序来捕获“掉出（fall out）”的 error。在浏览器中，就是 window.onerror</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 如果在 try..catch 结构外有一个致命的 error，然后脚本死亡了！有什么办法可以用来应对这种情况吗？可能想要记录这个 error，并向用户显示某些内容（通常用户看不到错误信息）等</span>

<span class="token comment">// 规范中没有相关内容，但是代码的执行环境一般会提供这种机制，因为它确实很有用。例如，Node.JS 有 process.on("uncaughtException")。在浏览器中，可以将将一个函数赋值给特殊的 window.onerror 属性，该函数将在发生未捕获的 error 时执行</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> url<span class="token punctuation">,</span> line<span class="token punctuation">,</span> col<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 全局错误处理程序 window.onerror 的作用通常不是恢复脚本的执行 — 如果发生编程错误，那这几乎是不可能的，它的作用是将错误信息发送给开发者

- 异常监控：有针对这种情况提供错误日志的 Web 服务，例如 https://errorception.com 或 http://www.muscula.com</code></pre></div>
<h2>回调</h2>
<p>🚩 异步 行为（action）：现在开始执行的行为，但它们会在稍后完成；例如，setTimeout 函数就是一个这样的函数；例如加载脚本和模块</p>
<p>实际中的异步行为的示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * 使用给定的 src 加载脚本
 * @param src
 **/</span>
<span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建一个 &lt;script> 标签，并将其附加到页面</span>
  <span class="token comment">// 这将使得具有给定 src 的脚本开始加载，并在加载完成后运行</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>可以像这样使用这个函数：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 在给定路径下加载并执行脚本</span>
<span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/my/script.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// loadScript 下面的代码</span>
<span class="token comment">// 不会等到脚本加载完成才执行</span>
<span class="token comment">// ...</span>

<span class="token comment">// 💡脚本是“异步”调用的，因为它从现在开始加载，但是在这个加载函数执行完成后才运行。如果在 loadScript(…) 下面有任何其他代码，它们不会等到脚本加载完成才执行</span></code></pre></div>
<p>假设需要在新脚本加载后立即使用它，这将不会有效：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/my/script.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个脚本有 "function newFunction() {…}"</span>

<span class="token function">newFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有这个函数！</span></code></pre></div>
<p>😭 到目前为止，loadScript 函数并没有提供跟踪加载完成的方法。脚本加载并最终运行，仅此而已。但是希望了解脚本何时加载完成，以使用其中的新函数和变量</p>
<p>💡 添加一个 callback 函数作为 loadScript 的第二个参数，该函数应在脚本加载完成时执行：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">loadScript</span><span class="token punctuation">(</span>
  <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 在脚本加载完成后，回调函数才会执行</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cool, the script </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>script<span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is loaded</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 所加载的脚本中声明的函数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>”<code class="language-text">''这就是被称为“基于回调”的异步编程风格''</code>”:异步执行某项功能的函数应该提供一个 callback 参数用于在相应事件完成时调用</p>
<p>🚩 回调地狱</p>
<p>如何依次加载两个脚本：第一个，然后是第二个？第三个？</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/my/script.js"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/my/script2.js"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/my/script3.js"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...加载完所有脚本后继续</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>加入处理 Error：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"1.js"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"2.js"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"3.js"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...加载完所有脚本后继续 (*)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>这就是著名的“<code class="language-text">''回调地狱''</code>”或“厄运金字塔”</p>
<p>💡 可以通过使每个行为都成为一个独立的函数来尝试减轻这种问题</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"1.js"</span><span class="token punctuation">,</span> step1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"2.js"</span><span class="token punctuation">,</span> step2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"3.js"</span><span class="token punctuation">,</span> step3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step3</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...加载完所有脚本后继续 (*)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>优缺点</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 没有深层的嵌套，独立为顶层函数

- 可读性差

- 没有重用</code></pre></div>
<p>最好的方法之一就是 “<code class="language-text">''promise''</code>”</p>
<h2>Promise</h2>
<p>🚩 语法</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// executor</span>
  <span class="token comment">// 当 promise 被构造完成时，executor自动执行此函数</span>
  <span class="token comment">// executor 通常是异步任务</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// handler</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token number">1.</span>当 <span class="token keyword">new</span> <span class="token class-name">Promise</span> 被创建，executor 被自动且立即调用

<span class="token number">2.</span>由 <span class="token keyword">new</span> <span class="token class-name">Promise</span> 构造器返回的 promise 对象具有以下【内部属性】

    <span class="token operator">-</span> state — 最初是 <span class="token string">"pending"</span>，然后在 resolve 被调用时变为 <span class="token string">"fulfilled"</span>，或者在 reject 被调用时变为 <span class="token string">"rejected"</span>

    <span class="token operator">-</span> result — 最初是 <span class="token keyword">undefined</span>，然后在 <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> 被调用时变为 value，或者在 <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> 被调用时变为 error

<span class="token number">3.</span>与最初的 “pending” promise 相反，一个 resolved 或 rejected 的 promise 都会被称为 “settled”

<span class="token number">4.</span>executor 只能调用一个 resolve 或一个 reject；任何状态的更改都是最终的（不可逆）</code></pre></div>
<p>🚩 立即 resolve/reject 的 Promise</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// executor 通常是异步执行某些操作，并在一段时间后调用 resolve/reject，但这不是必须的；还可以立即调用 resolve 或 reject</span>

<span class="token comment">// 💡当开始做一个任务时，但随后看到一切都已经完成并已被缓存时，可能就会发生这种情况。这挺好😀</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不花时间去做这项工作</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 立即给出结果：123</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 示例：加载脚本的 loadScript 函数</p>
<p>基于回调函数的变体版本：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>

  script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Script load error for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用法：</span>

<span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">'https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js'</span><span class="token punctuation">,</span> <span class="token parameter">script</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 在脚本加载完成后，回调函数才会执行</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>script<span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is loaded!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>；
  <span class="token function">alert</span><span class="token punctuation">(</span> _ <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 所加载的脚本中声明的函数</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>基于 Promise 重写的版本：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>

    script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Script load error for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用法：</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token function">loadScript</span><span class="token punctuation">(</span>
  <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js"</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>script<span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is loaded!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Another handler..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Promise 链</h2>
<p>🚩Promise 链：回忆回调中，何依次加载两个脚本：第一个，然后是第二个？第三个？</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 💡Promise 提供了一些方案来做到这一点：Promise 链</span>

<span class="token comment">// like this</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// (**)</span>

    <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
    <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// (***)</span>

    <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
    <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
    <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 📌为什么可以？因为对 promise.then 的调用会返回了一个 promise，所以我们可以在其之上调用下一个 .then</span>

<span class="token comment">// 当处理程序（handler）返回一个值时，它将成为该 promise 的 result，所以将使用它调用下一个 .then</span>

<span class="token comment">// 💣''新手常犯的一个经典错误：从技术上讲，我们也可以将多个 .then 添加到一个 promise 上。但这并不是 promise 链（chaining）''</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 💡这里所做的只是一个 promise 的几个处理程序（handler）。它们不会相互传递 result；相反，它们之间彼此独立运行处理任务</span></code></pre></div>
<p>🚩 返回 promise</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- .then(handler) 中所使用的处理程序（handler）可以创建并返回一个 promise

- 在这种情况下，其他的处理程序（handler）将【等待它 settled 后再获得其结果（result）】</code></pre></div>
<p>示例：promise 化的 loadScript</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/one.js"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/two.js"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/three.js"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 脚本加载完成，我们可以在这儿使用脚本中声明的函数</span>
    <span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 💡注意：这儿每个 loadScript 调用都返回一个 promise，并且在它 resolve 时下一个 .then 开始运行。然后，它启动下一个脚本的加载。所以，脚本是一个接一个地加载的</span>

<span class="token comment">// 💡并且代码仍然是“扁平”的 — 它向下增长，而不是向右</span>

<span class="token comment">// ...</span>

<span class="token comment">// 从技术上讲，可以向每个 loadScript 直接添加 .then，就像这样：</span>

<span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/one.js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script1</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/two.js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/three.js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script3</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// 此函数可以访问变量 script1，script2 和 script3</span>
      <span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 💡这段代码做了相同的事儿：按顺序加载 3 个脚本。但它是“向右增长”的。所以会有和使用回调函数一样的问题</span>

<span class="token comment">// 👍刚开始使用 promise 的人可能不知道 promise 链，所以他们就这样写了。通常，链式是首选</span></code></pre></div>
<p>🚩Thenables</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 确切地说，处理程序（handler）返回的不完全是一个 promise，而是返回的被称为 “thenable” 对象 — 一个具有方法 .then 的任意对象

- thenable对象会被当做一个 promise 来对待

- 这个想法是，第三方库可以实现自己的“promise 兼容（promise-compatible）”对象；它们可以具有扩展的方法集，但也与原生的 promise 兼容，因为它们实现了 .then 方法


- 这个特性允许将自定义的对象与 promise 链集成在一起，而不必继承自 Promise</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Thenable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function() { native code }</span>
    <span class="token comment">// 1 秒后使用 this.num*2 进行 resolve</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (**)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thenable</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1000ms 后显示 2</span></code></pre></div>
<p>🚩 作为一个好的做法：异步行为应该始终返回一个 promise</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 这样就可以使得之后计划后续的行为成为可能

- 即使现在不打算对链进行扩展，但之后可能会需要</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loadJson</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadGithubUser</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.github.com/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">showAvatar</span><span class="token punctuation">(</span><span class="token parameter">githubUser</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> githubUser<span class="token punctuation">.</span>avatar_url<span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"promise-avatar-example"</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      img<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>githubUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用它们：</span>
<span class="token function">loadJson</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/user.json"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">loadGithubUser</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>showAvatar<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">githubUser</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Finished showing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>githubUser<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span></code></pre></div>
<h2>使用 promise 进行错误处理</h2>
<p>🚩Promise 链在错误（error）处理</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 当一个 promise 被 reject 时，控制权将移交至最近的 rejection 处理程序（handler）;这在实际开发中非常方便

- .catch 不必是立即的;它可能在一个或多个 .then 之后出现</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/article/promise-chaining/user.json"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.github.com/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">githubUser</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> githubUser<span class="token punctuation">.</span>avatar_url<span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"promise-avatar-example"</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          img<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>githubUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 隐式 try…catch</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- Promise 的执行者（executor）和 promise 的处理程序（handler）周围有一个“隐式的 try..catch”

- 如果发生异常，它（译注：指异常）就会被捕获，并被视为 rejection 进行处理</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// excutor 中</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops!</span>

<span class="token comment">// 等同于</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops!</span>

<span class="token comment">// ...</span>

<span class="token comment">// handler 中</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reject 这个 promise</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops!</span></code></pre></div>
<p>🚩 再次抛出（Rethrowing）</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 如果在 .catch 中 throw，那么控制权就会被移交到下一个最近的 error 处理程序（handler）。如果处理该 error 并正常完成，那么它将继续到最近的成功的 .then 处理程序（handler）</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 执行流：catch -> then</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"The error is handled, continue normally"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Next successful handler runs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 执行流：catch -> catch</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// (*)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token keyword">instanceof</span> <span class="token class-name">URIError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理它</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Can't handle such error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">throw</span> error<span class="token punctuation">;</span> <span class="token comment">// 再次抛出此 error 或另外一个 error，执行将跳转至下一个 catch</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 不在这里运行 */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// (**)</span>

    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The unknown error has occurred: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 不会返回任何内容 => 执行正常进行</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩 未处理的 rejection</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">noSuchFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里出现 error（没有这个函数）</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 一个或多个成功的 promise 处理程序（handler）</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 尾端没有 .catch！</span>

<span class="token comment">// ...</span>

<span class="token comment">// 当一个 error 没有被处理会发生什么？</span>

<span class="token comment">// 💡如果出现 error，promise 的状态将变为 “rejected”，然后执行应该跳转至最近的 rejection 处理程序（handler）。但是上面这个例子中并没有这样的处理程序（handler）。因此 error 会“卡住（stuck）”。没有代码来处理它</span>

<span class="token comment">// 在实际开发中，就像代码中常规的未处理的 error 一样，这意味着某些东西出了问题</span>

<span class="token comment">// 当发生一个常规的错误（error）并且未被 try..catch 捕获时会发生什么？脚本死了，并在控制台（console）中留下了一个信息。对于在 promise 中未被处理的 rejection，也会发生类似的事儿</span></code></pre></div>
<p>JavaScript 引擎会跟踪此类 rejection，在这种情况下会生成一个全局的 error</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 在浏览器中，可以使用 unhandledrejection 事件来捕获这类 error</code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"unhandledrejection"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这个事件对象有两个特殊的属性：</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Promise] - 生成该全局 error 的 promise</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops! - 未处理的 error 对象</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有用来处理 error 的 catch</span></code></pre></div>
<h2>Promise API</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">在 Promise 类中，有 5 种静态方法

- Promise.all([iterable])

- Promise.allSettled([iterable])

- Promise.race([iterable])

- Promise.resolve()

- Promise.reject()</code></pre></div>
<p>🚩Promise.all</p>
<p>语法</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 接受一个 promise 数组(可以是任何可迭代的)作为参数并返回一个新的 promise</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>注意</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 并行执行多个 promise，当所有给定的 promise 都被 成功 时，新的 promise 才会 resolve，并且其结果数组将成为新的 promise 的结果

- 结果数组中元素的顺序与其在源 promise 中的顺序相同(即使第一个 promise 花费了最长的时间)

- 如果任意一个 promise 被 reject，由 Promise.all 返回的 promise 就会立即 reject，并且带有的就是这个 error</code></pre></div>
<p>🚩 如果出现 error，其他 promise 将被忽略</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 如果其中一个 promise 被 reject，Promise.all 就会立即被 reject，完全忽略列表中其他的 promise。它们的结果也被忽略

- 例如，如果有多个同时进行的 fetch 调用，其中一个失败，其他的 fetch 操作仍然会继续执行，但是 Promise.all 将不会再关心（watch）它们。它们可能会 settle，但是它们的结果将被忽略

- Promise.all 没有采取任何措施来取消它们，因为 promise 中没有“取消”的概念</code></pre></div>
<p>🚩Promise.all(iterable) 允许在 iterable 中使用 non-promise 的“常规”值</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// romise.all(...) 接受含有 promise 项的可迭代对象（大多数情况下是数组）作为参数。但是，如果这些对象中的任何一个不是 promise，那么它将被“按原样”传递给结果数组</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 2, 3</span></code></pre></div>
<p>🚩Promise.allSettled</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">Promise<span class="token punctuation">.</span>allSettled 等待所有的 promise 都被 settle，无论结果如何，结果数组具有<span class="token operator">:</span>

<span class="token operator">-</span> <span class="token punctuation">{</span>status<span class="token operator">:</span><span class="token string">"fulfilled"</span><span class="token punctuation">,</span> value<span class="token operator">:</span>result<span class="token punctuation">}</span> 对于成功的响应

<span class="token operator">-</span> <span class="token punctuation">{</span>status<span class="token operator">:</span><span class="token string">"rejected"</span><span class="token punctuation">,</span> reason<span class="token operator">:</span>error<span class="token punctuation">}</span> 对于 error</code></pre></div>
<p>Polyfill</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Promise<span class="token punctuation">.</span>allSettled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">rejectHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">"rejected"</span><span class="token punctuation">,</span> reason <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">resolveHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">"fulfilled"</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Promise<span class="token punctuation">.</span><span class="token function-variable function">allSettled</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> convertedPromises <span class="token operator">=</span> promises<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolveHandler<span class="token punctuation">,</span> rejectHandler<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>convertedPromises<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩Promise.race</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 只等待第一个 settled 的 promise 并获取其结果（或 error）</code></pre></div>
<p>示例</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span></code></pre></div>
<p>🚩Promise.resolve/reject</p>
<p>语法</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 结果 value 创建一个 resolved 的 promise</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等同于</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//...</span>

<span class="token comment">// Promise.reject() 类似</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 当一个函数被期望返回一个 promise 时，这个方法用于兼容性

- 💡这里的兼容性是指，直接从缓存中获取了当前操作的结果 value，但是期望返回的是一个 promise，所以可以使用 Promise.resolve(value) 将 value “封装”进 promise，以满足期望返回一个 promise 的这个需求</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">loadCached</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> text<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 💡可以使用 loadCached(url).then(…)，因为该函数保证了会返回一个 promise。可以放心地在 loadCached 后面使用 .then。这就是 (*) 行中 Promise.resolve 的目的</span></code></pre></div>
<h2>Promisification</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- “Promisification” 指将一个接受回调的函数转换为一个返回 promise 的函数

- 由于许多函数和库都是基于回调的，所以将基于回调的函数和库 promisify 是有意义的</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>

  script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Script load error for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用法：</span>
<span class="token comment">// loadScript('path/script.js', (err, script) => {...})</span>

<span class="token comment">// ...</span>

<span class="token comment">// promisify</span>

<span class="token keyword">let</span> <span class="token function-variable function">loadScriptPromise</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">loadScript</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token function">resolve</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 用法：</span>
<span class="token comment">// loadScriptPromise('path/script.js').then(...)</span></code></pre></div>
<p>新的函数是对原始的 loadScript 函数的包装,在实际开发中，可能需要 promisify 很多函数</p>
<p>🚩promisify</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 返回一个包装函数（wrapper-function） (*)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 对 f 的自定义的回调 (**)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将自定义的回调附加到 f 参数（arguments）的末尾</span>

      <span class="token function">f</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用原始的函数</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用法：</span>
<span class="token keyword">let</span> loadScriptPromise <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>loadScript<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">loadScriptPromise</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩promisification 函数的模块（module）</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- https://github.com/digitaldesignlabs/es6-promisify

- 在 Node.js 中，有一个内建的 promisify 函数 util.promisify</code></pre></div>
<p>🚩Promisification 场景</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- Promisification 不是回调的完全替代

- 请记住，一个 promise 可能只有一个结果，但从技术上讲，一个回调可能被调用很多次

- 因此，promisification 仅适用于调用一次回调的函数。进一步的调用将被忽略</code></pre></div>
<h2>微任务（Microtask）</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- Promise 处理始终是异步的，因此，.then/catch/finally 处理程序（handler）总是在当前代码完成后才会被调用

- 所有 promise 行为都会通过内部的 “promise jobs” 队列，也被称为“微任务队列”（ES8 术语

- 如果需要确保一段代码在 .then/catch/finally 之后被执行，可以将它添加到链式调用的 .then 中</code></pre></div>
<h2>async/await</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- async/await 是以更舒适的方式使用 promise 的一种特殊语法，同时它也非常易于理解和使用

- async/await两个关键字一起提供了一个很好的用来编写异步代码的框架，这种代码易于阅读也易于编写

- 有了 async/await 之后，就几乎不需要使用 promise.then/catch，但是不要忘了它们是基于 promise 的，因为有些时候（例如在最外层作用域）不得不使用这些方法</code></pre></div>
<p>🚩 async 有两个作用</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token number">1.</span>让这个函数总是返回一个 promise；其他值将自动被包装在一个 resolved 的 promise 中

<span class="token number">2.</span>允许在该函数内使用 <span class="token keyword">await</span></code></pre></div>
<p>🚩await</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">Promise 前的关键字 <span class="token keyword">await</span> 使 JavaScript 引擎等待该 promise settle，然后：

<span class="token operator">-</span> 如果有 error，就会抛出异常 — 就像那里调用了 <span class="token keyword">throw</span> error 一样

<span class="token operator">-</span> 否则，就返回结果</code></pre></div>
<p>示例</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"done!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> promise<span class="token punctuation">;</span> <span class="token comment">// 等待，直到 promise resolve (*)</span>

  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "done!"</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 💡(*) 那一行：await 实际上会暂停函数的执行，直到 promise 状态变为 settled，然后以 promise 的结果继续执行</span></code></pre></div>
<p>🚩await 不能在顶层代码运行</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 用在顶层代码中会报语法错误</span>
<span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/article/promise-chaining/user.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token comment">// 但可以将其包裹在一个匿名 async 函数中，如下所示：</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/article/promise-chaining/user.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>🚩await 接受 “thenables”</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 💡像 promise.then 那样，await 允许使用 thenable 对象（那些具有可调用的 then 方法的对象）。这里的想法是，第三方对象可能不是一个 promise，但却是 promise 兼容的：如果这些对象支持 .then，那么就可以对它们使用 await</span>

<span class="token keyword">class</span> <span class="token class-name">Thenable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1000ms 后使用 this.num*2 进行 resolve</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 等待 1 秒，之后 result 变为 2</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Thenable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果 await 接收了一个非 promise 的但是提供了 .then 方法的对象，它就会调用这个 .then 方法，并将内建的函数 resolve 和 reject 作为参数传入（就像它对待一个常规的 Promise executor 时一样）。然后 await 等待直到这两个函数中的某个被调用（在上面这个例子中发生在 (*) 行），然后使用得到的结果继续执行后续任务</span></code></pre></div>
<p>🚩Error 处理</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 如果一个 promise 正常 resolve，await promise 返回的就是其结果</span>

<span class="token comment">// 但是如果 promise 被 reject，它将 throw 这个 error，就像在这一行有一个 throw 语句那样</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等同于</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Whoops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 👍因此，可以用 try..catch 来捕获上面提到的那个 error，与常规的 throw 使用的是一样的方式</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://no-such-url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: failed to fetch</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token comment">// 👌如果没有 try..catch，那么由异步函数 f() 的调用生成的 promise 将变为 rejected；可以在函数调用后面添加 .catch 来处理这个 error：</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://no-such-url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// f() 变成了一个 rejected 的 promise</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: failed to fetch // (*)</span></code></pre></div>
<h2>Generator</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 常规函数只会返回一个单一值（或者不返回任何值）

- 而 Generator 可以按需一个接一个地返回（“yield”）多个值

- 可与 iterable 完美配合使用，从而可以轻松地创建数据流</code></pre></div>
<p>🚩Generator 函数</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">generator 的主要方法就是 next()

- 当被调用时，执行直到最近的 yield &lt;value> 语句（value 可以被省略，默认为 undefined）

- 然后函数执行暂停，并将产出的（yielded）值返回到外部代码</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> generator <span class="token operator">=</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> one <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 1, done: false}</span>

<span class="token keyword">let</span> two <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 2, done: false}</span>

<span class="token keyword">let</span> three <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>three<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 3, done: true}</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">next() 的结果始终是一个具有两个属性的对象：

- value: 产出的（yielded）的值

- done: 如果 generator 函数已执行完成则为 true，否则为 false</code></pre></div>
<p>🚩Generator 是可迭代的</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- generator 具有 next() 方法， 因此generator 是 可迭代（iterable）的

- 因此可以使用 iterator 的所有相关功能，例如：spread 语法 ...

💡next() 是 iterator 的必要方法（可以使用 for..of 循环遍历）</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> generator <span class="token operator">=</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> generator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1，然后是 2</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🚩 使用 generator 进行迭代</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 👉非generator 函数实现 Symbol.iterator</span>

<span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>

  <span class="token comment">// for..of range 在一开始就调用一次这个方法</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...它返回 iterator object：</span>
    <span class="token comment">// 后续的操作中，for..of 将只针对这个对象，并使用 next() 向它请求下一个值</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      current<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">,</span>
      last<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">,</span>

      <span class="token comment">// for..of 循环在每次迭代时都会调用 next()</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 它应该以对象 {done:.., value :...} 的形式返回值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 迭代整个 range 对象，返回从 `range.from` 到 `range.to` 范围的所有数字</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>range<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5</span>

<span class="token comment">// ...</span>

<span class="token comment">// 👉generator 函数实现 Symbol.iterator</span>

<span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>

  <span class="token operator">*</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// [Symbol.iterator]: function*() 的简写形式</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">;</span> value <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">;</span> value<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>range<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5</span></code></pre></div>
<p>🚩Generator 组合（composition）</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 将一个 generator 流插入到另一个 generator 流的自然的方式</code></pre></div>
<p>示例：成一个更复杂的序列：首先是数字 0..9（字符代码为 48…57），接下来是大写字母 A..Z（字符代码为 65…90），接下来是小写字母 a…z（字符代码为 97…122）</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 👉generator composition</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generatePasswordCodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 0..9</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// A..Z</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// a..z</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> code <span class="token keyword">of</span> <span class="token function">generatePasswordCodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  str <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0..9A..Za..z</span>

<span class="token comment">// 👉等同于</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generateAlphaNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// yield* generateSequence(48, 57);</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">57</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> i<span class="token punctuation">;</span>

  <span class="token comment">// yield* generateSequence(65, 90);</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">90</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> i<span class="token punctuation">;</span>

  <span class="token comment">// yield* generateSequence(97, 122);</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">97</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">122</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> code <span class="token keyword">of</span> <span class="token function">generateAlphaNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  str <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0..9A..Za..z</span></code></pre></div>
<p>🚩“yield” 是一条双向路</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yield 不仅可以向外返回结果，而且还可以将外部的值传递到 generator 内</code></pre></div>
<p>示例：</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 向外部代码传递一个问题并等待答案</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token string">"2 + 2 = ?"</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>

  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> generator <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> question <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// &lt;-- yield 返回的 value</span>

generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// --> 将结果传递到 generator 中</span>

<span class="token comment">// 1.第一次调用 generator.next() 应该是不带参数的（如果带参数，那么该参数会被忽略）。它开始执行并返回第一个 yield "2 + 2 = ?" 的结果。此时，generator 执行暂停，而停留在 (*) 行上</span>

<span class="token comment">// 然后，yield 的结果进入调用代码中的 question 变量</span>

<span class="token comment">// 在 generator.next(4)，generator 恢复执行，并获得了 4 作为结果：let result = 4</span></code></pre></div>
<h2>异步迭代 和 异步 generator</h2>
<p>🚩 异步可迭代对象</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 👉可迭代的 range 的一个实现</span>

<span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>

  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在 for..of 循环开始时被调用一次</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      current<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">,</span>
      last<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">,</span>

      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 每次迭代时都会被调用，来获取下一个值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1，然后 2，然后 3，然后 4，然后 5</span>
<span class="token punctuation">}</span>

<span class="token comment">// 👉异步可迭代的 range 的一个实现</span>

<span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>

  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>asyncIterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// (1)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      current<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">,</span>
      last<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">,</span>

      <span class="token keyword">async</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// (2)</span>

        <span class="token comment">// 注意：可以在 async next 内部使用 "await"</span>
        <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (3)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// (4)</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 💡</span>

<span class="token comment">// 使一个对象可以异步迭代，它必须具有方法 【Symbol.asyncIterator 】(1)</span>

<span class="token comment">// 这个方法必须返回一个带有 next() 方法的对象，next() 方法会【返回一个 promise】 (2)</span>

<span class="token comment">// 这个 next() 方法可以不是 async 的，它可以是一个返回值是一个 promise 的常规的方法，但是使用 async 关键字可以允许在方法内部使用 await，所以会更加方便</span>

<span class="token comment">// 使用【 for await(let value of range) 】(4) 来进行迭代，也就是在 for 后面添加 await。它会调用一次 range[Symbol.asyncIterator]() 方法一次，然后调用它的 next() 方法获取值</span></code></pre></div>
<p>🚩 异步可迭代对象 Spread 语法 … 无法异步工作</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 这很正常，因为它期望找到 Symbol.iterator，而不是 Symbol.asyncIterator

- for..of 的情况和这个一样：没有 await 关键字时，则期望找到的是 Symbol.iterator</code></pre></div>
<p>🚩 异步 generator</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 👉可迭代的 range 的 generate 的 一个实现</span>

<span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>

  <span class="token operator">*</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// [Symbol.iterator]: function*() 的一种简写</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">;</span> value <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">;</span> value<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1，然后 2，然后 3，然后 4，然后 5</span>
<span class="token punctuation">}</span>

<span class="token comment">// 👉可迭代的 range 的 generate异步 的 一个实现</span>

<span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 哇，可以使用 await 了！</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">yield</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> generator <span class="token operator">=</span> <span class="token function">generateSequence</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> generator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1，然后 2，然后 3，然后 4，然后 5（在每个 alert 之间有延迟）</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 💡</span>

<span class="token comment">// 在一个常规的 generator 中，使用 result = generator.next() 来获得值</span>

<span class="token comment">// 但在一个异步 generator 中，应该添加 await 关键字，像这样：</span>

result <span class="token operator">=</span> <span class="token keyword">await</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result = {value: ..., done: true/false}</span>

<span class="token comment">// 💡 这就是为什么异步 generator 可以与 for await...of 一起工作</span></code></pre></div>
<h2>模块 (Module)</h2>
<p>🚩 起源</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 随着项目越来越大，需要将其拆成多个文件，即模块（module)(包含特定目的的类或者函数库）</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">很长一段时间，JavaScript 都没有语言级（language-level）的模块语法，但随着脚本越来越复杂，因此社区发明了许多种方法来将代码组织到模块中，使用特殊的库按需加载模块

- AMD

    - https://en.wikipedia.org/wiki/Asynchronous_module_definition

    - 最初由 require.js 库实现

- CommonJS

    - http://wiki.commonjs.org/wiki/Modules/1.1

    -  为 Node.js 服务器创建的模块系统

- UMD

    - https://github.com/umdjs/umd

    - 与 AMD 和 CommonJS 都兼容



- ''`语言级的模块系统在 2015 年的时候出现在了标准（ES6）中`''</code></pre></div>
<p>🚩 模块的核心概念</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">一个模块就是一个文件，览器需要使用 &lt;script type="module"></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">与常规脚本相比（&lt;script src="xx">），拥有 type="module" 标识的脚本有一些特定于浏览器的差异：

- 默认是延迟解析的（deferred）

- Async 可用于内联脚本（对于非模块脚本，async 特性（attribute）仅适用于外部脚本（异步脚本会在准备好后立即运行，独立于其他脚本或 HTML 文档），对于模块脚本，也适用于内联脚本）

- 从另一个源（域/协议/端口）加载外部脚本，需要 CORS header

- 重复的外部脚本会被忽略</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">模块具有自己的本地顶级作用域，并可以通过 import/export 交换功能

- “this” 是 undefined</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">模块始终使用 use strict</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">模块代码只执行一次。导出仅创建一次，然后会在导入之间共享</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">在生产环境中，出于性能和其他原因，开发者经常使用诸如 Webpack 之类的打包工具将模块打包到一起</code></pre></div>
<h2>导出和导入</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 把 import/export 语句放在脚本的顶部或底部，都没关系

- 在实际开发中，导入通常位于文件的开头，但是这只是为了更加方便</code></pre></div>
<p>🚩 export 导出类型</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 💡在声明一个 class/function/… 之前：</span>
<span class="token keyword">export</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token keyword">class</span><span class="token operator">/</span><span class="token keyword">function</span><span class="token operator">/</span>variable <span class="token operator">...</span>

<span class="token comment">// 💡独立的导出：</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>x <span class="token punctuation">[</span><span class="token keyword">as</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">.</span>

<span class="token comment">// 💡重新导出：</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>x <span class="token punctuation">[</span><span class="token keyword">as</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"module"</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">"module"</span>（不会重新导出默认的导出）。
<span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token keyword">default</span> <span class="token punctuation">[</span><span class="token keyword">as</span> y<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"module"</span>（重新导出默认的导出）</code></pre></div>
<p>🚩 import 导入类型</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 💡模块中命名的导出：</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>x <span class="token punctuation">[</span><span class="token keyword">as</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"module"</span>

<span class="token comment">// 💡默认的导出：</span>
<span class="token keyword">import</span> x <span class="token keyword">from</span> <span class="token string">"module"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token keyword">default</span> <span class="token keyword">as</span> x<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"module"</span>

<span class="token comment">// 💡所有：</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> obj <span class="token keyword">from</span> <span class="token string">"module"</span>

<span class="token comment">// 💡导入模块（它的代码，并运行），但不要将其赋值给变量：</span>
<span class="token keyword">import</span> <span class="token string">"module"</span></code></pre></div>
<h2>动态导入</h2>
<p>🚩 静态导入/导出</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 💡模块路径必须是原始类型字符串，不能是函数调用</span>
<span class="token keyword">import</span> <span class="token operator">...</span> from <span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error, only from "string" is allowed</span>

<span class="token comment">// 💡无法根据条件</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span> <span class="token operator">...</span><span class="token punctuation">;</span> <span class="token comment">// Error, not allowed!</span>
<span class="token punctuation">}</span>

<span class="token comment">// 💡无法在运行时导入</span>
<span class="token punctuation">{</span>
  <span class="token keyword">import</span> <span class="token operator">...</span><span class="token punctuation">;</span> <span class="token comment">// Error, we can't put import in any block</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">export / import 语法严格且简单：只提供结构主干

- 便于分析代码结构

- 可以收集模块

- 可以使用特殊工具将收集的模块打包到一个文件中

- 可以删除未使用的导出（“tree-shaken”）</code></pre></div>
<p>🚩import() 表达式</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 返回一个 promise，该 promise resolve 为一个包含其所有导出的模块对象</span>

<span class="token keyword">let</span> modulePath <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Which module to load?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">import</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>module object<span class="token operator">></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>loading error<span class="token punctuation">,</span> e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token keyword">if</span> no such module<span class="token operator">></span><span class="token punctuation">)</span>

<span class="token comment">// or</span>

<span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>

<span class="token keyword">let</span> xx <span class="token operator">=</span> module <span class="token punctuation">.</span>default<span class="token punctuation">;</span><span class="token comment">// 可以使用模块对象的 default 属性</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">动态导入在常规脚本中工作时，不需要 script type="module".</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">😱尽管 import() 看起来像一个函数调用，但它只是一种特殊语法，只是恰好使用了括号（类似于 super()）

😱因此，不能将 import 复制到一个变量中，或者对其使用 call/apply

😱因为它不是一个函数</code></pre></div>
<h2>Eval：执行代码字符串</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">内建函数 eval 允许执行一个代码字符串</code></pre></div>
<p>🚩eval 的结果是最后一条语句的结果</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"let i = 0; ++i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span></code></pre></div>
<p>🚩eval 内的代码在当前词法环境（lexical environment）中执行，因此它能访问外部变量</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"alert(a)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 严格模式下，eval 有属于自己的词法环境，如果不启用严格模式，eval 没有属于自己的词法环境</span>

<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"let x = 5; function f() {}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined（没有这个变量）</span>
<span class="token comment">// 函数 f 也不可从外部进行访问</span></code></pre></div>
<h2>柯里化（Currying）</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">柯里化是一种函数的转换:

- 指将一个函数从可调用的 f(a, b, c) 转换为可调用的 f(a)(b)(c)

- 柯里化不会调用函数,只是对函数进行转换</code></pre></div>
<p>🚩 创建一个辅助函数 curry(f)</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// curry(f) 执行柯里化转换</span>
<span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用法</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> curriedSum <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">curriedSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token comment">// 💡实现非常简单：只有两个包装器（wrapper）</span></code></pre></div>
<p>🚩 柯里化？目的是什么？</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">轻松地生成偏函数</code></pre></div>
<p>🚩 高级柯里化实现</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">curried</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">>=</span> func<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果传入的 args 长度与原始函数所定义的（func.length）相同或者更长，那么只需要将调用传递给它即可</span>
      <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 否则，获取一个偏函数，func 还没有被调用；返回另一个包装器 ，它将重新应用 curried，将之前传入的参数与新的参数一起传入；在一个新的调用中，再次，将获得一个新的偏函数（如果参数不足的话），或者最终的结果</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">curried</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>args2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>

<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> curriedSum <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">curriedSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6，仍然可以被正常调用</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">curriedSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6，对第一个参数的柯里化</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">curriedSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6，全柯里化</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">柯里化要求函数具有固定数量的参数，f(...args)，不能以这种方式进行柯里化</code></pre></div>
<h2>Reference Type</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Reference Type 是语言内部的一个类型</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 在obj.method()中  .  返回的准确来说不是属性的值 而是一个特殊的 “Reference Type” 值 其中储存着属性的值和它的来源对象

- 这是为了【随后】的方法调用 () 获取来源对象，然后将 this 设为它

- 对于所有其它操作，Reference Type 会自动变成属性的值</code></pre></div>
<h2>BigInt</h2>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 创建 bigint 的方式有两种：在一个整数字面量后面加 n 或者调用 BigInt 函数，该函数从字符串、数字等中生成 bigint</span>

<span class="token keyword">const</span> bigint <span class="token operator">=</span> <span class="token number">1234567890123456789012345678901234567890n</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sameBigint <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token string">"1234567890123456789012345678901234567890"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bigintFromNumber <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 与 10n 相同</span></code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">- 不可以把 bigint 和常规数字类型混合使用，应该显式地转换

- 对 bigint 和 number 类型的数字进行比较没有问题

- == 比较时相等，但在进行 ===（严格相等）比较时不相等

- 除法 向下整除

- BigInt 不支持一元加法

- bigint 0n 为假，其他值为 true</code></pre></div>
<p>🚩Polyfill</p>
<p><a href="https://github.com/GoogleChromeLabs/jsbi">https://github.com/GoogleChromeLabs/jsbi</a></p>
<blockquote>
<p>作者：<a href="https://www.shanejix.com/">shanejix</a>
出处：<a href="https://www.shanejix.com/posts/%E7%8E%B0%E4%BB%A3%20JavaScript%20%E6%95%99%E7%A8%8B%20%E2%80%94%20JavaScript%20%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/">https://www.shanejix.com/posts/现代 JavaScript 教程 — JavaScript 编程语言篇/</a>
版权：本作品采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">「署名-非商业性使用-相同方式共享 4.0 国际」</a>许可协议进行许可。
声明：转载请注明出处！</p>
</blockquote></section><section style="margin-top:4.375rem"><p><a href="https://github.com/shanejix/shanejix.github.io/issues/45" target="_blank" rel="noopener noreferrer">Edit on GitHub</a> • <a href="https://github.com/shanejix/shanejix.github.io/issues/45" target="_blank" rel="noopener noreferrer">Discuss on GitHub</a></p></section></article><hr style="margin-bottom:1.75rem"/><div style="display:flex;margin-bottom:3.5rem"><img src="/static/bio-0d7082db0bcaf1381f0ae2cbdc939311.png" alt="Shane Jix" style="margin-right:0.875rem;margin-bottom:0;width:3.5rem;height:3.5rem;border-radius:50%"/><p style="max-width:310px">Personal blog by <a href="https://github.com/shanejix">Shane Jix</a>. I explain with words and code.</p></div><nav style="padding-bottom:2rem"><div style="display:flex;flex-wrap:wrap;justify-content:space-between;padding:0;margin-left:0"><div><a rel="next" href="/posts/从 0 到 1 入门动态规划/">← <!-- -->从 0 到 1 入门动态规划</a></div><div><a rel="prev" href="/posts/如何使用 JavaScript 实现二叉树，二叉平衡树和红黑树/">如何使用 JavaScript 实现二叉树，二叉平衡树和红黑树<!-- -->→</a></div></div></nav></main><style data-emotion-css="v9ddz0">.css-v9ddz0{min-height:10vh;max-height:10vh;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><footer class="css-v9ddz0"><style data-emotion-css="s70iz6">.css-s70iz6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-s70iz6"><style data-emotion-css="180pfyr">.css-180pfyr{display:inline-block;margin-right:1rem;}</style><span class="css-180pfyr"><a href="/links">Links</a></span><span class="css-180pfyr"><a href="/tools">Tools</a></span></div><style data-emotion-css="1yltmzw">.css-1yltmzw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding-bottom:10px;}</style><div class="css-1yltmzw">© 2019 - <!-- -->2022<!-- -->, Built with<span style="padding:0 4px"><a href="https://www.gatsbyjs.org">Gatsby</a></span></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-220985232-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-220985232-1', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-X8ZKVHVCJT"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-X8ZKVHVCJT',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-X8ZKVHVCJT', {"anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/现代 JavaScript 教程 — JavaScript 编程语言篇/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-e795261d8342deefff90.js"],"app":["/app-5c7248fcb69374f91873.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-ad6431e4664bcf916d19.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f46c2501822c6849dd3b.js"],"component---src-pages-about-backup-js":["/component---src-pages-about-backup-js-e12992febc3f9c7942f9.js"],"component---src-pages-index-js":["/component---src-pages-index-js-ba76b73faf9b13c49b7e.js"],"component---src-pages-resume-js":["/component---src-pages-resume-js-cc55ba5d0837e95934be.js"],"component---src-pages-snippets-js":["/component---src-pages-snippets-js-314b523a31e26de10a3a.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-b6cd53c7d21e3e064fd1.js"],"component---src-templates-blog-page-js":["/component---src-templates-blog-page-js-3c820d4c74001e03e229.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-06eb50339f2f3ac086e8.js"],"component---src-templates-blog-tags-js":["/component---src-templates-blog-tags-js-55b14af861a6825c50ba.js"],"component---src-templates-posts-pagination-js":["/component---src-templates-posts-pagination-js-f887a69f275fa18320d2.js"]};/*]]>*/</script><script src="/polyfill-e795261d8342deefff90.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-06eb50339f2f3ac086e8.js" async=""></script><script src="/cac18b802c8b308508681dc900d8d8f756c7bdb5-c7c9c4e9ce9bf74cce02.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-5c7248fcb69374f91873.js" async=""></script><script src="/framework-b17a64ad725e0b3c1338.js" async=""></script><script src="/webpack-runtime-e0256f23ab3c5c1ffc4c.js" async=""></script></body></html>